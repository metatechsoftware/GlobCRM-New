---
phase: 06-quotes-and-requests
plan: 07
type: execute
wave: 3
depends_on: ["06-05", "06-06"]
files_modified:
  - globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
  - globcrm-web/src/app/features/quotes/quotes.routes.ts
  - globcrm-web/src/app/features/requests/requests.routes.ts
  - globcrm-web/src/app/app.routes.ts
  - globcrm-web/src/app/shared/components/navbar/navbar.component.html
  - globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
  - globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
  - globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
autonomous: true

must_haves:
  truths:
    - "Request detail page shows full request info with status workflow buttons"
    - "Quote and Request routes are configured with lazy loading"
    - "Navbar has Quotes and Requests links in correct order"
    - "Company detail page has Quotes and Requests tabs"
    - "Contact detail page has Quotes tab"
    - "Deal detail page has Quotes tab"
  artifacts:
    - path: "globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts"
      provides: "Request detail page with status workflow and entity links"
      contains: "RequestDetailComponent"
    - path: "globcrm-web/src/app/features/quotes/quotes.routes.ts"
      provides: "Quote feature routes"
      contains: "QUOTE_ROUTES"
    - path: "globcrm-web/src/app/features/requests/requests.routes.ts"
      provides: "Request feature routes"
      contains: "REQUEST_ROUTES"
    - path: "globcrm-web/src/app/app.routes.ts"
      provides: "App-level route registration for quotes and requests"
      contains: "quotes"
  key_links:
    - from: "globcrm-web/src/app/app.routes.ts"
      to: "globcrm-web/src/app/features/quotes/quotes.routes.ts"
      via: "loadChildren lazy loading"
      pattern: "QUOTE_ROUTES"
    - from: "globcrm-web/src/app/app.routes.ts"
      to: "globcrm-web/src/app/features/requests/requests.routes.ts"
      via: "loadChildren lazy loading"
      pattern: "REQUEST_ROUTES"
    - from: "globcrm-web/src/app/shared/components/navbar/navbar.component.html"
      to: "globcrm-web/src/app/app.routes.ts"
      via: "routerLink navigation"
      pattern: "routerLink.*quotes"
---

<objective>
Build the Request detail page, configure all routes for Quotes and Requests, add navbar links, and enable Quotes/Requests tabs on Company, Contact, and Deal detail pages.

Purpose: Complete the Request view experience and integrate both Quotes and Requests into the application navigation and entity detail pages.
Output: Request detail component, route files, navbar updates, entity tab updates
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-quotes-and-requests/06-RESEARCH.md
@.planning/phases/06-quotes-and-requests/06-05-SUMMARY.md
@.planning/phases/06-quotes-and-requests/06-06-SUMMARY.md

# Pattern references
@globcrm-web/src/app/features/activities/activities.routes.ts
@globcrm-web/src/app/features/deals/deals.routes.ts
@globcrm-web/src/app/app.routes.ts
@globcrm-web/src/app/shared/components/navbar/navbar.component.html
@globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
@globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
@globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Request detail page and configure all routes</name>
  <files>
    globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
    globcrm-web/src/app/features/quotes/quotes.routes.ts
    globcrm-web/src/app/features/requests/requests.routes.ts
    globcrm-web/src/app/app.routes.ts
  </files>
  <action>
    **RequestDetailComponent** -- inline template, following ActivityDetailComponent pattern (simplified):

    Component setup:
    - Standalone component with inline template and styles
    - Inject RequestService, ActivatedRoute, Router, MatSnackBar, MatDialog
    - Load request detail on init from route param :id

    Template layout:
    - **Header:** Subject, status chip (colored from REQUEST_STATUSES), priority badge (colored from REQUEST_PRIORITIES)
    - **Action bar:** Edit button (routerLink to /requests/:id/edit), Delete button, Status transition buttons (show only allowedTransitions from detail response)
    - **Info cards:** Category, Owner (name), Assigned To (name), Contact (link to /contacts/:id), Company (link to /companies/:id), Created date, Resolved date, Closed date

    **Tabs** (mat-tab-group):
    1. **Details tab:** Description text, custom fields display
    2. **Timeline tab:** Timeline from request timeline endpoint (creation + status changes)

    Status transition behavior:
    - Show buttons labeled: "Start Work" (New->InProgress), "Resolve" (InProgress->Resolved), "Close" (Resolved->Closed), "Reopen" (Closed->InProgress, Resolved->InProgress), etc. based on allowedTransitions
    - On click: call requestService.updateStatus(id, { status: newStatus })
    - On success: reload request, show snackbar "Status updated to {status}"

    Delete behavior:
    - Confirmation dialog using ConfirmDeleteDialogComponent
    - On confirm: requestService.delete(id) -> navigate to /requests, snackbar

    **quotes.routes.ts** -- follow deals.routes.ts pattern:
    ```typescript
    export const QUOTE_ROUTES: Routes = [
      { path: '', component: QuoteListComponent },
      { path: 'new', component: QuoteFormComponent },
      { path: ':id', component: QuoteDetailComponent },
      { path: ':id/edit', component: QuoteFormComponent },
    ];
    ```

    **requests.routes.ts** -- follow activities.routes.ts pattern:
    ```typescript
    export const REQUEST_ROUTES: Routes = [
      { path: '', component: RequestListComponent },
      { path: 'new', component: RequestFormComponent },
      { path: ':id', component: RequestDetailComponent },
      { path: ':id/edit', component: RequestFormComponent },
    ];
    ```

    **app.routes.ts** -- add two new route entries with lazy loading:
    ```typescript
    {
      path: 'quotes',
      canActivate: [authGuard],
      loadChildren: () => import('./features/quotes/quotes.routes').then(m => m.QUOTE_ROUTES),
    },
    {
      path: 'requests',
      canActivate: [authGuard],
      loadChildren: () => import('./features/requests/requests.routes').then(m => m.REQUEST_ROUTES),
    },
    ```
    Place quotes after activities, requests after quotes, before the wildcard/redirect routes.
  </action>
  <verify>All 4 files exist. app.routes.ts contains 'quotes' and 'requests' path entries.</verify>
  <done>RequestDetailComponent shows full request info with status workflow buttons, entity links, and timeline. Quote and Request routes configured with lazy loading for list, new, detail, and edit paths.</done>
</task>

<task type="auto">
  <name>Task 2: Add navbar links and enable Quotes/Requests tabs on entity detail pages</name>
  <files>
    globcrm-web/src/app/shared/components/navbar/navbar.component.html
    globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
    globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
    globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
  </files>
  <action>
    **Navbar updates** (navbar.component.html):
    - Add "Quotes" link after "Activities" link: `<a mat-button routerLink="/quotes" routerLinkActive="active">Quotes</a>`
    - Add "Requests" link after "Quotes" link: `<a mat-button routerLink="/requests" routerLinkActive="active">Requests</a>`
    - Final navbar order: Dashboard | Companies | Contacts | Products | Deals | Activities | Quotes | Requests | Team | Settings

    **Company detail tabs** (company-detail.component.ts):
    - Find the COMPANY_TABS array (or tab definitions)
    - The Quotes tab placeholder should already exist from Phase 5 (05-10 added disabled Quotes tab). Enable it by:
      - Making it non-disabled
      - Loading quotes filtered by companyId when tab is selected
      - Display as a simple list/table of linked quotes with quoteNumber, title, status, grandTotal
      - "View All" link that navigates to /quotes?companyId={id}
    - Add Requests tab (if not already placeholder):
      - Similar to Quotes tab but loading requests filtered by companyId
      - Display: subject, status, priority, assignedToName
      - "View All" link to /requests?companyId={id}
    - Follow the Activities tab pattern from 05-10: use signal guard to prevent redundant API calls on tab re-selection

    **Contact detail tabs** (contact-detail.component.ts):
    - Enable Quotes tab (placeholder should exist from Phase 5):
      - Load quotes filtered by contactId
      - Display: quoteNumber, title, status, grandTotal
      - "View All" link to /quotes?contactId={id}
    - Add/enable Requests tab:
      - Load requests filtered by contactId
      - Display: subject, status, priority
      - "View All" link to /requests?contactId={id}
    - Follow Activities tab signal guard pattern

    **Deal detail tabs** (deal-detail.component.ts):
    - Enable Quotes tab (if placeholder exists, or add new):
      - Load quotes filtered by dealId
      - Display: quoteNumber, title, status, grandTotal, versionNumber
      - "View All" link to /quotes?dealId={id}
    - Follow Activities tab pattern for lazy loading

    For all entity tab updates:
    - Import QuoteService and RequestService
    - Add signals for quotesLoaded, requestsLoaded (guard against redundant loads)
    - Use simple mat-list or CSS table for the embedded list (not full DynamicTable -- too heavy for tab content)
    - Show "No quotes found" / "No requests found" empty state
    - Ensure tab order is correct based on contentChildren template indexing (same issue from 05-10)
  </action>
  <verify>Navbar HTML contains "Quotes" and "Requests" links. Company, Contact, and Deal detail components import QuoteService.</verify>
  <done>Navbar shows Quotes and Requests links in correct position. Company detail has working Quotes and Requests tabs with filtered data. Contact detail has Quotes and Requests tabs. Deal detail has Quotes tab. All use signal guard pattern for lazy loading.</done>
</task>

</tasks>

<verification>
- Navbar shows: Dashboard | Companies | Contacts | Products | Deals | Activities | Quotes | Requests | Team | Settings
- /quotes route loads QuoteListComponent
- /quotes/new loads QuoteFormComponent
- /quotes/:id loads QuoteDetailComponent
- /requests route loads RequestListComponent
- /requests/new loads RequestFormComponent
- /requests/:id loads RequestDetailComponent
- Company detail shows Quotes and Requests tabs with data
- Contact detail shows Quotes and Requests tabs with data
- Deal detail shows Quotes tab with data
</verification>

<success_criteria>
- Request detail shows status workflow with transition buttons
- All routes work with lazy loading and auth guard
- Navbar links navigate correctly to quote and request list pages
- Entity detail tabs load related quotes/requests filtered by entity ID
- Tab content uses signal guards to prevent redundant API calls
- Tab order matches contentChildren template indexing
</success_criteria>

<output>
After completion, create `.planning/phases/06-quotes-and-requests/06-07-SUMMARY.md`
</output>
