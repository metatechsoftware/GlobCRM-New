---
phase: 05-activities-and-workflow
plan: 09
type: execute
wave: 6
depends_on: ["05-06"]
files_modified:
  - globcrm-web/src/app/features/activities/activity-calendar/activity-calendar.component.ts
  - globcrm-web/src/app/features/activities/activity-calendar/activity-calendar.component.html
  - globcrm-web/src/app/features/activities/activity-calendar/activity-calendar.component.scss
autonomous: true

must_haves:
  truths:
    - "Activity calendar displays activities by due date in month grid view"
    - "Activities are color-coded by priority (Low=green, Medium=blue, High=orange, Urgent=red)"
    - "Clicking an activity event navigates to activity detail page"
  artifacts:
    - path: "globcrm-web/src/app/features/activities/activity-calendar/activity-calendar.component.ts"
      provides: "Activity calendar view with FullCalendar"
      contains: "ActivityCalendarComponent"
  key_links:
    - from: "activity-calendar.component.ts"
      to: "FullCalendarModule"
      via: "template reference"
      pattern: "full-calendar"
    - from: "activity-calendar.component.ts"
      to: "activity.service.ts"
      via: "service injection for activity list loading"
      pattern: "inject.*ActivityService"
---

<objective>
Create the Activity calendar view using FullCalendar dayGridMonth, color-coded by priority.

Purpose: Implement ACTV-09 (calendar view). Reuses the exact FullCalendar pattern from the Deal calendar component with priority-based coloring instead of stage-based coloring. Kept intentionally simple (Phase 11 CALR-01+ will build a comprehensive multi-entity calendar).
Output: Activity calendar component with FullCalendar dayGridMonth view.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-activities-and-workflow/05-RESEARCH.md

# Pattern reference (primary)
@globcrm-web/src/app/features/deals/deal-calendar/deal-calendar.component.ts
@globcrm-web/src/app/features/deals/deal-calendar/deal-calendar.component.html
@globcrm-web/src/app/features/deals/deal-calendar/deal-calendar.component.scss

# Prior plan summaries
@.planning/phases/05-activities-and-workflow/05-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Activity calendar component with FullCalendar</name>
  <files>
    globcrm-web/src/app/features/activities/activity-calendar/activity-calendar.component.ts
    globcrm-web/src/app/features/activities/activity-calendar/activity-calendar.component.html
    globcrm-web/src/app/features/activities/activity-calendar/activity-calendar.component.scss
  </files>
  <action>
    Create **activity-calendar** component following deal-calendar pattern exactly:

    **Component class (activity-calendar.component.ts):**
    - Standalone component
    - Import FullCalendarModule, CalendarOptions, EventInput, dayGridPlugin, interactionPlugin
    - Inject ActivityService, Router
    - On init: load activities via ActivityService.getList with large pageSize (200) and no pagination to get all activities for calendar display
    - Map activities to FullCalendar events:
      ```typescript
      private mapToEvents(activities: ActivityListDto[]): EventInput[] {
        return activities
          .filter(a => a.dueDate != null)
          .map(a => ({
            id: a.id,
            title: a.subject,
            date: a.dueDate!,
            backgroundColor: this.getPriorityColor(a.priority),
            borderColor: this.getPriorityColor(a.priority),
            extendedProps: {
              type: a.type,
              status: a.status,
              priority: a.priority,
              assignedToName: a.assignedToName,
            },
          }));
      }

      private getPriorityColor(priority: string): string {
        const colors: Record<string, string> = {
          Low: '#4caf50',
          Medium: '#2196f3',
          High: '#ff9800',
          Urgent: '#f44336',
        };
        return colors[priority] ?? '#757575';
      }
      ```

    - Calendar options:
      ```typescript
      calendarOptions: CalendarOptions = {
        plugins: [dayGridPlugin, interactionPlugin],
        initialView: 'dayGridMonth',
        events: [],  // populated from API
        eventClick: (info) => this.router.navigate(['/activities', info.event.id]),
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: '',  // No view switcher (Phase 5 calendar is month-only; Phase 11 adds day/week)
        },
        height: 'auto',
      };
      ```

    **View mode switcher:** Same mat-button-toggle-group. Calendar is active. List links to /activities, Kanban links to /activities/kanban.

    **Template (activity-calendar.component.html):**
    - Page header with "Activities" title, view mode switcher, and create button
    - full-calendar component with [options]="calendarOptions"
    - Loading spinner while activities load

    **Styles (activity-calendar.component.scss):**
    - Follow deal-calendar.component.scss for calendar container styling
    - Event text truncation for long subjects
    - Priority color legend below calendar (optional, small color dots with labels)
  </action>
  <verify>
    `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` succeeds.
    Activity calendar component files exist.
  </verify>
  <done>Activity calendar renders month grid with priority-colored events, click-to-navigate to detail, and view mode switcher for list/Kanban navigation.</done>
</task>

</tasks>

<verification>
- Angular build succeeds
- Calendar renders FullCalendar dayGridMonth view
- Activities mapped to events by dueDate with priority colors
- Event click navigates to /activities/:id
- View mode switcher links to list and Kanban views
- Activities without dueDate are filtered out (not displayed on calendar)
</verification>

<success_criteria>
- FullCalendar dayGridMonth reuses exact same pattern as deal calendar
- Priority-based coloring: Low=green, Medium=blue, High=orange, Urgent=red
- Click event navigates to activity detail page
- Simple month view (not over-engineered -- Phase 11 adds day/week/drag)
- View mode switcher connects all 3 views
</success_criteria>

<output>
After completion, create `.planning/phases/05-activities-and-workflow/05-09-SUMMARY.md`
</output>
