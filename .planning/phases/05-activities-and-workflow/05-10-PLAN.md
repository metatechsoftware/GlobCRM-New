---
phase: 05-activities-and-workflow
plan: 10
type: execute
wave: 7
depends_on: ["05-07", "05-08", "05-09"]
files_modified:
  - globcrm-web/src/app/features/activities/activities.routes.ts
  - globcrm-web/src/app/app.routes.ts
  - globcrm-web/src/app/shared/components/navbar/navbar.component.ts
  - globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
  - globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
  - globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
autonomous: true

must_haves:
  truths:
    - "Activities feature is accessible via /activities route with lazy loading"
    - "Navbar shows Activities link between Deals and Team"
    - "Activities tab is enabled on Company, Contact, and Deal detail pages"
    - "Entity detail Activities tab shows activities linked to that entity"
  artifacts:
    - path: "globcrm-web/src/app/features/activities/activities.routes.ts"
      provides: "Activity feature routes"
      contains: "activities"
    - path: "globcrm-web/src/app/app.routes.ts"
      provides: "Lazy-loaded activities route"
      contains: "activities"
  key_links:
    - from: "app.routes.ts"
      to: "activities.routes.ts"
      via: "lazy-loaded route"
      pattern: "loadChildren.*activities"
    - from: "navbar.component.ts"
      to: "/activities"
      via: "routerLink"
      pattern: "activities"
    - from: "company-detail.component.ts"
      to: "ActivityService"
      via: "entity-scoped activity query"
      pattern: "linkedEntityType.*Company"
---

<objective>
Wire Activities feature into the app: routes, navbar, and entity detail tab enablement.

Purpose: Complete the integration of Activities into the CRM by making it navigable, adding it to the navbar, and enabling the Activities tab on Company, Contact, and Deal detail pages (ACTV-13). This is the final plan that makes the entire feature accessible.
Output: Feature routes, app route registration, navbar link, and enabled Activities tabs on 3 entity detail pages.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-activities-and-workflow/05-RESEARCH.md

# Pattern references
@globcrm-web/src/app/features/deals/deals.routes.ts
@globcrm-web/src/app/app.routes.ts
@globcrm-web/src/app/shared/components/navbar/navbar.component.ts

# Entity detail pages (for tab enablement)
@globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
@globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
@globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts

# Prior plan summaries
@.planning/phases/05-activities-and-workflow/05-07-SUMMARY.md
@.planning/phases/05-activities-and-workflow/05-08-SUMMARY.md
@.planning/phases/05-activities-and-workflow/05-09-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Activity routes and wire into app routing and navbar</name>
  <files>
    globcrm-web/src/app/features/activities/activities.routes.ts
    globcrm-web/src/app/app.routes.ts
    globcrm-web/src/app/shared/components/navbar/navbar.component.ts
  </files>
  <action>
    Create **activities.routes.ts** following deals.routes.ts pattern:

    ```typescript
    export const ACTIVITIES_ROUTES: Routes = [
      { path: '', component: ActivityListComponent },
      { path: 'new', component: ActivityFormComponent },
      { path: 'kanban', component: ActivityKanbanComponent },
      { path: 'calendar', component: ActivityCalendarComponent },
      { path: ':id', component: ActivityDetailComponent },
      { path: ':id/edit', component: ActivityFormComponent },
    ];
    ```

    Update **app.routes.ts**:
    - Add activities route with lazy loading and authGuard:
      ```typescript
      {
        path: 'activities',
        loadChildren: () => import('./features/activities/activities.routes').then(m => m.ACTIVITIES_ROUTES),
        canActivate: [authGuard],
      },
      ```
    - Position after 'deals' route in the routes array

    Update **navbar.component.ts**:
    - Add "Activities" link to the navigation links array
    - Position: Dashboard | Companies | Contacts | Products | Deals | **Activities** | Team | Settings
    - Icon: "task_alt" (or "assignment" for task management)
    - routerLink: '/activities'
  </action>
  <verify>
    `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` succeeds.
    activities.routes.ts exists with 6 routes.
    app.routes.ts contains 'activities' route.
    navbar.component.ts contains 'Activities' link.
  </verify>
  <done>Activities feature routes are lazy-loaded via /activities path, navbar shows Activities link between Deals and Team.</done>
</task>

<task type="auto">
  <name>Task 2: Enable Activities tab on Company, Contact, and Deal detail pages</name>
  <files>
    globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
    globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
    globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
  </files>
  <action>
    For each of the 3 entity detail components, enable the Activities tab and implement entity-scoped activity listing:

    **Company Detail (company-detail.component.ts):**
    - Find the COMPANY_TABS definition (or equivalent tab configuration)
    - Set the Activities tab to `enabled: true` (was `enabled: false` / placeholder)
    - Inject ActivityService
    - When Activities tab is selected (lazy load on first tab switch): call `activityService.getList({ linkedEntityType: 'Company', linkedEntityId: companyId, page: 1, pageSize: 50 })`
    - Store results as a signal `linkedActivities: WritableSignal<ActivityListDto[]>`
    - Render activities in the tab body as a simple list/table: Subject (link to /activities/:id), Type, Status (color chip), Priority (color chip), Due Date, Assigned To
    - Add a "View All" link that navigates to /activities with linkedEntityType=Company&linkedEntityId query params (or just opens activities list -- implementation choice)

    **Contact Detail (contact-detail.component.ts):**
    - Same pattern as Company but with `linkedEntityType: 'Contact'` and contactId

    **Deal Detail (deal-detail.component.ts):**
    - Same pattern as Company but with `linkedEntityType: 'Deal'` and dealId

    **Tab content pattern (reusable across all 3):**
    The Activities tab in each entity detail should show a compact table with columns:
    - Subject (clickable, navigates to /activities/:activityId)
    - Type (chip/badge)
    - Status (color-coded chip)
    - Priority (color-coded chip)
    - Due Date
    - Assigned To

    If no linked activities: show "No activities linked" message with a "Create Activity" button (optional -- links to /activities/new).

    **Important:** Do NOT create a separate shared component for the activities tab content. Inline the template in each detail component (it's a simple table). If the template is too repetitive, extract a minimal inline helper, but do not over-engineer.
  </action>
  <verify>
    `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` succeeds.
    Company detail has Activities tab enabled.
    Contact detail has Activities tab enabled.
    Deal detail has Activities tab enabled.
  </verify>
  <done>Company, Contact, and Deal detail pages have enabled Activities tabs showing entity-linked activities with navigation to activity detail (ACTV-13).</done>
</task>

</tasks>

<verification>
- Angular build succeeds
- /activities route loads ActivityListComponent
- /activities/kanban loads ActivityKanbanComponent
- /activities/calendar loads ActivityCalendarComponent
- /activities/:id loads ActivityDetailComponent
- /activities/new and /activities/:id/edit load ActivityFormComponent
- Navbar shows "Activities" between "Deals" and "Team"
- Company detail Activities tab loads activities linked to that company
- Contact detail Activities tab loads activities linked to that contact
- Deal detail Activities tab loads activities linked to that deal
</verification>

<success_criteria>
- All 6 activity routes work with lazy loading
- Navbar link positioned correctly (ACTV-09 navigation)
- Entity detail tabs show linked activities (ACTV-13)
- Entity-scoped queries use linkedEntityType + linkedEntityId params
- Activities tab lazy-loads on first tab switch (performance)
</success_criteria>

<output>
After completion, create `.planning/phases/05-activities-and-workflow/05-10-SUMMARY.md`
</output>
