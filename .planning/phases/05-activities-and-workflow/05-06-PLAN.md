---
phase: 05-activities-and-workflow
plan: 06
type: execute
wave: 5
depends_on: ["05-04", "05-05"]
files_modified:
  - globcrm-web/src/app/features/activities/activity-list/activity-list.component.ts
  - globcrm-web/src/app/features/activities/activity-list/activity-list.component.html
  - globcrm-web/src/app/features/activities/activity-list/activity-list.component.scss
  - globcrm-web/src/app/features/activities/activity-form/activity-form.component.ts
  - globcrm-web/src/app/features/activities/activity-form/activity-form.component.html
  - globcrm-web/src/app/features/activities/activity-form/activity-form.component.scss
autonomous: true

must_haves:
  truths:
    - "Activity list page uses DynamicTable with adjustable columns showing subject, type, status, priority, due date, assigned to"
    - "Activity form allows creating and editing activities with subject, description, type, priority, due date, and assignee selection"
    - "List page has view mode switcher for list/Kanban/calendar (placeholder links for Kanban and calendar)"
  artifacts:
    - path: "globcrm-web/src/app/features/activities/activity-list/activity-list.component.ts"
      provides: "Activity list page with dynamic table"
      contains: "ActivityListComponent"
    - path: "globcrm-web/src/app/features/activities/activity-form/activity-form.component.ts"
      provides: "Activity create/edit form"
      contains: "ActivityFormComponent"
  key_links:
    - from: "activity-list.component.ts"
      to: "DynamicTableComponent"
      via: "template reference"
      pattern: "app-dynamic-table"
    - from: "activity-list.component.ts"
      to: "activity.store.ts"
      via: "component-provided store"
      pattern: "providers.*ActivityStore"
    - from: "activity-form.component.ts"
      to: "activity.service.ts"
      via: "service injection for create/update"
      pattern: "inject.*ActivityService"
---

<objective>
Create the Activity list page with DynamicTable and the Activity create/edit form.

Purpose: Implement ACTV-01 (create activities), ACTV-02 (dynamic table list), ACTV-04 (assign to users), ACTV-11 (priority levels). The list page is the primary entry point for the Activities feature.
Output: Activity list component with DynamicTable + filter panel + view sidebar, and Activity form component with full field editing.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-activities-and-workflow/05-RESEARCH.md

# Pattern references
@globcrm-web/src/app/features/deals/deal-list/deal-list.component.ts
@globcrm-web/src/app/features/deals/deal-list/deal-list.component.html
@globcrm-web/src/app/features/deals/deal-form/deal-form.component.ts
@globcrm-web/src/app/features/deals/deal-form/deal-form.component.html

# Prior plan summaries
@.planning/phases/05-activities-and-workflow/05-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Activity list component with DynamicTable</name>
  <files>
    globcrm-web/src/app/features/activities/activity-list/activity-list.component.ts
    globcrm-web/src/app/features/activities/activity-list/activity-list.component.html
    globcrm-web/src/app/features/activities/activity-list/activity-list.component.scss
  </files>
  <action>
    Create **activity-list** component following deal-list pattern:

    **Component class (activity-list.component.ts):**
    - Standalone component with providers: [ActivityStore]
    - Inject ActivityStore, Router, ActivatedRoute, CustomFieldService, PermissionStore
    - Define default columns: Subject (text), Type (text), Status (text), Priority (text), Due Date (date), Assigned To (text), Owner (text), Created At (date)
    - Load custom field definitions for 'Activity' entity type on init
    - Connect store signals (items, totalCount, isLoading, page, pageSize, sortBy, sortDir, filters) to DynamicTable
    - Handle row click -> navigate to activity detail (/activities/:id)
    - Handle create button -> navigate to activity form (/activities/new)
    - Wire up ViewSidebar for saved views
    - Wire up FilterPanel with adaptive operators

    **View mode switcher:** Add a mat-button-toggle-group at the top for List | Kanban | Calendar (same pattern as deal-list). List is the active/default mode. Kanban links to /activities/kanban, Calendar links to /activities/calendar. These are placeholder routerLinks until those components are built.

    **Permission enforcement:**
    - Create button guarded by `*appHasPermission="'Activity:Create'"`
    - Delete action guarded by Activity:Delete permission

    **Template (activity-list.component.html):**
    - Page header with "Activities" title and view mode switcher
    - Create button with mat-icon "add"
    - DynamicTable with columns, sort, pagination
    - FilterPanel with filter chips
    - ViewSidebar

    **Styles (activity-list.component.scss):**
    - Follow deal-list.component.scss pattern for layout, header, table container
  </action>
  <verify>
    `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` succeeds.
    Activity list component files exist.
  </verify>
  <done>Activity list page renders DynamicTable with adjustable columns, view mode switcher, filter panel, and saved views sidebar following deal-list conventions.</done>
</task>

<task type="auto">
  <name>Task 2: Create Activity form component</name>
  <files>
    globcrm-web/src/app/features/activities/activity-form/activity-form.component.ts
    globcrm-web/src/app/features/activities/activity-form/activity-form.component.html
    globcrm-web/src/app/features/activities/activity-form/activity-form.component.scss
  </files>
  <action>
    Create **activity-form** component following deal-form pattern:

    **Component class (activity-form.component.ts):**
    - Standalone component
    - Inject ActivatedRoute, Router, ActivityService, MatSnackBar, ProfileService (for team directory / assignee dropdown)
    - Detect create vs edit mode from route params (route.params 'id' -- 'new' = create, GUID = edit)
    - On edit: load activity via ActivityService.getById, populate form
    - Load team directory for assignee dropdown (ProfileService.getTeamDirectory with pageSize 100)

    **Reactive form fields:**
    - subject (string, required, Validators.required + Validators.minLength(3) + Validators.maxLength(500))
    - description (string, optional, textarea)
    - type (ActivityType, required, mat-select with ACTIVITY_TYPES options)
    - priority (ActivityPriority, required, mat-select with ACTIVITY_PRIORITIES options)
    - dueDate (Date, optional, mat-datepicker with provideNativeDateAdapter at component level)
    - assignedToId (string/null, optional, mat-select populated from team directory)
    - customFields (loaded via CustomFieldService for 'Activity' entity type, rendered via existing CustomFieldFormComponent pattern)

    **On submit:**
    - Create mode: Call activityService.create(request). On success, navigate to /activities/:newId (detail page). Show snackbar "Activity created".
    - Edit mode: Call activityService.update(id, request). On success, navigate to /activities/:id. Show snackbar "Activity updated".
    - On error: Show error snackbar.

    **Template (activity-form.component.html):**
    - Page header: "New Activity" (create) or "Edit Activity" (edit) with back button
    - Form in mat-card with sections:
      - Core fields: Subject (mat-form-field), Type (mat-select), Priority (mat-select), Due Date (mat-datepicker), Assigned To (mat-select with user list)
      - Description: mat-form-field with textarea, matTextareaAutosize
      - Custom fields section (if any custom fields defined for Activity entity)
    - Save and Cancel buttons at bottom

    **Styles (activity-form.component.scss):**
    - Follow deal-form.component.scss for form layout, mat-card styling, field grid
  </action>
  <verify>
    `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` succeeds.
    Activity form component files exist.
  </verify>
  <done>Activity form supports creating and editing activities with all core fields, assignee selection from team directory, and custom field rendering (ACTV-01, ACTV-04, ACTV-11, ACTV-14).</done>
</task>

</tasks>

<verification>
- Angular build succeeds
- Activity list renders DynamicTable with 8 default columns
- View mode switcher shows List/Kanban/Calendar toggle
- Activity form validates subject (3-500 chars) and renders type/priority/assignee dropdowns
- Custom fields loaded and rendered for Activity entity type
</verification>

<success_criteria>
- List page matches deal-list pattern: DynamicTable + FilterPanel + ViewSidebar
- Form supports create and edit with all ACTV-01 fields
- Assignee dropdown loads from team directory (ACTV-04)
- Priority selector with Low/Medium/High/Urgent (ACTV-11)
- Custom fields section renders if definitions exist (ACTV-14)
- View mode switcher ready for Kanban/Calendar navigation
</success_criteria>

<output>
After completion, create `.planning/phases/05-activities-and-workflow/05-06-SUMMARY.md`
</output>
