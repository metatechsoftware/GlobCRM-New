---
phase: 31-quote-pdf-templates
plan: 04
type: execute
wave: 4
depends_on: ["31-02", "31-03"]
files_modified:
  - globcrm-web/src/app/features/quote-templates/quote-template-list/quote-template-list.component.ts
  - globcrm-web/src/app/features/quote-templates/quote-template-list/quote-template-list.component.html
  - globcrm-web/src/app/features/quote-templates/quote-template-list/quote-template-list.component.scss
  - globcrm-web/src/app/features/quote-templates/quote-templates.routes.ts
  - globcrm-web/src/app/app.routes.ts
  - globcrm-web/src/app/features/settings/settings-hub/settings-hub.component.ts
  - globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts
  - globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html
autonomous: true
requirements:
  - QTPL-06
  - QTPL-07
  - QTPL-08
  - QTPL-12

must_haves:
  truths:
    - "User can see a card grid of templates with thumbnail previews, names, and default badge"
    - "User can clone a template (instant copy with '[Original] (Copy)' name)"
    - "User can set a template as default for new quotes"
    - "User can delete a template with confirmation"
    - "User can navigate to quote templates from Settings hub and from quote detail page"
  artifacts:
    - path: "globcrm-web/src/app/features/quote-templates/quote-template-list/quote-template-list.component.ts"
      provides: "Card grid template list with thumbnails and actions"
      contains: "QuoteTemplateListComponent"
    - path: "globcrm-web/src/app/features/quote-templates/quote-templates.routes.ts"
      provides: "Lazy-loaded routes for template list and editor"
      contains: "QUOTE_TEMPLATE_ROUTES"
  key_links:
    - from: "globcrm-web/src/app/app.routes.ts"
      to: "quote-templates.routes.ts"
      via: "loadChildren lazy import"
      pattern: "quote-templates"
    - from: "globcrm-web/src/app/features/quote-templates/quote-template-list/quote-template-list.component.ts"
      to: "QuoteTemplateStore"
      via: "Injected store for template list state"
      pattern: "QuoteTemplateStore"
    - from: "globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html"
      to: "/quote-templates"
      via: "routerLink for 'Manage Templates' shortcut"
      pattern: "quote-templates"
---

<objective>
Create the template management list page with card grid layout, thumbnail previews, clone/delete/set-default actions, set up lazy-loaded routes, add navigation from Settings hub and quote detail page.

Purpose: Users need to browse, manage, and organize their templates. The card grid with thumbnails provides visual identification (QTPL-08). Settings hub integration makes templates discoverable (QTPL-12). Quote detail shortcut enables quick access during quote workflow.

Output: Template list component, routes, settings hub integration, quote detail shortcut
</objective>

<execution_context>
@C:/Users/maliy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/maliy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/31-quote-pdf-templates/31-CONTEXT.md
@.planning/phases/31-quote-pdf-templates/31-RESEARCH.md
@.planning/phases/31-quote-pdf-templates/31-02-SUMMARY.md

# Existing patterns
@globcrm-web/src/app/features/email-templates/email-template-list/email-template-list.component.ts
@globcrm-web/src/app/features/email-templates/email-template-list/email-template-list.component.html
@globcrm-web/src/app/features/email-templates/email-templates.routes.ts
@globcrm-web/src/app/app.routes.ts
@globcrm-web/src/app/features/settings/settings-hub/settings-hub.component.ts
@globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts
@globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template list component with card grid and management actions</name>
  <files>
    globcrm-web/src/app/features/quote-templates/quote-template-list/quote-template-list.component.ts
    globcrm-web/src/app/features/quote-templates/quote-template-list/quote-template-list.component.html
    globcrm-web/src/app/features/quote-templates/quote-template-list/quote-template-list.component.scss
  </files>
  <action>
Create the template list page as a card grid following the CONTEXT.md decision for "card grid layout with thumbnail previews."

**Component (.ts):**
- Standalone, OnPush, inject QuoteTemplateStore, Router, MatSnackBar, MatDialog (for delete confirmation), TranslocoService
- ngOnInit: store.loadTemplates()
- Methods:
  * `editTemplate(id: string)`: navigate to /quote-templates/edit/{id}
  * `createTemplate()`: navigate to /quote-templates/new
  * `cloneTemplate(id: string)`: call store.cloneTemplate(id, () => snackbar success). Per CONTEXT.md: "Clone creates instant copy with name '[Original] (Copy)' -- no dialog, user can rename from the list"
  * `setDefault(id: string)`: call store.setDefault(id, () => snackbar success)
  * `deleteTemplate(id: string)`: show Material confirm dialog, on confirm call store.deleteTemplate(id, () => snackbar success)
  * `getThumbnailUrl(template)`: return template.thumbnailUrl or null

**Template (.html):**
- Page header: "Quote Templates" title with create button (mat-raised-button, orange primary)
- Empty state: when store.templates().length === 0 and !store.loading(), show centered message with Fraunces italic heading "No templates yet", description text, and "Create Template" button. Follow design system empty state pattern.
- Card grid: CSS grid, responsive (3 columns on xl, 2 on lg, 1 on sm)
- Each card:
  * Thumbnail area (aspect-ratio ~1:1.414 for A4): `<img>` if thumbnailUrl exists, fallback placeholder div with mat-icon "description"
  * Card info section below thumbnail: template name (text-primary, Plus Jakarta Sans 600), "Last modified: {date}" (text-muted), default badge (orange chip) if isDefault
  * Three-dot menu (mat-icon-button with matMenuTriggerFor): Edit, Clone, Set as Default (hidden if already default), Delete
  * Card is clickable (entire card navigates to edit)
  * Hover: border-hover + translateY(-2px) + shadow-md (per design system card pattern)

**Styles (.scss):**
- `.template-grid`: display grid, grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)), gap 20px, padding 24px
- `.template-card`: bg-card, border-subtle, radius-lg (14px), overflow hidden, cursor pointer, transition (0.25s ease). Hover: border-hover, translateY(-2px), shadow-md
- `.thumbnail-wrapper`: aspect-ratio 210/297 (A4), overflow hidden, bg-elevated. `img`: width 100%, height 100%, object-fit cover
- `.thumbnail-placeholder`: same aspect ratio, display flex, align-items center, justify-content center, bg-elevated, text-faint icon
- `.card-info`: padding 16px, display flex, flex-direction column, gap 4px
- `.template-name`: font-weight 600, color text-primary, font-family Plus Jakarta Sans
- `.template-meta`: font-size 0.75rem, color text-muted
- `.default-badge`: display inline-flex, background orange-glow, color orange-500, font-size 0.7rem, padding 2px 8px, border-radius full, font-weight 500, font-family JetBrains Mono, text-transform uppercase, letter-spacing 0.05em
- Use CSS custom properties from tokens.css for all colors
  </action>
  <verify>
    Files exist and have proper structure. Component imports are correct. Card grid uses CSS grid with responsive columns.
  </verify>
  <done>
    Template list shows card grid with thumbnail previews, name, modified date, default badge. Clone, set-default, delete, edit actions available via three-dot menu. Empty state with create prompt shown when no templates exist.
  </done>
</task>

<task type="auto">
  <name>Task 2: Set up routes, navigation integration, and quote detail shortcut</name>
  <files>
    globcrm-web/src/app/features/quote-templates/quote-templates.routes.ts
    globcrm-web/src/app/app.routes.ts
    globcrm-web/src/app/features/settings/settings-hub/settings-hub.component.ts
    globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts
    globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html
  </files>
  <action>
1. Create `quote-templates.routes.ts`:
   ```typescript
   import { Routes } from '@angular/router';
   import { QuoteTemplateStore } from './quote-template.store';

   export const QUOTE_TEMPLATE_ROUTES: Routes = [
     {
       path: '',
       providers: [QuoteTemplateStore],
       children: [
         {
           path: '',
           loadComponent: () =>
             import('./quote-template-list/quote-template-list.component').then(
               (m) => m.QuoteTemplateListComponent
             ),
         },
         {
           path: 'new',
           loadComponent: () =>
             import('./quote-template-editor/quote-template-editor.component').then(
               (m) => m.QuoteTemplateEditorComponent
             ),
         },
         {
           path: 'edit/:id',
           loadComponent: () =>
             import('./quote-template-editor/quote-template-editor.component').then(
               (m) => m.QuoteTemplateEditorComponent
             ),
         },
       ],
     },
   ];
   ```
   Note: QuoteTemplateStore provided at route level (shared between list and editor, per BoardStore pattern from Phase 30).

2. Add route to `app.routes.ts`:
   - Add lazy-loaded route for 'quote-templates' path
   - Guard with authGuard and permissionGuard('Quote', 'View') -- using Quote permission since templates are part of quotes feature
   - Place after email-templates route for consistency:
   ```typescript
   {
     path: 'quote-templates',
     canActivate: [authGuard, permissionGuard('Quote', 'View')],
     loadChildren: () =>
       import('./features/quote-templates/quote-templates.routes').then(
         (m) => m.QUOTE_TEMPLATE_ROUTES
       ),
   },
   ```

3. Add "Quote Templates" card to Settings hub:
   - Read the existing settings-hub.component.ts to understand the settings sections data model
   - Add a new entry in the Quotes-related section (or create one if needed): icon "description", title/titleKey "Quote Templates", description/descriptionKey "Design and manage custom PDF templates for quotes", route "/quote-templates"
   - This addresses QTPL-12 ("primary location under Settings > Quote Templates")

4. Add "Manage Templates" shortcut link to quote detail page:
   - Read quote-detail.component.ts and .html to understand current layout
   - Add a small text button/link near the PDF generation area (or in the action toolbar): "Manage Templates" with routerLink to /quote-templates
   - Per CONTEXT.md: "with a 'Manage Templates' shortcut link from the quote detail page"
   - Also update the existing "Download PDF" button area to include a template selector (mat-select) that lets user choose which template to use for PDF generation, defaulting to the default template or "Built-in (QuestPDF)" if no templates exist
   - The template selector fetches available templates on init using QuoteTemplateService.getAll()
  </action>
  <verify>
    `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -15` -- should compile. Verify routes file exists and app.routes.ts has quote-templates entry.
  </verify>
  <done>
    Routes configured: /quote-templates (list), /quote-templates/new (create), /quote-templates/edit/:id (edit). App.routes.ts has lazy-loaded entry with auth guards. Settings hub has "Quote Templates" card. Quote detail page has "Manage Templates" link and template selector for PDF generation.
  </done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration development` compiles
2. Navigating to /quote-templates shows the card grid list
3. Card grid shows thumbnail, name, last modified, default badge
4. Three-dot menu provides Edit, Clone, Set as Default, Delete actions
5. /quote-templates/new opens the editor (from Plan 03)
6. /quote-templates/edit/:id opens editor with existing template loaded
7. Settings hub includes "Quote Templates" card
8. Quote detail page has "Manage Templates" link and template selector
</verification>

<success_criteria>
- Template list page renders with responsive card grid
- All CRUD actions (create via button, edit via click/menu, clone, delete, set-default) are functional
- Routes properly lazy-loaded with auth guards
- Settings hub and quote detail page have navigation to templates
- Empty state displays when no templates exist
</success_criteria>

<output>
After completion, create `.planning/phases/31-quote-pdf-templates/31-04-SUMMARY.md`
</output>
