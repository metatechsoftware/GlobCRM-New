---
phase: 03-core-crm-entities
plan: 08
type: execute
wave: 4
depends_on: ["03-02", "03-05"]
files_modified:
  - globcrm-web/src/app/features/products/products.routes.ts
  - globcrm-web/src/app/features/products/product-list/product-list.component.ts
  - globcrm-web/src/app/features/products/product-list/product-list.component.html
  - globcrm-web/src/app/features/products/product-detail/product-detail.component.ts
  - globcrm-web/src/app/features/products/product-form/product-form.component.ts
autonomous: true

must_haves:
  truths:
    - "User can see a list of products in a dynamic table"
    - "User can create a product with name, description, unit price, SKU, and category"
    - "User can view, edit, and delete products"
    - "Product list shows unit price formatted as currency"
    - "Products can be activated/deactivated"
  artifacts:
    - path: "globcrm-web/src/app/features/products/product-list/product-list.component.ts"
      provides: "Product list page with DynamicTableComponent"
      contains: "ProductListComponent"
    - path: "globcrm-web/src/app/features/products/product-detail/product-detail.component.ts"
      provides: "Product detail page (simpler, no timeline or relational tabs)"
      contains: "ProductDetailComponent"
    - path: "globcrm-web/src/app/features/products/product-form/product-form.component.ts"
      provides: "Product create/edit form with price, SKU, category fields"
      contains: "ProductFormComponent"
    - path: "globcrm-web/src/app/features/products/products.routes.ts"
      provides: "Lazy-loaded routes for products"
      contains: "PRODUCT_ROUTES"
  key_links:
    - from: "product-list.component.ts"
      to: "ProductStore"
      via: "Component-provided signal store"
      pattern: "inject.*ProductStore"
    - from: "product-form.component.ts"
      to: "ProductService"
      via: "CRUD operations"
      pattern: "ProductService"
---

<objective>
Build the complete Product feature UI: list page, detail page, and create/edit form. Products are simpler than Companies/Contacts -- no timeline, no relational navigation, but with price/SKU/category fields that prepare for Phase 6 quote line items.

Purpose: Implements PROD-01 through PROD-04. Products establish the pattern for simpler entities and ensure they're selectable as line items when quotes are built in Phase 6.

Output: Product list page, detail page, form component, and feature routes.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-crm-entities/03-RESEARCH.md
@.planning/phases/03-core-crm-entities/03-02-SUMMARY.md
@.planning/phases/03-core-crm-entities/03-05-SUMMARY.md
@.planning/phases/03-core-crm-entities/03-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProductListComponent with dynamic table</name>
  <files>
    globcrm-web/src/app/features/products/product-list/product-list.component.ts
    globcrm-web/src/app/features/products/product-list/product-list.component.html
    globcrm-web/src/app/features/products/products.routes.ts
  </files>
  <action>
**ProductListComponent** -- same pattern as CompanyListComponent but with product-specific columns:

Standalone component with providers: [ViewStore, ProductStore].

**Core columns:**
- name: Product name
- sku: SKU code
- category: Category
- unitPrice: Unit price (formatted as currency -- use CurrencyPipe or custom cell renderer)
- isActive: Active status (mat-chip or icon: green checkmark for active, red X for inactive)
- createdAt: Created date

The unitPrice column should display with currency formatting. If DynamicTableComponent supports custom cell rendering via a pipe or template, use CurrencyPipe. Otherwise, format the value in the data before passing to the table.

**Default visible columns:** name, sku, category, unitPrice, isActive, createdAt

**Column definitions merge:** Core product columns + custom fields from CustomFieldService.getFieldsByEntityType('Product').

**Template:** Same layout as company/contact list:
- View sidebar for 'Product' entity type
- Header: "Products" + "New Product" button (*appHasPermission="'Product:Create'")
- Filter chips + filter panel
- Dynamic table

**products.routes.ts:**
```typescript
export const PRODUCT_ROUTES: Routes = [
  { path: '', component: ProductListComponent },
  { path: 'new', loadComponent: () => import('./product-form/product-form.component').then(m => m.ProductFormComponent) },
  { path: ':id', loadComponent: () => import('./product-detail/product-detail.component').then(m => m.ProductDetailComponent) },
  { path: ':id/edit', loadComponent: () => import('./product-form/product-form.component').then(m => m.ProductFormComponent) },
];
```
  </action>
  <verify>`cd globcrm-web && npx ng build --configuration development 2>&1 | tail -10` compiles</verify>
  <done>ProductListComponent renders dynamic table with unit price as currency, SKU, category, active status columns</done>
</task>

<task type="auto">
  <name>Task 2: Create ProductDetailComponent and ProductFormComponent</name>
  <files>
    globcrm-web/src/app/features/products/product-detail/product-detail.component.ts
    globcrm-web/src/app/features/products/product-form/product-form.component.ts
  </files>
  <action>
**ProductDetailComponent:**
Simpler than Company/Contact detail -- no timeline, no relational tabs.

Standalone component. Inject: ActivatedRoute, Router, ProductService, PermissionStore.

**Layout:**
```
Header: Back to Products + Product Name + [Edit] [Delete] buttons + Active/Inactive badge
Subheader: SKU | Category | Unit Price (formatted)

Content (no tabs needed -- just a single detail view):
  Core fields card:
    - Name, Description, SKU, Category, Unit Price, Active Status
    - Created at, Updated at
  Custom fields card:
    - app-custom-field-form [entityType]="'Product'" [readonly]="true" [customFieldValues]="product.customFields"
```

No timeline sidebar. No tab group.

Edit button: *appHasPermission="'Product:Edit'" routerLink="edit"
Delete button: *appHasPermission="'Product:Delete'" with confirmation dialog
Active/Inactive badge: mat-chip with appropriate color (green/red)

**ProductFormComponent:**
Standalone component for create and edit.

**Form fields:**
- name: ['', [Validators.required, Validators.maxLength(200)]]
- description: ['']
- unitPrice: [0, [Validators.required, Validators.min(0)]] -- use input type="number" with step="0.01"
- sku: ['', [Validators.maxLength(50)]]
- category: ['']
- isActive: [true] -- only shown in edit mode (new products default to active)

**Template:**
```html
<form [formGroup]="productForm" (ngSubmit)="onSubmit()">
  <div class="form-grid">
    <mat-form-field>
      <mat-label>Product Name</mat-label>
      <input matInput formControlName="name" required>
      <mat-error>Product name is required</mat-error>
    </mat-form-field>

    <mat-form-field>
      <mat-label>Unit Price</mat-label>
      <span matPrefix>$ &nbsp;</span>
      <input matInput type="number" formControlName="unitPrice" step="0.01" min="0" required>
      <mat-error>Valid price is required</mat-error>
    </mat-form-field>

    <mat-form-field>
      <mat-label>SKU</mat-label>
      <input matInput formControlName="sku">
    </mat-form-field>

    <mat-form-field>
      <mat-label>Category</mat-label>
      <input matInput formControlName="category">
    </mat-form-field>

    <mat-form-field>
      <mat-label>Description</mat-label>
      <textarea matInput formControlName="description" rows="3"></textarea>
    </mat-form-field>

    @if (isEditMode) {
      <mat-checkbox formControlName="isActive">Active</mat-checkbox>
    }
  </div>

  <!-- Custom fields -->
  <app-custom-field-form
    [entityType]="'Product'"
    [customFieldValues]="existingCustomFields"
    (valuesChanged)="onCustomFieldsChanged($event)" />

  <div class="form-actions">
    <button mat-button type="button" routerLink="/products">Cancel</button>
    <button mat-raised-button color="primary" type="submit"
            [disabled]="productForm.invalid || isSaving()">
      {{ isEditMode ? 'Save Changes' : 'Create Product' }}
    </button>
  </div>
</form>
```

Submit: Same create/update/navigate pattern as Company/Contact forms.
  </action>
  <verify>`cd globcrm-web && npx ng build --configuration development 2>&1 | tail -10` compiles</verify>
  <done>ProductDetailComponent shows product info with custom fields (no timeline, no tabs). ProductFormComponent handles create/edit with unit price, SKU, category, active status, and custom fields.</done>
</task>

</tasks>

<verification>
- All product feature files exist in features/products/
- Product list shows unit price as currency
- Product detail is a simple card layout (no tabs, no timeline)
- Product form has unit price with $ prefix, SKU, category
- Edit mode shows isActive checkbox
- Routes: /products, /products/new, /products/:id, /products/:id/edit
- ng build compiles
</verification>

<success_criteria>
- PROD-01: CRUD via form and list (create, view, edit, delete)
- PROD-02: List page uses DynamicTableComponent with adjustable columns
- PROD-03: Form captures name, description, unit price, SKU, and category
- PROD-04: Custom fields render via CustomFieldFormComponent
- PROD-05 prep: Products have UnitPrice and IsActive ready for quote line items in Phase 6
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-crm-entities/03-08-SUMMARY.md`
</output>
