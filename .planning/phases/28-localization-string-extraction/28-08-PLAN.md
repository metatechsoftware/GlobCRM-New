---
phase: 28-localization-string-extraction
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - globcrm-web/src/assets/i18n/settings/en.json
  - globcrm-web/src/assets/i18n/settings/tr.json
  - globcrm-web/src/app/features/settings/custom-fields/custom-field-edit-dialog.component.html
  - globcrm-web/src/app/features/settings/custom-fields/formula-editor/formula-editor.component.html
  - globcrm-web/src/app/features/settings/pipelines/pipeline-edit.component.ts
  - globcrm-web/src/app/features/settings/webhooks/webhook-list.component.ts
  - globcrm-web/src/app/features/settings/webhooks/webhook-detail.component.ts
  - globcrm-web/src/app/features/settings/webhooks/webhook-edit.component.ts
  - globcrm-web/src/app/features/settings/webhooks/webhook-delivery-log.component.ts
  - globcrm-web/src/app/features/settings/webhooks/webhook-test-dialog.component.ts
  - globcrm-web/src/app/features/settings/duplicate-rules/duplicate-rules.component.ts
  - globcrm-web/src/app/features/settings/email-accounts/email-account-settings.component.ts
  - globcrm-web/src/app/features/settings/notification-preferences/notification-preferences.component.ts
  - globcrm-web/src/app/features/settings/language/language-settings.component.ts
  - globcrm-web/src/app/features/settings/teams/team-edit.component.ts
autonomous: true
gap_closure: true
requirements:
  - LOCL-03
  - LOCL-10
must_haves:
  truths:
    - "Settings > Webhooks page renders all labels in Turkish when language is switched"
    - "Settings > Pipelines > Edit Pipeline renders form labels in Turkish"
    - "Settings > Custom Fields > Edit dialog renders all 43 field labels in Turkish"
    - "Settings > Duplicate Rules page renders all labels in Turkish"
    - "Settings > Email Accounts page renders all labels in Turkish"
    - "Settings > Notification Preferences page renders all labels in Turkish"
  artifacts:
    - path: "globcrm-web/src/assets/i18n/settings/en.json"
      provides: "Extended settings scope with webhooks, customFields (edit dialog + formula editor), pipelines (edit), duplicateRules, emailAccounts, notifications, language, teams keys"
      contains: "webhooks.deliveryLog"
    - path: "globcrm-web/src/assets/i18n/settings/tr.json"
      provides: "Turkish translations matching all new EN keys"
      contains: "webhooks.deliveryLog"
  key_links:
    - from: "custom-field-edit-dialog.component.html"
      to: "settings/en.json"
      via: "transloco pipe referencing settings.customFields.editDialog.* keys"
      pattern: "customFields\\.editDialog"
    - from: "pipeline-edit.component.ts"
      to: "settings/en.json"
      via: "transloco pipe referencing settings.pipelines.edit.* keys"
      pattern: "pipelines\\.edit"
    - from: "webhook-list.component.ts"
      to: "settings/en.json"
      via: "transloco pipe referencing settings.webhooks.list.* keys"
      pattern: "webhooks\\.list"
---

<objective>
Extract all 198 hardcoded strings from settings sub-page templates into the existing settings translation scope EN/TR JSON files, and wire transloco pipe in every template.

Purpose: Close the largest gap cluster (198/347 baseline entries) in settings sub-pages that were marked as "TranslocoPipe imported but templates not fully rewritten" in plan 28-06.

Output: All settings sub-page components render in Turkish when language is switched. Settings scope JSON files extended with ~150 new keys.
</objective>

<execution_context>
@C:/Users/maliy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/maliy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/28-localization-string-extraction/28-CONTEXT.md
@.planning/phases/28-localization-string-extraction/28-RESEARCH.md
@.planning/phases/28-localization-string-extraction/28-VERIFICATION.md
@.planning/phases/28-localization-string-extraction/28-06-SUMMARY.md
@globcrm-web/src/assets/i18n/settings/en.json
@globcrm-web/src/assets/i18n/settings/tr.json
@globcrm-web/scripts/i18n-baseline.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire transloco in webhooks + custom-fields + formula-editor + pipelines templates (154 strings)</name>
  <files>
    globcrm-web/src/assets/i18n/settings/en.json
    globcrm-web/src/assets/i18n/settings/tr.json
    globcrm-web/src/app/features/settings/custom-fields/custom-field-edit-dialog.component.html
    globcrm-web/src/app/features/settings/custom-fields/formula-editor/formula-editor.component.html
    globcrm-web/src/app/features/settings/pipelines/pipeline-edit.component.ts
    globcrm-web/src/app/features/settings/webhooks/webhook-list.component.ts
    globcrm-web/src/app/features/settings/webhooks/webhook-detail.component.ts
    globcrm-web/src/app/features/settings/webhooks/webhook-edit.component.ts
    globcrm-web/src/app/features/settings/webhooks/webhook-delivery-log.component.ts
    globcrm-web/src/app/features/settings/webhooks/webhook-test-dialog.component.ts
  </files>
  <action>
    This task covers the 4 largest settings sub-page clusters: webhooks (60 strings across 5 files), custom-fields (59 strings across 2 files), pipelines (34 strings in 1 file).

    **Step 1: Extend settings/en.json with new key sections.**

    Add the following nested sections to settings/en.json (under existing structure):

    - `webhooks.list` — keys for webhook-list.component.ts template: title ("Webhooks"), subtitle, breadcrumb ("Settings"), empty state ("No webhooks configured"), loading, tooltips (Edit, Delete)
    - `webhooks.detail` — keys for webhook-detail.component.ts template: title ("Subscription Details"), subtitle, delivery logs table headers (Event, Status, HTTP Code, Timestamp, Duration, Error Message, Attempt Number, Request Payload, Response Body, Actions), empty state, disabled warning, retry tooltip, "Never" text
    - `webhooks.edit` — keys for webhook-edit.component.ts template: title ("Webhook Details"), breadcrumb ("Webhooks"), name label, name placeholder, endpoint URL, payload checkbox, secret section title/warning, entity label, event subscriptions section, copy tooltip, at least one event required
    - `webhooks.deliveryLog` — keys for webhook-delivery-log.component.ts: title ("Delivery Logs"), subtitle, filter label, all subscriptions, table headers (same as detail but dedicated), empty state, retry tooltip
    - `webhooks.testDialog` — keys for webhook-test-dialog.component.ts: title ("Test Webhook"), cancel, close, success message
    - `customFields.editDialog` — keys for custom-field-edit-dialog: all 43 strings including Basic Information, Label, Field Type, Section, Sort Order, Required, Unique, Options (Value, Color, Remove, Move Up, Move Down), Validation Rules, Text Validation (Min/Max Length, Regex Pattern), Number Validation (Min/Max Value), Related Entity Type (Relation Target), Formula Configuration, Result Type, Cancel, placeholder text
    - `customFields.formulaEditor` — keys for formula-editor: Formula Expression, Preview, Available Functions, Examples, Evaluating, Enter a formula text, No matching fields, all 4 example comments (Full name, Weighted deal value, Days to close, Value if won), function category labels (Arithmetic operators, Conditional logic, Days between dates, Join text values)
    - `pipelines.edit` — keys for pipeline-edit: breadcrumb ("Pipelines"), Pipeline Details, Pipeline Name, Description, placeholder, stages section title, Add stages hint, Stage Name, Probability %, Color, Required Fields checkboxes (Deal Value, Expected Close Date, Company, Owner, Probability, Won, Lost), No stages defined, Cancel, loading, error, Remove stage tooltip

    **Step 2: Create matching Turkish translations in settings/tr.json.**

    Use formal business Turkish ("siz" form). Keep common English loanwords (Pipeline, Webhook, etc.) per CONTEXT.md decisions. Turkish translations for key terms:
    - Webhook -> Webhook (loanword)
    - Pipeline -> Pipeline (loanword)
    - Custom Fields -> Ozel Alanlar
    - Formula -> Formul
    - Delivery -> Teslimat
    - Subscription -> Abonelik
    - Stage -> Asama
    - Probability -> Olasilik
    - Duplicate Rules -> Kopya Kurallari
    - Notifications -> Bildirimler

    **Step 3: Wire transloco pipe in each template.**

    For each file, replace every hardcoded string with `{{ 'keyPath' | transloco }}` or `[attr]="'keyPath' | transloco"` depending on context.

    Since these components are under the settings route scope, use scoped keys (e.g., `{{ 'webhooks.list.title' | transloco }}` resolves to `settings.webhooks.list.title`).

    For mat-label elements: convert `<mat-label>Text</mat-label>` to `<mat-label>{{ 'key' | transloco }}</mat-label>`.
    For [matTooltip]: convert `matTooltip="Text"` to `[matTooltip]="'key' | transloco"`.
    For [placeholder]: convert `placeholder="Text"` to `[placeholder]="'key' | transloco"`.
    For [checkbox] labels: convert inline text to `{{ 'key' | transloco }}`.
    For aria-label: convert `aria-label="Text"` to `[attr.aria-label]="'key' | transloco"`.

    Ensure TranslocoPipe is in each component's `imports` array (28-06 already added it to most — verify and add if missing).

    **IMPORTANT:** Do NOT translate dynamic data values (entity names, URLs, user data). Only translate static UI chrome strings.
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Grep for remaining hardcoded strings in these files: `node -e "const b=require('./scripts/i18n-baseline.json'); console.log(b.known.filter(e=>e.includes('settings/')).length)"` — should be significantly reduced from 198
  </verify>
  <done>All 154 hardcoded strings in webhooks (5 files), custom-fields (2 files), and pipelines (1 file) templates replaced with transloco pipe references, settings EN/TR JSON extended with corresponding keys.</done>
</task>

<task type="auto">
  <name>Task 2: Wire transloco in duplicate-rules, email-accounts, notification-preferences, language, teams templates (44 strings)</name>
  <files>
    globcrm-web/src/assets/i18n/settings/en.json
    globcrm-web/src/assets/i18n/settings/tr.json
    globcrm-web/src/app/features/settings/duplicate-rules/duplicate-rules.component.ts
    globcrm-web/src/app/features/settings/email-accounts/email-account-settings.component.ts
    globcrm-web/src/app/features/settings/notification-preferences/notification-preferences.component.ts
    globcrm-web/src/app/features/settings/language/language-settings.component.ts
    globcrm-web/src/app/features/settings/teams/team-edit.component.ts
  </files>
  <action>
    This task covers the remaining 5 settings sub-pages with smaller string counts.

    **Step 1: Extend settings/en.json with remaining sections.**

    - `duplicateRules` — if section already exists from 28-06, extend it. Keys needed: title ("Duplicate Detection Rules"), subtitle ("Configure how the system detects..."), Settings heading, fields section (Name, Email, Company Name, Website/Domain), field descriptions (First and last name comparison, Match by email..., Primary name..., Compare website...), Matching Fields, Enable auto-detection checkbox, Similarity Threshold label, Required
    - `emailAccounts` — keys: title ("Email Account"), subtitle, breadcrumb ("Settings"), Gmail Connected, Sync Status, Last Synced, Loading account status, No Gmail account connected
    - `notifications` — keys: title ("Notification Preferences"), subtitle ("Choose how you receive..."), breadcrumb ("Settings"), Notification Channels, channel toggle hint, In-App, Email
    - `language` — check if keys already exist. Baseline shows: Default Language, Language, Set the default language..., mat-label Default Language. These may overlap with existing `language` section — extend only if missing.
    - `teams.edit` — keys: Add Team Member, Search users (label + placeholder), Close, No users found

    **Step 2: Create matching Turkish translations in settings/tr.json.**

    Turkish for these sections:
    - Duplicate Detection Rules -> Kopya Tespit Kurallari
    - Similarity Threshold -> Benzerlik Esigi
    - Email Account -> E-posta Hesabi
    - Notification Preferences -> Bildirim Tercihleri
    - In-App -> Uygulama Ici
    - Team Member -> Takim Uyesi

    **Step 3: Wire transloco pipe in each template.**

    Same pattern as Task 1. For inline-template components (.ts files), verify TranslocoPipe is in the `imports` array and replace all hardcoded strings in the template literal.

    For duplicate-rules.component.ts: The component has a complex inline template with conditional sections. Replace all 16 hardcoded strings with scoped transloco keys. The `= 70 && config.similarityThreshold` baseline entry appears to be a false positive from the CI script's text extraction — verify if it's actually a hardcoded string or a template expression.

    For language-settings.component.ts: 4 strings baselined. Check if these overlap with existing `settings.language.*` keys. If keys exist but aren't referenced in template, wire the pipe. If keys missing, add them.
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Run `cd globcrm-web && npm run check:i18n` — key parity should still pass (0 errors)
    3. Count remaining settings baseline entries — should be 0 or near-0 (only genuine false positives)
  </verify>
  <done>All 44 hardcoded strings in duplicate-rules, email-accounts, notification-preferences, language, and teams-edit templates replaced with transloco pipe references. Total settings sub-page baseline entries reduced from 198 to near-zero.</done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration development` compiles without errors
2. `cd globcrm-web && npm run check:i18n` — key parity check passes, settings files have no missing translations
3. Switching to Turkish and navigating through Settings > Webhooks, Pipelines, Custom Fields, Duplicate Rules, Email Accounts, Notifications shows all labels in Turkish
4. Settings-related entries in i18n-baseline.json reduced from 198 to near-zero
</verification>

<success_criteria>
- All 14 settings sub-page component templates use transloco pipe for every user-visible string
- settings/en.json and settings/tr.json extended with ~150 new keys maintaining key parity
- Angular build compiles successfully
- CI key parity check passes
</success_criteria>

<output>
After completion, create `.planning/phases/28-localization-string-extraction/28-08-SUMMARY.md`
</output>
