---
phase: 28-localization-string-extraction
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - globcrm-web/src/assets/i18n/en.json
  - globcrm-web/src/assets/i18n/tr.json
  - globcrm-web/src/app/shared/components/summary-tab/entity-summary-tab.component.html
  - globcrm-web/src/app/shared/components/summary-tab/deal-pipeline-chart.component.ts
  - globcrm-web/src/app/shared/components/summary-tab/email-engagement-card.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/contact-preview.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/deal-preview.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/lead-preview.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/company-preview.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/activity-preview.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/product-preview.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/association-chips.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/mini-timeline.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/preview-activities-tab.component.ts
  - globcrm-web/src/app/shared/components/entity-preview/preview-notes-tab.component.ts
  - globcrm-web/src/app/shared/components/entity-preview-sidebar/entity-preview-sidebar.component.html
  - globcrm-web/src/app/shared/components/entity-preview-sidebar/preview-breadcrumbs.component.ts
  - globcrm-web/src/app/shared/components/dynamic-table/quick-add-field.component.ts
  - globcrm-web/src/app/shared/components/avatar/avatar-crop-dialog.component.ts
  - globcrm-web/src/app/shared/components/avatar/avatar-upload.component.ts
  - globcrm-web/src/app/shared/components/custom-field-form/custom-field-form.component.ts
  - globcrm-web/src/app/shared/components/filter-chips/filter-chips.component.html
  - globcrm-web/src/app/shared/components/navbar/navbar.component.html
  - globcrm-web/src/app/shared/components/user-preview/user-preview-popover.component.ts
autonomous: true
gap_closure: true
requirements:
  - LOCL-03
  - LOCL-10
must_haves:
  truths:
    - "Entity summary tab field labels (Name, Email, Phone, Stage, Status, Owner, etc.) render in Turkish on every detail page"
    - "Entity preview sidebar field labels render in Turkish for contact, deal, lead, company, activity, and product previews"
    - "Quick-add-field dialog in dynamic table renders labels in Turkish"
    - "User preview popover labels render in Turkish"
  artifacts:
    - path: "globcrm-web/src/assets/i18n/en.json"
      provides: "Global common.summaryTab, common.preview, common.quickAddField keys for shared components"
      contains: "common.summaryTab"
    - path: "globcrm-web/src/assets/i18n/tr.json"
      provides: "Turkish translations matching all new global EN keys"
      contains: "common.summaryTab"
  key_links:
    - from: "entity-summary-tab.component.html"
      to: "en.json"
      via: "transloco pipe referencing common.summaryTab.* keys"
      pattern: "common\\.summaryTab"
    - from: "contact-preview.component.ts"
      to: "en.json"
      via: "transloco pipe referencing common.preview.fields.* keys"
      pattern: "common\\.preview\\.fields"
    - from: "deal-preview.component.ts"
      to: "en.json"
      via: "transloco pipe referencing common.preview.fields.* keys"
      pattern: "common\\.preview\\.fields"
---

<objective>
Extract all 75 hardcoded strings from shared entity-preview and summary-tab components, plus 20 strings from other shared components (quick-add-field, avatar, custom-field-form, navbar, filter-chips, user-preview), into the global EN/TR translation files.

Purpose: Close the second-largest gap cluster — entity-preview components (Blocker severity) and entity-summary-tab (Blocker severity) that are visible on every list and detail page in the application. These are shared components not under any feature scope, so all keys go in the global translation file.

Output: All shared component field labels, empty states, and UI chrome render in Turkish when language is switched. Global EN/TR JSON extended with ~70 new keys.
</objective>

<execution_context>
@C:/Users/maliy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/maliy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/28-localization-string-extraction/28-CONTEXT.md
@.planning/phases/28-localization-string-extraction/28-RESEARCH.md
@.planning/phases/28-localization-string-extraction/28-VERIFICATION.md
@globcrm-web/src/assets/i18n/en.json
@globcrm-web/src/assets/i18n/tr.json
@globcrm-web/scripts/i18n-baseline.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire transloco in entity-summary-tab and summary-tab sub-components (39 strings)</name>
  <files>
    globcrm-web/src/assets/i18n/en.json
    globcrm-web/src/assets/i18n/tr.json
    globcrm-web/src/app/shared/components/summary-tab/entity-summary-tab.component.html
    globcrm-web/src/app/shared/components/summary-tab/deal-pipeline-chart.component.ts
    globcrm-web/src/app/shared/components/summary-tab/email-engagement-card.component.ts
  </files>
  <action>
    **Step 1: Add global keys to en.json under `common.summaryTab`.**

    Add a new section `common.summaryTab` to en.json for entity-summary-tab field labels. These are generic field labels used across all entity types — they belong in global, not per-feature scope.

    Keys needed for entity-summary-tab.component.html (30 strings):
    ```json
    "summaryTab": {
      "fields": {
        "name": "Name",
        "fullName": "Full Name",
        "email": "Email",
        "phone": "Phone",
        "company": "Company",
        "contact": "Contact",
        "department": "Department",
        "jobTitle": "Job Title",
        "location": "Location",
        "industry": "Industry",
        "size": "Size",
        "website": "Website",
        "value": "Value",
        "stage": "Stage",
        "pipeline": "Pipeline",
        "probability": "Probability",
        "expectedClose": "Expected Close",
        "expiryDate": "Expiry Date",
        "issueDate": "Issue Date",
        "quoteNumber": "Quote Number",
        "grandTotal": "Grand Total",
        "status": "Status",
        "priority": "Priority",
        "source": "Source",
        "temperature": "Temperature",
        "category": "Category",
        "subject": "Subject",
        "title": "Title",
        "assignedTo": "Assigned To",
        "owner": "Owner"
      }
    }
    ```

    Keys needed for deal-pipeline-chart.component.ts (3 strings):
    ```json
    "dealPipelineChart": {
      "noDeals": "No deals yet",
      "totalValue": "Total Value",
      "winRate": "Win Rate"
    }
    ```

    Keys needed for email-engagement-card.component.ts (6 strings):
    ```json
    "emailEngagement": {
      "noActivity": "No email activity",
      "sent": "Sent",
      "received": "Received",
      "total": "Total",
      "lastSent": "Last sent",
      "lastReceived": "Last received"
    }
    ```

    Place `dealPipelineChart` and `emailEngagement` under `common.summaryTab` for organizational clarity.

    **Step 2: Create matching Turkish translations in tr.json.**

    Turkish translations:
    - Name -> Ad
    - Full Name -> Ad Soyad
    - Email -> E-posta
    - Phone -> Telefon
    - Company -> Sirket
    - Contact -> Kisi
    - Department -> Departman
    - Job Title -> Unvan
    - Location -> Konum
    - Industry -> Sektor
    - Size -> Buyukluk
    - Website -> Web Sitesi
    - Value -> Deger
    - Stage -> Asama
    - Pipeline -> Pipeline
    - Probability -> Olasilik
    - Expected Close -> Beklenen Kapanis
    - Expiry Date -> Son Gecerlilik Tarihi
    - Issue Date -> Duzenleme Tarihi
    - Quote Number -> Teklif Numarasi
    - Grand Total -> Genel Toplam
    - Status -> Durum
    - Priority -> Oncelik
    - Source -> Kaynak
    - Temperature -> Sicaklik
    - Category -> Kategori
    - Subject -> Konu
    - Title -> Baslik
    - Assigned To -> Atanan Kisi
    - Owner -> Sahip
    - No deals yet -> Henuz anlasma yok
    - Total Value -> Toplam Deger
    - Win Rate -> Kazanma Orani
    - No email activity -> E-posta etkinligi yok
    - Sent -> Gonderilen
    - Received -> Alinan
    - Last sent -> Son gonderilen
    - Last received -> Son alinan

    **Step 3: Wire transloco pipe in templates.**

    For entity-summary-tab.component.html: This is an HTML template file. Replace each hardcoded field label with `{{ 'common.summaryTab.fields.keyName' | transloco }}`. The component likely uses conditional rendering based on entity type to show different fields. Replace only the static label text, NOT the dynamic data values.

    For deal-pipeline-chart.component.ts and email-engagement-card.component.ts: These are inline-template components. Add `TranslocoPipe` to their `imports` array if not already present, then replace hardcoded strings in the template literal with transloco pipe calls using `common.summaryTab.dealPipelineChart.*` and `common.summaryTab.emailEngagement.*` keys.

    **IMPORTANT:** entity-summary-tab renders field labels conditionally based on entity type. The field names ("Name", "Email", etc.) are the targets for translation. The field VALUES (actual contact name, email address) must NOT be touched.
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Count summary-tab baseline entries: should drop from 39 to 0
  </verify>
  <done>All 39 hardcoded strings in entity-summary-tab, deal-pipeline-chart, and email-engagement-card replaced with transloco pipe references. Summary tab field labels render in Turkish on all detail pages.</done>
</task>

<task type="auto">
  <name>Task 2a: Wire transloco in entity-preview family components (33 strings, 12 files)</name>
  <files>
    globcrm-web/src/assets/i18n/en.json
    globcrm-web/src/assets/i18n/tr.json
    globcrm-web/src/app/shared/components/entity-preview/contact-preview.component.ts
    globcrm-web/src/app/shared/components/entity-preview/deal-preview.component.ts
    globcrm-web/src/app/shared/components/entity-preview/lead-preview.component.ts
    globcrm-web/src/app/shared/components/entity-preview/company-preview.component.ts
    globcrm-web/src/app/shared/components/entity-preview/activity-preview.component.ts
    globcrm-web/src/app/shared/components/entity-preview/product-preview.component.ts
    globcrm-web/src/app/shared/components/entity-preview/association-chips.component.ts
    globcrm-web/src/app/shared/components/entity-preview/mini-timeline.component.ts
    globcrm-web/src/app/shared/components/entity-preview/preview-activities-tab.component.ts
    globcrm-web/src/app/shared/components/entity-preview/preview-notes-tab.component.ts
  </files>
  <action>
    **Step 1: Add global keys to en.json under `common.preview.fields` (nested, not flat).**

    **Key naming decision: Use `common.preview.fields.*` nested keys for ALL entity-preview field labels.** Do NOT reuse existing `common.*` flat keys — the preview components get their own dedicated namespace under `common.preview.fields`. This avoids coupling preview labels to other usages and keeps the key_links pattern (`common\.preview\.fields`) verifiable.

    Extend the existing `common.preview` section (may already have `openFullRecord`, `closePreview`, `customFields` from 28-01):

    ```json
    "preview": {
      "fields": {
        "email": "Email",
        "phone": "Phone",
        "jobTitle": "Job Title",
        "company": "Company",
        "city": "City",
        "country": "Country",
        "industry": "Industry",
        "size": "Size",
        "website": "Website",
        "value": "Value",
        "stage": "Stage",
        "pipeline": "Pipeline",
        "probability": "Probability",
        "expectedClose": "Expected Close",
        "source": "Source",
        "temperature": "Temperature",
        "dueDate": "Due Date",
        "priority": "Priority",
        "status": "Status",
        "type": "Type",
        "category": "Category",
        "description": "Description",
        "unitPrice": "Unit Price"
      },
      "related": "Related",
      "recentActivities": "Recent Activities",
      "noActivities": "No activities yet",
      "noNotes": "No notes yet",
      "ownerAlt": "Owner",
      "breadcrumbsAria": "Preview navigation"
    }
    ```

    Check if `common.preview` already has some of these keys (e.g., `openFullRecord`, `closePreview`, `customFields` from 28-01). Extend without duplicating — merge new keys alongside existing ones.

    **Step 2: Create matching Turkish translations in tr.json.**

    Turkish translations:
    - Job Title -> Unvan
    - City -> Sehir
    - Country -> Ulke
    - Due Date -> Son Tarih
    - Unit Price -> Birim Fiyat
    - Related -> Iliskili
    - Recent Activities -> Son Etkinlikler
    - No activities yet -> Henuz etkinlik yok
    - No notes yet -> Henuz not yok
    - Preview navigation -> Onizleme gezinmesi

    **Step 3: Wire transloco pipe in each entity-preview component.**

    For each of the 6 entity-preview components (contact, deal, lead, company, activity, product): These are inline-template components. Add `TranslocoPipe` to the `imports` array (verification report confirms they DON'T have it). Replace all hardcoded field label strings with transloco pipe calls using `common.preview.fields.*` keys. Example: replace `Email` with `{{ 'common.preview.fields.email' | transloco }}`.

    For association-chips, mini-timeline, preview-activities-tab, preview-notes-tab: Add TranslocoPipe to imports, replace hardcoded strings using `common.preview.*` keys.

    **NOTE:** entity-preview-sidebar.component.html and preview-breadcrumbs.component.ts are handled in Task 2b alongside other misc shared components.
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Count entity-preview baseline entries: should drop from 33 to 0 (remaining 3 strings in sidebar/breadcrumbs covered in Task 2b)
  </verify>
  <done>All 33 hardcoded strings in 6 entity-preview components + 4 supporting components (association-chips, mini-timeline, preview-activities-tab, preview-notes-tab) replaced with transloco pipe references using `common.preview.fields.*` keys. Entity preview field labels render in Turkish for all entity types.</done>
</task>

<task type="auto">
  <name>Task 2b: Wire transloco in misc shared components + preview sidebar (23 strings, 11 files)</name>
  <files>
    globcrm-web/src/assets/i18n/en.json
    globcrm-web/src/assets/i18n/tr.json
    globcrm-web/src/app/shared/components/entity-preview-sidebar/entity-preview-sidebar.component.html
    globcrm-web/src/app/shared/components/entity-preview-sidebar/preview-breadcrumbs.component.ts
    globcrm-web/src/app/shared/components/dynamic-table/quick-add-field.component.ts
    globcrm-web/src/app/shared/components/avatar/avatar-crop-dialog.component.ts
    globcrm-web/src/app/shared/components/avatar/avatar-upload.component.ts
    globcrm-web/src/app/shared/components/custom-field-form/custom-field-form.component.ts
    globcrm-web/src/app/shared/components/filter-chips/filter-chips.component.html
    globcrm-web/src/app/shared/components/navbar/navbar.component.html
    globcrm-web/src/app/shared/components/user-preview/user-preview-popover.component.ts
  </files>
  <action>
    **Step 0: Wire entity-preview-sidebar and preview-breadcrumbs (3 strings, moved from Task 2a).**

    For entity-preview-sidebar.component.html: Replace the owner alt attribute with `[alt]="'common.preview.ownerAlt' | transloco"`.

    For preview-breadcrumbs.component.ts: Replace aria-label with `[attr.aria-label]="'common.preview.breadcrumbsAria' | transloco"`. Add TranslocoPipe to imports.

    The `common.preview.ownerAlt` and `common.preview.breadcrumbsAria` keys were already added to en.json/tr.json in Task 2a, so no new keys needed for this step — just wire the pipe in the templates.

    **Step 1: Add global keys to en.json for misc shared components.**

    Add the following sections under `common`:

    ```json
    "quickAddField": {
      "title": "Quick Add Field",
      "fieldLabel": "Field Label",
      "fieldType": "Field Type",
      "configureHint": "Configure options & validation in Settings",
      "addButton": "Add custom field column"
    },
    "avatar": {
      "cropTitle": "Crop Avatar",
      "cancel": "Cancel",
      "loadError": "Failed to load image. Please try a different file.",
      "changePhoto": "Change Photo"
    },
    "customFieldForm": {
      "fileUploadSoon": "File upload coming soon",
      "relatedEntityPlaceholder": "Related entity ID"
    },
    "userPreview": {
      "couldNotLoad": "Could not load profile",
      "deals": "Deals",
      "lastActive": "Last active",
      "tasksToday": "Tasks today"
    }
    ```

    For filter-chips: Add `common.filters.activeFiltersAria` ("Active filters") if not already in `common.filters`.
    For navbar: Add `common.nav.toggleMenu` ("Toggle navigation menu") and `common.nav.userMenu` ("User menu") for aria-labels, if not already present.

    **Step 2: Create matching Turkish translations in tr.json.**

    Turkish translations:
    - Quick Add Field -> Hizli Alan Ekle
    - Field Label -> Alan Etiketi
    - Field Type -> Alan Tipi
    - Configure options & validation in Settings -> Ayarlarda secenekleri ve dogrulamayi yapilandirin
    - Add custom field column -> Ozel alan sutunu ekle
    - Crop Avatar -> Avatar Kirp
    - Cancel -> Iptal
    - Failed to load image... -> Gorsel yuklenemedi. Lutfen farkli bir dosya deneyin.
    - Change Photo -> Fotograf Degistir
    - File upload coming soon -> Dosya yukleme yakinda
    - Related entity ID -> Iliskili varlik kimlik numarasi
    - Could not load profile -> Profil yuklenemedi
    - Deals -> Anlasmalar
    - Last active -> Son aktif
    - Tasks today -> Bugunun gorevleri
    - Active filters -> Aktif filtreler
    - Toggle navigation menu -> Gezinme menusunu ac/kapat
    - User menu -> Kullanici menusu

    **Step 3: Wire transloco pipe in each component.**

    For quick-add-field.component.ts: Add TranslocoPipe to imports, replace 5 strings using `common.quickAddField.*` keys.

    For avatar-crop-dialog.component.ts and avatar-upload.component.ts: Add TranslocoPipe, replace 4 strings using `common.avatar.*` keys.

    For custom-field-form.component.ts: Add TranslocoPipe, replace 2 strings using `common.customFieldForm.*` keys.

    For filter-chips.component.html: Replace 1 aria-label with `[attr.aria-label]="'common.filters.activeFiltersAria' | transloco"`.

    For navbar.component.html: Replace 2 aria-labels using `common.nav.toggleMenu` and `common.nav.userMenu` keys.

    For user-preview-popover.component.ts: Add TranslocoPipe, replace 4 strings using `common.userPreview.*` keys.
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Run `cd globcrm-web && npm run check:i18n` — key parity passes
    3. Count misc shared component baseline entries: should drop from 20 to 0
  </verify>
  <done>All 23 hardcoded strings in entity-preview-sidebar, preview-breadcrumbs, quick-add-field, avatar, custom-field-form, filter-chips, navbar, and user-preview components replaced with transloco pipe references. All misc shared component labels render in Turkish when language is switched.</done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration development` compiles without errors
2. `cd globcrm-web && npm run check:i18n` — key parity check passes
3. Switch to Turkish, hover/click to open entity preview sidebar for a contact — field labels (Email, Phone, Job Title, Company, City) render in Turkish
4. Switch to Turkish, open any entity detail page — summary tab field labels render in Turkish
5. Shared component baseline entries reduced from 75 to 0
</verification>

<success_criteria>
- All 6 entity-preview components have TranslocoPipe imported and all field labels translated via `common.preview.fields.*` keys
- entity-summary-tab.component.html has all 30 field labels translated
- deal-pipeline-chart and email-engagement-card have all strings translated
- All 23 remaining shared component strings (entity-preview-sidebar, preview-breadcrumbs, quick-add-field, avatar, custom-field-form, navbar, filter-chips, user-preview) translated
- Global en.json and tr.json extended with ~70 new keys maintaining key parity
- Angular build compiles successfully
</success_criteria>

<output>
After completion, create `.planning/phases/28-localization-string-extraction/28-09-SUMMARY.md`
</output>
