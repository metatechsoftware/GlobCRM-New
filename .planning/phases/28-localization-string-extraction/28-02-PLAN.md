---
phase: 28-localization-string-extraction
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - globcrm-web/src/assets/i18n/deals/en.json
  - globcrm-web/src/assets/i18n/deals/tr.json
  - globcrm-web/src/assets/i18n/companies/en.json
  - globcrm-web/src/assets/i18n/companies/tr.json
  - globcrm-web/src/assets/i18n/leads/en.json
  - globcrm-web/src/assets/i18n/leads/tr.json
  - globcrm-web/src/app/features/deals/deals.routes.ts
  - globcrm-web/src/app/features/deals/deal-list/deal-list.component.ts
  - globcrm-web/src/app/features/deals/deal-list/deal-list.component.html
  - globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
  - globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.html
  - globcrm-web/src/app/features/deals/deal-form/deal-form.component.ts
  - globcrm-web/src/app/features/deals/deal-form/deal-form.component.html
  - globcrm-web/src/app/features/companies/companies.routes.ts
  - globcrm-web/src/app/features/companies/company-list/company-list.component.ts
  - globcrm-web/src/app/features/companies/company-list/company-list.component.html
  - globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
  - globcrm-web/src/app/features/companies/company-detail/company-detail.component.html
  - globcrm-web/src/app/features/companies/company-form/company-form.component.ts
  - globcrm-web/src/app/features/companies/company-form/company-form.component.html
  - globcrm-web/src/app/features/leads/leads.routes.ts
  - globcrm-web/src/app/features/leads/lead-list/lead-list.component.ts
  - globcrm-web/src/app/features/leads/lead-list/lead-list.component.html
  - globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.ts
  - globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.html
  - globcrm-web/src/app/features/leads/lead-form/lead-form.component.ts
  - globcrm-web/src/app/features/leads/lead-form/lead-form.component.html
  - globcrm-web/src/app/features/contacts/contact-list/contact-list.component.ts
  - globcrm-web/src/app/features/contacts/contact-list/contact-list.component.html
  - globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
  - globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.html
  - globcrm-web/src/app/features/contacts/contact-form/contact-form.component.ts
  - globcrm-web/src/app/features/contacts/contact-form/contact-form.component.html
autonomous: true
requirements:
  - LOCL-03
  - LOCL-10

must_haves:
  truths:
    - "Deal list, detail, form, and kanban pages render all labels, buttons, and messages in the selected language"
    - "Company list, detail, and form pages render all labels, buttons, and messages in the selected language"
    - "Lead list, detail, form, kanban, and convert dialog render all labels, buttons, and messages in the selected language"
    - "Contact list, detail, and form templates use transloco pipe references (completing Phase 27 partial wiring)"
  artifacts:
    - path: "globcrm-web/src/assets/i18n/deals/en.json"
      provides: "Complete deals feature English translations"
      contains: "list"
    - path: "globcrm-web/src/assets/i18n/deals/tr.json"
      provides: "Complete deals feature Turkish translations"
      contains: "list"
    - path: "globcrm-web/src/assets/i18n/companies/en.json"
      provides: "Complete companies feature English translations"
      contains: "list"
    - path: "globcrm-web/src/assets/i18n/companies/tr.json"
      provides: "Complete companies feature Turkish translations"
      contains: "list"
    - path: "globcrm-web/src/assets/i18n/leads/en.json"
      provides: "Complete leads feature English translations"
      contains: "list"
    - path: "globcrm-web/src/assets/i18n/leads/tr.json"
      provides: "Complete leads feature Turkish translations"
      contains: "list"
  key_links:
    - from: "globcrm-web/src/app/features/deals/deals.routes.ts"
      to: "globcrm-web/src/assets/i18n/deals/en.json"
      via: "provideTranslocoScope('deals')"
      pattern: "provideTranslocoScope.*deals"
    - from: "globcrm-web/src/app/features/companies/companies.routes.ts"
      to: "globcrm-web/src/assets/i18n/companies/en.json"
      via: "provideTranslocoScope('companies')"
      pattern: "provideTranslocoScope.*companies"
    - from: "globcrm-web/src/app/features/leads/leads.routes.ts"
      to: "globcrm-web/src/assets/i18n/leads/en.json"
      via: "provideTranslocoScope('leads')"
      pattern: "provideTranslocoScope.*leads"
---

<objective>
Create translation scopes and extract all hardcoded strings for the four core CRM entity features: deals, companies, leads, and contacts (complete contacts template wiring from Phase 27).

Purpose: These four entity features are the highest-traffic pages in the CRM and contain the most hardcoded strings (~250 combined). Deals has ~80 strings including kanban board labels, companies ~50, leads ~70 including conversion dialog, and contacts needs template wiring to use the JSON keys created in Phase 27.

Output: Three new translation scopes (deals, companies, leads) with EN/TR JSON files, provideTranslocoScope wired in routes, all component templates using transloco pipe. Contacts templates completed.
</objective>

<execution_context>
@C:/Users/maliy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/maliy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-localization-string-extraction/28-CONTEXT.md
@.planning/phases/28-localization-string-extraction/28-RESEARCH.md
@.planning/phases/27-localization-foundation/27-04-SUMMARY.md
@globcrm-web/src/assets/i18n/contacts/en.json
@globcrm-web/src/assets/i18n/contacts/tr.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create deals, companies, and leads translation scope JSON files</name>
  <files>
    globcrm-web/src/assets/i18n/deals/en.json
    globcrm-web/src/assets/i18n/deals/tr.json
    globcrm-web/src/assets/i18n/companies/en.json
    globcrm-web/src/assets/i18n/companies/tr.json
    globcrm-web/src/assets/i18n/leads/en.json
    globcrm-web/src/assets/i18n/leads/tr.json
  </files>
  <action>
Read ALL component templates (HTML files and inline TS templates) in each feature directory to extract every hardcoded English string. For each feature, create EN and TR JSON files.

**Deals scope** (`assets/i18n/deals/`): Read all files under `features/deals/` including deal-list, deal-detail, deal-form, and any kanban/calendar components. Extract strings for:
- `list.*`: title, subtitle, addButton, empty state, pipeline selector labels, kanban board labels, calendar view labels
- `detail.*`: title, tabs (summary, details, contacts, products, activities, quotes, timeline, notes, attachments), field labels (description, pipeline, stage, value, probability, expectedCloseDate, actualCloseDate, owner, company, created, lastUpdated), section headers, empty states, linked entity labels (contacts, products, activities, quotes, notes)
- `form.*`: createTitle, editTitle, field labels, validation messages
- `kanban.*`: any kanban-specific labels (drag hint, column headers, etc.)
- `messages.*`: all snackbar messages (save, delete, link, unlink success/failure)
- `dialog.*`: delete confirmation, link search dialogs

**Companies scope** (`assets/i18n/companies/`): Read all files under `features/companies/`. Extract strings for:
- `list.*`: title, subtitle, addButton, empty state
- `detail.*`: title, tabs, field labels (name, industry, website, phone, email, address, city, state, country, zipCode, employees, revenue, owner, description, created, lastUpdated), section headers, empty states, linked entity labels
- `form.*`: createTitle, editTitle, field labels
- `messages.*`: all snackbar messages

**Leads scope** (`assets/i18n/leads/`): Read all files under `features/leads/`. Extract strings for:
- `list.*`: title, subtitle, addButton, empty state, pipeline/status filter labels
- `detail.*`: title, tabs, field labels (name, email, phone, company, source, status, score, owner, description, created, lastUpdated), section headers, empty states
- `form.*`: createTitle, editTitle, field labels
- `kanban.*`: kanban board labels
- `convert.*`: conversion dialog labels (convert to contact, select company, create new company, etc.)
- `messages.*`: all snackbar messages including conversion messages

Structure each JSON following the Phase 27 contacts pattern: `{ "title": "...", "list": {...}, "detail": {...}, "form": {...}, "messages": {...} }`. Use camelCase keys. Use page-section grouping.

Turkish translations: Use formal "siz" form. Keep English loanwords: "Pipeline", "Dashboard", "Lead", "CRM", "Kanban". Use professional CRM vocabulary: "Anlasmalar" for Deals, "Sirketler" for Companies, "Potansiyel Musteriler" or "Lead'ler" for Leads (use the common Turkish B2B convention).

CRITICAL: Read every component template file before writing JSON to ensure completeness. Do not guess at strings.
  </action>
  <verify>
For each scope, verify key parity: `node -e "const en=require('./globcrm-web/src/assets/i18n/deals/en.json'); const tr=require('./globcrm-web/src/assets/i18n/deals/tr.json'); const ek=JSON.stringify(Object.keys(en).sort()); const tk=JSON.stringify(Object.keys(tr).sort()); console.log('deals parity:', ek===tk);"` and repeat for companies and leads.
  </verify>
  <done>Six JSON files created (en.json + tr.json for deals, companies, leads) with all extracted strings from every component template. EN and TR files have identical key structures.</done>
</task>

<task type="auto">
  <name>Task 2: Wire scopes in routes and replace hardcoded strings in all deal, company, lead, and contact templates</name>
  <files>
    globcrm-web/src/app/features/deals/deals.routes.ts
    globcrm-web/src/app/features/companies/companies.routes.ts
    globcrm-web/src/app/features/leads/leads.routes.ts
    globcrm-web/src/app/features/deals/deal-list/deal-list.component.ts
    globcrm-web/src/app/features/deals/deal-list/deal-list.component.html
    globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
    globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.html
    globcrm-web/src/app/features/deals/deal-form/deal-form.component.ts
    globcrm-web/src/app/features/deals/deal-form/deal-form.component.html
    globcrm-web/src/app/features/companies/company-list/company-list.component.ts
    globcrm-web/src/app/features/companies/company-list/company-list.component.html
    globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
    globcrm-web/src/app/features/companies/company-detail/company-detail.component.html
    globcrm-web/src/app/features/companies/company-form/company-form.component.ts
    globcrm-web/src/app/features/companies/company-form/company-form.component.html
    globcrm-web/src/app/features/leads/lead-list/lead-list.component.ts
    globcrm-web/src/app/features/leads/lead-list/lead-list.component.html
    globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.ts
    globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.html
    globcrm-web/src/app/features/leads/lead-form/lead-form.component.ts
    globcrm-web/src/app/features/leads/lead-form/lead-form.component.html
    globcrm-web/src/app/features/contacts/contact-list/contact-list.component.ts
    globcrm-web/src/app/features/contacts/contact-list/contact-list.component.html
    globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
    globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.html
    globcrm-web/src/app/features/contacts/contact-form/contact-form.component.ts
    globcrm-web/src/app/features/contacts/contact-form/contact-form.component.html
  </files>
  <action>
**Step 1: Wire provideTranslocoScope in route files**

For deals.routes.ts, companies.routes.ts, and leads.routes.ts, add the scope wrapper following the contacts.routes.ts pattern:
```typescript
import { provideTranslocoScope } from '@jsverse/transloco';
// Wrap existing routes in parent route with providers
{
  path: '',
  providers: [provideTranslocoScope('scopeName')],
  children: [ /* existing routes */ ],
}
```

Contacts already has this wiring from Phase 27 -- skip.

**Step 2: Replace hardcoded strings in ALL component templates**

For EACH component (list, detail, form, plus any kanban/calendar/convert components):

1. Add `TranslocoPipe` to the component's `imports` array (import from `@jsverse/transloco`).
2. For components with snackBar.open() calls: inject `TranslocoService` and replace hardcoded strings with `this.translocoService.translate('scopeName.messages.keyName')`.
3. Replace all hardcoded template strings with transloco pipe:
   - Page titles: `<h1>Deals</h1>` -> `<h1>{{ 'list.title' | transloco }}</h1>` (scoped key, no prefix needed)
   - Button labels: `<button>New Deal</button>` -> `<button>{{ 'list.addDeal' | transloco }}</button>`
   - Field labels: `<mat-label>Pipeline</mat-label>` -> `<mat-label>{{ 'detail.fields.pipeline' | transloco }}</mat-label>`
   - Empty states: `<p>No deals found</p>` -> `<p>{{ 'list.empty' | transloco }}</p>`
   - Tooltips: `matTooltip="Edit"` -> `[matTooltip]="'common.edit' | transloco"` (common labels from global)
   - Placeholders: `placeholder="Search..."` -> `[placeholder]="'common.search' | transloco"`
   - Tab labels: `label="Summary"` -> `[label]="'detail.tabs.summary' | transloco"`
   - Conditional text: `{{ isEdit ? 'Edit Deal' : 'New Deal' }}` -> `{{ (isEdit ? 'form.editTitle' : 'form.createTitle') | transloco }}`
   - Parameterized strings: `{{ count }} contacts linked` -> `{{ 'detail.linkedContacts.count' | transloco:{ count: count } }}`

4. DO NOT translate: dynamic data (entity names, user content), enum values from API, Angular expressions that compute values.

5. For common labels appearing across features (Save, Cancel, Delete, Edit, Actions, OK), use GLOBAL keys: `'common.save' | transloco`, `'common.cancel' | transloco`, etc.

**Contacts (Phase 27 completion):** The contacts scope JSON files already exist from Phase 27 (27-04). Wire the transloco pipe into contact-list, contact-detail, and contact-form templates to use the existing `contacts/en.json` and `contacts/tr.json` keys. Add `TranslocoPipe` to component imports. Also extend contacts JSON files if there are strings in the templates not covered by the current keys.

Also handle any deal-specific components like kanban board, calendar view, and lead conversion dialog components if they exist under the feature directories.
  </action>
  <verify>
Run `cd globcrm-web && npx ng build --configuration development 2>&1 | head -50` to verify compilation. Then verify scope wiring: `grep -rn "provideTranslocoScope" src/app/features/deals/ src/app/features/companies/ src/app/features/leads/ --include="*.ts"`.
  </verify>
  <done>Deals, companies, and leads route files have provideTranslocoScope wired. All list, detail, form, kanban, and dialog component templates use transloco pipe for every hardcoded string. Contacts templates completed with transloco pipe. All snackBar.open() calls use translated messages. Angular builds without errors.</done>
</task>

</tasks>

<verification>
- `cd globcrm-web && npx ng build --configuration development` compiles without errors
- `grep -rn "provideTranslocoScope" globcrm-web/src/app/features/{deals,companies,leads,contacts}/ --include="*.ts"` shows all four features have scope wiring
- Each scope has en.json and tr.json with identical key structures
- Run dev server, navigate to Deals list, switch to Turkish -- page title, buttons, empty state, field labels display in Turkish
</verification>

<success_criteria>
- Deals, companies, leads each have provideTranslocoScope in their route files
- Six new JSON files created (en.json + tr.json for deals, companies, leads) with comprehensive translations
- Contacts JSON files extended if needed, templates fully wired with transloco pipe
- All hardcoded strings in ~15+ component templates replaced with transloco pipe references
- All snackBar.open() calls in these features use translated messages
- Angular project compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/28-localization-string-extraction/28-02-SUMMARY.md`
</output>
