---
phase: 28-localization-string-extraction
plan: 12
type: execute
wave: 2
depends_on:
  - 28-11
files_modified:
  - globcrm-web/src/app/features/contacts/contact-list/contact-list.component.ts
  - globcrm-web/src/app/features/deals/deal-list/deal-list.component.ts
  - globcrm-web/src/app/features/companies/company-list/company-list.component.ts
  - globcrm-web/src/app/features/leads/lead-list/lead-list.component.ts
  - globcrm-web/src/app/features/activities/activity-list/activity-list.component.ts
  - globcrm-web/src/app/features/products/product-list/product-list.component.ts
  - globcrm-web/src/app/features/quotes/quote-list/quote-list.component.ts
  - globcrm-web/src/app/features/requests/request-list/request-list.component.ts
  - globcrm-web/src/app/features/emails/email-list/email-list.component.ts
  - globcrm-web/src/assets/i18n/contacts/en.json
  - globcrm-web/src/assets/i18n/contacts/tr.json
  - globcrm-web/src/assets/i18n/deals/en.json
  - globcrm-web/src/assets/i18n/deals/tr.json
  - globcrm-web/src/assets/i18n/companies/en.json
  - globcrm-web/src/assets/i18n/companies/tr.json
  - globcrm-web/src/assets/i18n/leads/en.json
  - globcrm-web/src/assets/i18n/leads/tr.json
  - globcrm-web/src/assets/i18n/activities/en.json
  - globcrm-web/src/assets/i18n/activities/tr.json
  - globcrm-web/src/assets/i18n/products/en.json
  - globcrm-web/src/assets/i18n/products/tr.json
  - globcrm-web/src/assets/i18n/quotes/en.json
  - globcrm-web/src/assets/i18n/quotes/tr.json
  - globcrm-web/src/assets/i18n/requests/en.json
  - globcrm-web/src/assets/i18n/requests/tr.json
  - globcrm-web/src/assets/i18n/emails/en.json
  - globcrm-web/src/assets/i18n/emails/tr.json
  - globcrm-web/src/assets/i18n/my-day/en.json
  - globcrm-web/src/assets/i18n/my-day/tr.json
  - globcrm-web/src/assets/i18n/settings/en.json
  - globcrm-web/src/assets/i18n/settings/tr.json
  - globcrm-web/src/app/features/my-day/widgets/notification-digest-widget/notification-digest-widget.component.ts
  - globcrm-web/src/app/features/settings/notification-preferences/notification-preferences.component.ts
autonomous: true
gap_closure: true
requirements:
  - LOCL-03
  - LOCL-09

must_haves:
  truths:
    - "DynamicTable column headers display in Turkish when language is switched to Turkish on all entity list pages"
    - "Notification category names in My Day widget display in Turkish using correct enum-matched translation keys"
    - "Notification preference labels and descriptions in Settings display in Turkish via translation keys"
  artifacts:
    - path: "globcrm-web/src/assets/i18n/contacts/en.json"
      provides: "Column label translations for contacts"
      contains: "columns"
    - path: "globcrm-web/src/assets/i18n/deals/en.json"
      provides: "Column label translations for deals"
      contains: "columns"
    - path: "globcrm-web/src/assets/i18n/my-day/en.json"
      provides: "Notification type keys matching backend enum values"
      contains: "ActivityAssigned"
  key_links:
    - from: "globcrm-web/src/app/features/contacts/contact-list/contact-list.component.ts"
      to: "globcrm-web/src/assets/i18n/contacts/en.json"
      via: "labelKey references in coreColumnDefs"
      pattern: "contacts\\.columns\\."
    - from: "globcrm-web/src/app/features/my-day/widgets/notification-digest-widget/notification-digest-widget.component.ts"
      to: "globcrm-web/src/assets/i18n/my-day/en.json"
      via: "TranslocoService.translate() with enum-keyed types"
      pattern: "widgets\\.notifications\\.types"
---

<objective>
Convert all entity list column definitions to use translated labelKey values and fix notification type translation key mismatches discovered during UAT.

Purpose: Completes column header translation across all 9 entity list pages (UAT Tests 4-6) and fixes notification category name translations (UAT Test 10). Depends on Plan 11's infrastructure (labelKey field on ColumnDefinition + scope-aware loader).
Output: All entity list column headers translate to Turkish. Notification types translate correctly with proper enum-matched keys.
</objective>

<execution_context>
@C:/Users/maliy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/maliy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-localization-string-extraction/28-UAT.md
@.planning/phases/28-localization-string-extraction/28-11-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert all entity list coreColumnDefs to use labelKey and add column translation keys to scope JSONs</name>
  <files>
    globcrm-web/src/app/features/contacts/contact-list/contact-list.component.ts
    globcrm-web/src/app/features/deals/deal-list/deal-list.component.ts
    globcrm-web/src/app/features/companies/company-list/company-list.component.ts
    globcrm-web/src/app/features/leads/lead-list/lead-list.component.ts
    globcrm-web/src/app/features/activities/activity-list/activity-list.component.ts
    globcrm-web/src/app/features/products/product-list/product-list.component.ts
    globcrm-web/src/app/features/quotes/quote-list/quote-list.component.ts
    globcrm-web/src/app/features/requests/request-list/request-list.component.ts
    globcrm-web/src/app/features/emails/email-list/email-list.component.ts
    globcrm-web/src/assets/i18n/contacts/en.json
    globcrm-web/src/assets/i18n/contacts/tr.json
    globcrm-web/src/assets/i18n/deals/en.json
    globcrm-web/src/assets/i18n/deals/tr.json
    globcrm-web/src/assets/i18n/companies/en.json
    globcrm-web/src/assets/i18n/companies/tr.json
    globcrm-web/src/assets/i18n/leads/en.json
    globcrm-web/src/assets/i18n/leads/tr.json
    globcrm-web/src/assets/i18n/activities/en.json
    globcrm-web/src/assets/i18n/activities/tr.json
    globcrm-web/src/assets/i18n/products/en.json
    globcrm-web/src/assets/i18n/products/tr.json
    globcrm-web/src/assets/i18n/quotes/en.json
    globcrm-web/src/assets/i18n/quotes/tr.json
    globcrm-web/src/assets/i18n/requests/en.json
    globcrm-web/src/assets/i18n/requests/tr.json
    globcrm-web/src/assets/i18n/emails/en.json
    globcrm-web/src/assets/i18n/emails/tr.json
  </files>
  <action>
    For each of the 9 entity list components (excluding notes which already uses translate()), add `labelKey` to each entry in `coreColumnDefs`. The `labelKey` must use the FULL scope-prefixed key path because `DynamicTable.getColumnLabel()` calls `translocoService.translate()` programmatically (not via pipe), which requires the full key. Keep the existing `label` as fallback.

    **Pattern for each entity:**
    - `labelKey: '{scope}.columns.{fieldId}'` where scope matches the route scope name
    - Keep `label: 'English Label'` as-is for fallback

    **Contacts (scope: contacts):**
    Add `labelKey` to each core column definition:
    ```
    { fieldId: 'fullName', label: 'Name', labelKey: 'contacts.columns.fullName', ... }
    { fieldId: 'firstName', label: 'First Name', labelKey: 'contacts.columns.firstName', ... }
    { fieldId: 'lastName', label: 'Last Name', labelKey: 'contacts.columns.lastName', ... }
    { fieldId: 'email', label: 'Email', labelKey: 'contacts.columns.email', ... }
    { fieldId: 'phone', label: 'Phone', labelKey: 'contacts.columns.phone', ... }
    { fieldId: 'jobTitle', label: 'Job Title', labelKey: 'contacts.columns.jobTitle', ... }
    { fieldId: 'companyName', label: 'Company', labelKey: 'contacts.columns.companyName', ... }
    { fieldId: 'ownerName', label: 'Owner', labelKey: 'contacts.columns.ownerName', ... }
    { fieldId: 'createdAt', label: 'Created', labelKey: 'contacts.columns.createdAt', ... }
    ```

    Add `"columns"` section to `contacts/en.json`:
    ```json
    "columns": {
      "fullName": "Name",
      "firstName": "First Name",
      "lastName": "Last Name",
      "email": "Email",
      "phone": "Phone",
      "jobTitle": "Job Title",
      "companyName": "Company",
      "ownerName": "Owner",
      "createdAt": "Created"
    }
    ```

    Add `"columns"` section to `contacts/tr.json`:
    ```json
    "columns": {
      "fullName": "Ad Soyad",
      "firstName": "Ad",
      "lastName": "Soyad",
      "email": "E-posta",
      "phone": "Telefon",
      "jobTitle": "Gorev",
      "companyName": "Sirket",
      "ownerName": "Sahip",
      "createdAt": "Olusturulma"
    }
    ```

    **Deals (scope: deals):**
    Columns: title (Baslik), value (Deger), probability (Olasilik), expectedCloseDate (Kapanma Tarihi), stageName (Asama), pipelineName (Hat), companyName (Sirket), ownerName (Sahip), createdAt (Olusturulma), updatedAt (Guncelleme)

    **Companies (scope: companies):**
    Columns: name (Sirket Adi), industry (Sektor), phone (Telefon), email (E-posta), city (Sehir), country (Ulke), ownerName (Sahip), createdAt (Olusturulma)

    **Leads (scope: leads):**
    Columns: fullName (Ad Soyad), email (E-posta), phone (Telefon), companyName (Sirket), stageName (Asama), sourceName (Kaynak), temperature (Sicaklik), ownerName (Sahip), isConverted (Donusturuldu), createdAt (Olusturulma), updatedAt (Guncelleme)

    **Activities (scope: activities):**
    Columns: subject (Konu), type (Tur), status (Durum), priority (Oncelik), dueDate (Bitis Tarihi), assignedToName (Atanan), ownerName (Sahip), createdAt (Olusturulma), updatedAt (Guncelleme)

    **Products (scope: products):**
    Columns: name (Urun Adi), sku (SKU), category (Kategori), unitPrice (Birim Fiyat), isActive (Aktif), createdAt (Olusturulma)

    **Quotes (scope: quotes):**
    Columns: quoteNumber (Teklif No), title (Baslik), status (Durum), grandTotal (Toplam), contactName (Kisi), companyName (Sirket), dealTitle (Anl.), ownerName (Sahip), versionNumber (Versiyon), issueDate (Duzenleme Tarihi), createdAt (Olusturulma)

    **Requests (scope: requests):**
    Columns: subject (Konu), status (Durum), priority (Oncelik), category (Kategori), contactName (Kisi), companyName (Sirket), ownerName (Sahip), assignedToName (Atanan), createdAt (Olusturulma), resolvedAt (Cozulme)

    **Emails (scope: emails):**
    Columns: from (Gonderen), subject (Konu), bodyPreview (Onizleme), sentAt (Tarih), linkedContactName (Kisi). Note: isRead, isStarred, and hasAttachments have empty string labels -- skip labelKey for these.

    **Notes (scope: notes):** Already uses translate() approach. Convert to labelKey approach for consistency: update the `coreColumnDefs` getter to use `labelKey: 'notes.list.columns.{fieldId}'` instead of calling `this.translocoService.translate()` synchronously. Remove the `private get coreColumnDefs()` getter pattern and replace with a static `readonly coreColumnDefs` array with labelKey entries. The notes scope JSON already has the `columns` keys.

    **IMPORTANT:** Use proper Turkish characters in TR JSON files. Common mappings:
    - o with umlaut: \u00f6 (or just type it if encoding supports)
    - u with umlaut: \u00fc
    - c with cedilla: \u00e7
    - s with cedilla: \u015f
    - g with breve: \u011f
    - i without dot: \u0131 (lowercase), I with dot: \u0130 (uppercase)

    Use Unicode escapes in JSON to be safe: "G\u00f6rev", "\u015eirket", "Olu\u015fturulma", "De\u011fer", "Olas\u0131l\u0131k", "\u015eehir", "\u00dclke", "T\u00fcr", "\u00d6ncelik", "Biti\u015f Tarihi", "\u00dcr\u00fcn Ad\u0131", "Ki\u015fi", "Anla\u015fma", "D\u00fczenleme Tarihi", "\u00c7\u00f6z\u00fclme", "G\u00f6nderen", "\u00d6nizleme", "D\u00f6n\u00fc\u015ft\u00fcr\u00fcld\u00fc", "S\u0131cakl\u0131k", "G\u00fcncelleme", "Ba\u015fl\u0131k", "Kapanma Tarihi", "A\u015fama", "Sekt\u00f6r"
  </action>
  <verify>
    Run `cd globcrm-web && npx ng build --configuration development` -- 0 errors.
    Run `cd globcrm-web && npm run check:i18n` -- key parity passes for all modified scope JSONs.
    Grep for `labelKey` in all 9 entity list components to confirm all have been updated.
  </verify>
  <done>
    All 9 entity list components (contacts, deals, companies, leads, activities, products, quotes, requests, emails) plus notes use labelKey in coreColumnDefs. Each scope's EN and TR JSON files have a `columns` section with matching keys.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix notification type translation key mismatch and hardcoded labels</name>
  <files>
    globcrm-web/src/app/features/my-day/widgets/notification-digest-widget/notification-digest-widget.component.ts
    globcrm-web/src/app/features/settings/notification-preferences/notification-preferences.component.ts
    globcrm-web/src/assets/i18n/my-day/en.json
    globcrm-web/src/assets/i18n/my-day/tr.json
    globcrm-web/src/assets/i18n/settings/en.json
    globcrm-web/src/assets/i18n/settings/tr.json
  </files>
  <action>
    **Problem:** The backend sends NotificationType enum values in PascalCase (`ActivityAssigned`, `DealStageChanged`, `Mention`, `DueDateApproaching`, `EmailReceived`), but the my-day JSON has snake_case keys (`assignment`, `mention`, `status_change`, `comment`, `due_date`, `new_lead`, `deal_won`, `deal_lost`). These don't match, so `typeLabel()` falls back to the `toUpperCase()` fallback which also breaks Turkish locale I/i rules.

    **Fix my-day/en.json:**
    Replace the `widgets.notifications.types` keys to match actual backend enum values AND keep the extra client-side types that may come from the MyDay API:
    ```json
    "types": {
      "ActivityAssigned": "Assignments",
      "DealStageChanged": "Stage Changes",
      "Mention": "Mentions",
      "DueDateApproaching": "Due Dates",
      "EmailReceived": "Emails",
      "assignment": "Assignments",
      "mention": "Mentions",
      "status_change": "Status Changes",
      "comment": "Comments",
      "due_date": "Due Dates",
      "new_lead": "New Leads",
      "deal_won": "Deals Won",
      "deal_lost": "Deals Lost"
    }
    ```
    This dual-key approach ensures both PascalCase (from NotificationType enum) and snake_case (from MyDay API grouping) resolve. Add corresponding Turkish translations.

    **Fix my-day/tr.json:**
    Add matching Turkish translations:
    ```json
    "types": {
      "ActivityAssigned": "Atamalar",
      "DealStageChanged": "A\u015fama De\u011fi\u015fiklikleri",
      "Mention": "Bahsetmeler",
      "DueDateApproaching": "Yakla\u015fan Tarihler",
      "EmailReceived": "E-postalar",
      "assignment": "Atamalar",
      "mention": "Bahsetmeler",
      "status_change": "Durum De\u011fi\u015fiklikleri",
      "comment": "Yorumlar",
      "due_date": "Yakla\u015fan Tarihler",
      "new_lead": "Yeni Adaylar",
      "deal_won": "Kazanilan Anlasma",
      "deal_lost": "Kaybedilen Anlasma"
    }
    ```

    **Fix notification-digest-widget.component.ts:**
    In the `typeLabel()` method, remove the `toUpperCase()` fallback. The current code already handles the fallback correctly (returns humanized string when translation key doesn't exist), just remove the `.toUpperCase()` call or replace it with nothing (the `replace(/\b\w/g, ...)` already title-cases). The translation keys should now match, so the fallback rarely triggers.

    Also fix the `relativeTime()` method to use translation keys instead of hardcoded English:
    ```typescript
    relativeTime(dateStr: string): string {
      const date = new Date(dateStr);
      const now = new Date();
      const diffMs = now.getTime() - date.getTime();
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);

      if (diffMins < 1) return this.translocoService.translate('my-day.widgets.notifications.time.justNow');
      if (diffMins < 60) return this.translocoService.translate('my-day.widgets.notifications.time.minutes', { count: diffMins });
      if (diffHours < 24) return this.translocoService.translate('my-day.widgets.notifications.time.hours', { count: diffHours });
      const locale = this.translocoService.getActiveLang() === 'tr' ? 'tr-TR' : 'en-US';
      return date.toLocaleTimeString(locale, { hour: 'numeric', minute: '2-digit' });
    }
    ```

    Add time translation keys to my-day EN/TR JSONs under `widgets.notifications.time`:
    ```json
    // EN
    "time": {
      "justNow": "just now",
      "minutes": "{{count}}m",
      "hours": "{{count}}h"
    }
    // TR
    "time": {
      "justNow": "az \u00f6nce",
      "minutes": "{{count}}dk",
      "hours": "{{count}}sa"
    }
    ```

    **Fix notification-preferences.component.ts:**
    Replace the hardcoded `NOTIFICATION_TYPE_LABELS` and `NOTIFICATION_TYPE_DESCRIPTIONS` const objects. Instead, inject `TranslocoService` (already injected) and build labels/descriptions dynamically using translation keys.

    Remove the `NOTIFICATION_TYPE_LABELS` const. Remove the `NOTIFICATION_TYPE_DESCRIPTIONS` const.

    In `loadPreferences()` and `generateDefaults()`, replace `NOTIFICATION_TYPE_LABELS[type]` with `this.transloco.translate('settings.notifications.typeLabels.' + type)`.

    Replace `getNotificationDescription(type: string)` to use `this.transloco.translate('settings.notifications.typeDescriptions.' + type)`.

    Add to settings/en.json under `notifications`:
    ```json
    "typeLabels": {
      "ActivityAssigned": "Activity Assigned",
      "DealStageChanged": "Deal Stage Changed",
      "Mention": "Mentions",
      "DueDateApproaching": "Due Date Approaching",
      "EmailReceived": "Email Received"
    },
    "typeDescriptions": {
      "ActivityAssigned": "Get notified when a task or activity is assigned to you",
      "DealStageChanged": "Track when deals move between pipeline stages",
      "Mention": "Know when someone mentions you in notes or comments",
      "DueDateApproaching": "Receive reminders before tasks and activities are due",
      "EmailReceived": "Stay informed when new emails arrive for your contacts"
    }
    ```

    Add corresponding Turkish translations to settings/tr.json under `notifications`:
    ```json
    "typeLabels": {
      "ActivityAssigned": "G\u00f6rev Atand\u0131",
      "DealStageChanged": "Anla\u015fma A\u015famas\u0131 De\u011fi\u015fti",
      "Mention": "Bahsetmeler",
      "DueDateApproaching": "Yakla\u015fan Tarih",
      "EmailReceived": "E-posta Al\u0131nd\u0131"
    },
    "typeDescriptions": {
      "ActivityAssigned": "Size bir g\u00f6rev veya aktivite atand\u0131\u011f\u0131nda bildirim al\u0131n",
      "DealStageChanged": "Anla\u015fmalar a\u015famalar aras\u0131nda ge\u00e7ti\u011finde takip edin",
      "Mention": "Birisi sizi notlarda veya yorumlarda bahsetti\u011finde bilin",
      "DueDateApproaching": "G\u00f6revler ve aktiviteler tamamlanmadan \u00f6nce hat\u0131rlat\u0131c\u0131 al\u0131n",
      "EmailReceived": "Ki\u015fileriniz i\u00e7in yeni e-postalar geldi\u011finde haberdar olun"
    }
    ```

    **CRITICAL:** After modifying all JSON files, run `cd globcrm-web && npm run check:i18n` to ensure EN/TR key parity. If there are mismatches, fix them before committing.
  </action>
  <verify>
    Run `cd globcrm-web && npx ng build --configuration development` -- 0 errors.
    Run `cd globcrm-web && npm run check:i18n` -- 0 errors (key parity maintained, baseline unchanged at 2 false-positives).
    Grep `NOTIFICATION_TYPE_LABELS` in notification-preferences -- should not exist as const anymore (replaced with translate calls).
    Grep `toUpperCase` in notification-digest-widget -- should not exist (removed locale-breaking fallback).
  </verify>
  <done>
    All entity list column headers translate correctly via labelKey. Notification type keys match backend enum values. Notification preference labels and descriptions use translation keys instead of hardcoded English. relativeTime method uses locale-aware translation keys. CI i18n check passes.
  </done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration development` -- 0 errors
2. `cd globcrm-web && npm run check:i18n` -- 0 errors (key parity maintained)
3. All 9 entity list components have `labelKey` in coreColumnDefs
4. Each feature scope JSON has a `columns` section in both EN and TR
5. my-day JSON has PascalCase enum-matched notification type keys
6. Notification preferences use translate() instead of hardcoded const maps
7. No `toUpperCase()` without locale awareness in notification components
</verification>

<success_criteria>
- Switching language to Turkish shows translated column headers on contacts, deals, companies, leads, activities, products, quotes, requests, and email list pages
- Notification category names in My Day widget display in Turkish with correct casing
- Notification preference labels and descriptions in Settings display in Turkish
- CI i18n validation passes with 0 errors
- Build compiles with 0 errors
</success_criteria>

<output>
After completion, create `.planning/phases/28-localization-string-extraction/28-12-SUMMARY.md`
</output>
