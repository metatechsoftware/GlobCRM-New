---
phase: 28-localization-string-extraction
plan: 10
type: execute
wave: 2
depends_on: [28-08, 28-09]
files_modified:
  - globcrm-web/src/assets/i18n/activities/en.json
  - globcrm-web/src/assets/i18n/activities/tr.json
  - globcrm-web/src/assets/i18n/deals/en.json
  - globcrm-web/src/assets/i18n/deals/tr.json
  - globcrm-web/src/assets/i18n/quotes/en.json
  - globcrm-web/src/assets/i18n/quotes/tr.json
  - globcrm-web/src/assets/i18n/requests/en.json
  - globcrm-web/src/assets/i18n/requests/tr.json
  - globcrm-web/src/assets/i18n/contacts/en.json
  - globcrm-web/src/assets/i18n/contacts/tr.json
  - globcrm-web/src/assets/i18n/companies/en.json
  - globcrm-web/src/assets/i18n/companies/tr.json
  - globcrm-web/src/assets/i18n/leads/en.json
  - globcrm-web/src/assets/i18n/leads/tr.json
  - globcrm-web/src/assets/i18n/products/en.json
  - globcrm-web/src/assets/i18n/products/tr.json
  - globcrm-web/src/assets/i18n/duplicates/en.json
  - globcrm-web/src/assets/i18n/duplicates/tr.json
  - globcrm-web/src/assets/i18n/auth/en.json
  - globcrm-web/src/assets/i18n/auth/tr.json
  - globcrm-web/src/assets/i18n/email-templates/en.json
  - globcrm-web/src/assets/i18n/email-templates/tr.json
  - globcrm-web/src/assets/i18n/sequences/en.json
  - globcrm-web/src/assets/i18n/sequences/tr.json
  - globcrm-web/src/assets/i18n/workflows/en.json
  - globcrm-web/src/assets/i18n/workflows/tr.json
  - globcrm-web/src/app/features/activities/activity-detail/activity-detail.component.html
  - globcrm-web/src/app/features/activities/activity-form/activity-form.component.ts
  - globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.html
  - globcrm-web/src/app/features/deals/deal-form/deal-form.component.html
  - globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html
  - globcrm-web/src/app/features/quotes/quote-form/quote-form.component.ts
  - globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
  - globcrm-web/src/app/features/requests/request-form/request-form.component.ts
  - globcrm-web/src/app/features/contacts/contact-form/contact-form.component.html
  - globcrm-web/src/app/features/companies/company-form/company-form.component.html
  - globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.html
  - globcrm-web/src/app/features/leads/lead-kanban/lead-kanban.component.html
  - globcrm-web/src/app/features/products/product-detail/product-detail.component.html
  - globcrm-web/src/app/features/products/product-form/product-form.component.html
  - globcrm-web/src/app/features/duplicates/merge-comparison/merge-comparison.component.ts
  - globcrm-web/src/app/features/auth/pages/two-factor/two-factor.component.html
  - globcrm-web/src/app/features/email-templates/email-template-preview/email-template-preview.component.html
  - globcrm-web/src/app/features/sequences/sequence-builder/step-item.component.ts
  - globcrm-web/src/app/features/sequences/sequence-builder/template-picker-dialog.component.ts
  - globcrm-web/src/app/features/workflows/workflow-builder/nodes/branch-node.component.ts
  - globcrm-web/src/app/features/workflows/workflow-builder/workflow-canvas.component.ts
  - globcrm-web/src/app/features/workflows/workflow-builder/workflow-toolbar.component.ts
  - globcrm-web/scripts/i18n-baseline.json
  - globcrm-web/scripts/check-translations.js
  - .planning/REQUIREMENTS.md
autonomous: true
gap_closure: true
requirements:
  - LOCL-03
  - LOCL-09
  - LOCL-10
must_haves:
  truths:
    - "Navigating to Activities, Deals, and Workflows in Turkish shows all aria-labels and remaining strings in Turkish (not English)"
    - "All 54 remaining feature template hardcoded strings extracted and wired with transloco"
    - "i18n-baseline.json has near-zero entries (only genuine false positives like template expressions)"
    - "npm run check:i18n passes with 0 errors and minimal warnings"
    - "REQUIREMENTS.md LOCL-09 marked as complete"
  artifacts:
    - path: "globcrm-web/scripts/i18n-baseline.json"
      provides: "Reduced baseline with near-zero entries"
    - path: ".planning/REQUIREMENTS.md"
      provides: "LOCL-09 marked [x] Complete"
      contains: "[x] **LOCL-09**"
  key_links:
    - from: "check-translations.js"
      to: "i18n-baseline.json"
      via: "baseline comparison for hardcoded string detection"
      pattern: "i18n-baseline"
    - from: "activity-detail.component.html"
      to: "activities/en.json"
      via: "transloco pipe with scoped keys"
      pattern: "transloco"
    - from: "workflow-toolbar.component.ts"
      to: "workflows/en.json"
      via: "transloco pipe with scoped keys"
      pattern: "transloco"
---

<objective>
Extract the final 54 hardcoded strings scattered across 16 feature template files (activities, deals, quotes, requests, contacts, companies, leads, products, duplicates, auth, email-templates, sequences, workflows), regenerate the i18n baseline to near-zero, and update requirements tracking.

Purpose: Close the final gap cluster to achieve Truth 3 ("No hardcoded English strings remain in any component template") and mark LOCL-09 as complete in requirements. After this plan, the 347-entry baseline should be reduced to fewer than 10 entries (genuine false positives only).

Output: All feature template hardcoded strings extracted, baseline regenerated, requirements updated.
</objective>

<execution_context>
@C:/Users/maliy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/maliy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/28-localization-string-extraction/28-CONTEXT.md
@.planning/phases/28-localization-string-extraction/28-RESEARCH.md
@.planning/phases/28-localization-string-extraction/28-VERIFICATION.md
@.planning/phases/28-localization-string-extraction/28-08-SUMMARY.md
@.planning/phases/28-localization-string-extraction/28-09-SUMMARY.md
@globcrm-web/scripts/i18n-baseline.json
@globcrm-web/scripts/check-translations.js
</context>

<tasks>

<task type="auto">
  <name>Task 1a: Extract feature template strings for activities + deals + quotes (23 strings, 12 files)</name>
  <files>
    globcrm-web/src/assets/i18n/activities/en.json
    globcrm-web/src/assets/i18n/activities/tr.json
    globcrm-web/src/assets/i18n/deals/en.json
    globcrm-web/src/assets/i18n/deals/tr.json
    globcrm-web/src/assets/i18n/quotes/en.json
    globcrm-web/src/assets/i18n/quotes/tr.json
    globcrm-web/src/app/features/activities/activity-detail/activity-detail.component.html
    globcrm-web/src/app/features/activities/activity-form/activity-form.component.ts
    globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.html
    globcrm-web/src/app/features/deals/deal-form/deal-form.component.html
    globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html
    globcrm-web/src/app/features/quotes/quote-form/quote-form.component.ts
  </files>
  <action>
    Extract 23 hardcoded strings from 6 component files across 3 feature scopes (activities, deals, quotes). These are primarily aria-labels, back-button labels, and small missed strings.

    **Approach:** For each file, read the baseline entries, check if the translation key already exists in the feature's scope JSON, and either add missing keys or wire existing ones in the template.

    **File-by-file breakdown (from baseline):**

    **Activities (11 strings, 2 files):**
    - activity-detail.component.html: "Company", "Contact", "Deal" (linked entity labels), plus 7 aria-labels (Back to activities, Delete, Delete comment, Delete time entry, Download, Edit comment, Unlink)
    - activity-form.component.ts: 1 aria-label (Back to activities)
    - Add to activities/en.json: `detail.linkedEntity.company`, `detail.linkedEntity.contact`, `detail.linkedEntity.deal`, `detail.aria.backToActivities`, `detail.aria.delete`, `detail.aria.deleteComment`, `detail.aria.deleteTimeEntry`, `detail.aria.download`, `detail.aria.editComment`, `detail.aria.unlink`, `form.aria.backToActivities`
    - Turkish: Sirket, Kisi, Anlasma, aria-labels translated (Etkinliklere don, Sil, Yorumu sil, etc.)

    **Deals (5 strings, 2 files):**
    - deal-detail.component.html: 4 aria-labels (Link contact, Link product, Unlink contact, Unlink product)
    - deal-form.component.html: 1 aria-label (Clear company)
    - Add to deals/en.json: `detail.aria.linkContact`, `detail.aria.linkProduct`, `detail.aria.unlinkContact`, `detail.aria.unlinkProduct`, `form.aria.clearCompany`

    **Quotes (7 strings, 2 files):**
    - quote-detail.component.html: 1 aria-label (Back to quotes)
    - quote-form.component.ts: 6 strings — aria-labels (Back to quotes, Clear company, Clear contact, Clear deal, Remove line item), 1 placeholder (Description)
    - Add to quotes/en.json: `detail.aria.backToQuotes`, `form.aria.backToQuotes`, `form.aria.clearCompany`, `form.aria.clearContact`, `form.aria.clearDeal`, `form.aria.removeLineItem`, `form.fields.descriptionPlaceholder`

    For each file:
    1. Read current feature scope JSON to check for existing keys
    2. Add missing keys to both en.json and tr.json
    3. Replace hardcoded string in template with `{{ 'key' | transloco }}` or `[attr]="'key' | transloco"`
    4. Ensure TranslocoPipe is in the component's imports array

    **Turkish translations for aria-labels / accessibility strings:**
    - Back to X -> X sayfasina don
    - Clear company -> Sirket temizle
    - Clear contact -> Kisiyi temizle
    - Clear deal -> Anlasmayı temizle
    - Link contact -> Kisi bagla
    - Link product -> Urun bagla
    - Unlink contact -> Kisi baglantisini kaldir
    - Unlink product -> Urun baglantisini kaldir
    - Delete -> Sil
    - Delete comment -> Yorumu sil
    - Delete time entry -> Zaman kaydini sil
    - Download -> Indir
    - Edit comment -> Yorumu duzenle
    - Unlink -> Baglanti kaldir
    - Remove line item -> Satir ogesini kaldir
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Run `cd globcrm-web && npm run check:i18n` — key parity passes for activities, deals, quotes scopes
  </verify>
  <done>All 23 hardcoded strings in activities, deals, and quotes templates extracted to their respective scope JSON files. All 3 feature scope pairs (en/tr) maintain key parity. Angular build compiles successfully.</done>
</task>

<task type="auto">
  <name>Task 1b: Extract feature template strings for requests + contacts + companies + leads (9 strings, 14 files)</name>
  <files>
    globcrm-web/src/assets/i18n/requests/en.json
    globcrm-web/src/assets/i18n/requests/tr.json
    globcrm-web/src/assets/i18n/contacts/en.json
    globcrm-web/src/assets/i18n/contacts/tr.json
    globcrm-web/src/assets/i18n/companies/en.json
    globcrm-web/src/assets/i18n/companies/tr.json
    globcrm-web/src/assets/i18n/leads/en.json
    globcrm-web/src/assets/i18n/leads/tr.json
    globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
    globcrm-web/src/app/features/requests/request-form/request-form.component.ts
    globcrm-web/src/app/features/contacts/contact-form/contact-form.component.html
    globcrm-web/src/app/features/companies/company-form/company-form.component.html
    globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.html
    globcrm-web/src/app/features/leads/lead-kanban/lead-kanban.component.html
  </files>
  <action>
    Extract 9 hardcoded strings from 6 component files across 4 feature scopes (requests, contacts, companies, leads). Same mechanical approach as Task 1a.

    **File-by-file breakdown (from baseline):**

    **Requests (4 strings, 2 files):**
    - request-detail.component.ts: 1 aria-label (Back to requests)
    - request-form.component.ts: 3 aria-labels (Back to requests, Clear company, Clear contact)
    - Add to requests/en.json: `detail.aria.backToRequests`, `form.aria.backToRequests`, `form.aria.clearCompany`, `form.aria.clearContact`
    - Turkish: Isteklere don, Sirket temizle, Kisiyi temizle

    **Contacts (2 strings, 1 file):**
    - contact-form.component.html: 2 aria-labels (Clear company, Dismiss warning)
    - Add to contacts/en.json: `form.aria.clearCompany`, `form.aria.dismissWarning`
    - Turkish: Sirket temizle, Uyariyi kapat

    **Companies (1 string, 1 file):**
    - company-form.component.html: 1 aria-label (Dismiss warning)
    - Add to companies/en.json: `form.aria.dismissWarning`
    - Turkish: Uyariyi kapat

    **Leads (2 strings, 2 files):**
    - lead-detail.component.html: "Timeline" text (1 string)
    - lead-kanban.component.html: "14 && lead.daysInStage" — this is likely a FALSE POSITIVE from the CI script parsing a template expression like `@if(lead.daysInStage > 14 && lead.daysInStage)`. Verify and skip if not an actual hardcoded string.
    - Add to leads/en.json if needed: `detail.tabs.timeline`
    - Turkish: Zaman Cizelgesi

    For each file:
    1. Read current feature scope JSON to check for existing keys
    2. Add missing keys to both en.json and tr.json
    3. Replace hardcoded string in template with `{{ 'key' | transloco }}` or `[attr]="'key' | transloco"`
    4. Ensure TranslocoPipe is in the component's imports array
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Run `cd globcrm-web && npm run check:i18n` — key parity passes for requests, contacts, companies, leads scopes
  </verify>
  <done>All 9 hardcoded strings in requests, contacts, companies, and leads templates extracted to their respective scope JSON files. All 4 feature scope pairs (en/tr) maintain key parity. Angular build compiles successfully.</done>
</task>

<task type="auto">
  <name>Task 1c: Extract feature template strings for products + duplicates + auth (8 strings, 10 files)</name>
  <files>
    globcrm-web/src/assets/i18n/products/en.json
    globcrm-web/src/assets/i18n/products/tr.json
    globcrm-web/src/assets/i18n/duplicates/en.json
    globcrm-web/src/assets/i18n/duplicates/tr.json
    globcrm-web/src/assets/i18n/auth/en.json
    globcrm-web/src/assets/i18n/auth/tr.json
    globcrm-web/src/app/features/products/product-detail/product-detail.component.html
    globcrm-web/src/app/features/products/product-form/product-form.component.html
    globcrm-web/src/app/features/duplicates/merge-comparison/merge-comparison.component.ts
    globcrm-web/src/app/features/auth/pages/two-factor/two-factor.component.html
  </files>
  <action>
    Extract 8 hardcoded strings from 4 component files across 3 feature scopes (products, duplicates, auth). Same mechanical approach as Tasks 1a/1b.

    **File-by-file breakdown (from baseline):**

    **Products (2 strings, 2 files):**
    - product-detail.component.html: 1 aria-label (Back to products)
    - product-form.component.html: 1 aria-label (Back to products)
    - Add to products/en.json: `detail.aria.backToProducts`, `form.aria.backToProducts`
    - Turkish: Urunlere don

    **Duplicates (4 strings, 1 file):**
    - merge-comparison.component.ts: 4 aria-labels (Back to scan, Select Record A value, Select Record B value, Swap primary record)
    - Add to duplicates/en.json: `merge.aria.backToScan`, `merge.aria.selectRecordA`, `merge.aria.selectRecordB`, `merge.aria.swapPrimary`
    - Turkish: Taramaya don, Kayit A degerini sec, Kayit B degerini sec, Birincil kaydi degistir

    **Auth (2 strings, 1 file):**
    - two-factor.component.html: 1 alt text (2FA QR Code), 1 aria-label (Go back)
    - Add to auth/en.json: `twoFactor.qrCodeAlt`, `twoFactor.aria.goBack`
    - Turkish: 2FA QR Kodu, Geri don

    For each file:
    1. Read current feature scope JSON to check for existing keys
    2. Add missing keys to both en.json and tr.json
    3. Replace hardcoded string in template with `{{ 'key' | transloco }}` or `[attr]="'key' | transloco"`
    4. Ensure TranslocoPipe is in the component's imports array
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Run `cd globcrm-web && npm run check:i18n` — key parity passes for products, duplicates, auth scopes
  </verify>
  <done>All 8 hardcoded strings in products, duplicates, and auth templates extracted to their respective scope JSON files. All 3 feature scope pairs (en/tr) maintain key parity. Angular build compiles successfully.</done>
</task>

<task type="auto">
  <name>Task 1d: Extract feature template strings for email-templates + sequences + workflows (14 strings, 12 files)</name>
  <files>
    globcrm-web/src/assets/i18n/email-templates/en.json
    globcrm-web/src/assets/i18n/email-templates/tr.json
    globcrm-web/src/assets/i18n/sequences/en.json
    globcrm-web/src/assets/i18n/sequences/tr.json
    globcrm-web/src/assets/i18n/workflows/en.json
    globcrm-web/src/assets/i18n/workflows/tr.json
    globcrm-web/src/app/features/email-templates/email-template-preview/email-template-preview.component.html
    globcrm-web/src/app/features/sequences/sequence-builder/step-item.component.ts
    globcrm-web/src/app/features/sequences/sequence-builder/template-picker-dialog.component.ts
    globcrm-web/src/app/features/workflows/workflow-builder/nodes/branch-node.component.ts
    globcrm-web/src/app/features/workflows/workflow-builder/workflow-canvas.component.ts
    globcrm-web/src/app/features/workflows/workflow-builder/workflow-toolbar.component.ts
  </files>
  <action>
    Extract 14 hardcoded strings from 6 component files across 3 feature scopes (email-templates, sequences, workflows). Same mechanical approach as prior tasks.

    **File-by-file breakdown (from baseline):**

    **Email Templates (2 strings, 1 file):**
    - email-template-preview.component.html: 1 aria-label (Device preview mode), 1 placeholder (Type to search...)
    - Add to email-templates/en.json: `preview.aria.devicePreview`, `preview.searchPlaceholder`
    - Turkish: Cihaz onizleme modu, Aramak icin yazin...

    **Sequences (2 strings, 2 files):**
    - step-item.component.ts: 1 title (Template preview)
    - template-picker-dialog.component.ts: 1 title (Template preview)
    - Add to sequences/en.json: `builder.templatePreviewTitle`
    - Turkish: Sablon onizleme

    **Workflows (10 strings, 3 files):**
    - branch-node.component.ts: "Yes" (1 string)
    - workflow-canvas.component.ts: "Yes" + 3 title attributes (Fit to view, Zoom in, Zoom out)
    - workflow-toolbar.component.ts: 5 entity type labels (Activity, Company, Contact, Deal, Lead)
    - Add to workflows/en.json: `builder.branchYes`, `builder.canvas.fitToView`, `builder.canvas.zoomIn`, `builder.canvas.zoomOut`, `builder.canvas.confirmYes`, `builder.toolbar.entityTypes.activity`, `builder.toolbar.entityTypes.company`, `builder.toolbar.entityTypes.contact`, `builder.toolbar.entityTypes.deal`, `builder.toolbar.entityTypes.lead`
    - Turkish: Evet, Ekrana sigdir, Yakinlastir, Uzaklastir, Etkinlik, Sirket, Kisi, Anlasma, Aday

    For each file:
    1. Read current feature scope JSON to check for existing keys
    2. Add missing keys to both en.json and tr.json
    3. Replace hardcoded string in template with `{{ 'key' | transloco }}` or `[attr]="'key' | transloco"`
    4. Ensure TranslocoPipe is in the component's imports array
  </action>
  <verify>
    1. Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` — must compile without errors
    2. Run `cd globcrm-web && npm run check:i18n` — key parity passes for email-templates, sequences, workflows scopes
  </verify>
  <done>All 14 hardcoded strings in email-templates, sequences, and workflows templates extracted to their respective scope JSON files. All 3 feature scope pairs (en/tr) maintain key parity. Angular build compiles successfully.</done>
</task>

<task type="auto">
  <name>Task 2: Regenerate baseline, verify near-zero count, update requirements</name>
  <files>
    globcrm-web/scripts/i18n-baseline.json
    globcrm-web/scripts/check-translations.js
    .planning/REQUIREMENTS.md
  </files>
  <action>
    **Step 1: Regenerate the i18n baseline.**

    Run: `cd globcrm-web && node scripts/check-translations.js --update-baseline`

    This regenerates i18n-baseline.json with only the remaining hardcoded strings that still exist after plans 28-08, 28-09, and Tasks 1a/1b/1c/1d of this plan.

    **Step 2: Verify the baseline count.**

    Read the regenerated i18n-baseline.json. The `count` field should be under 10. Remaining entries should ONLY be:
    - Genuine false positives (template expressions parsed incorrectly, like the `lead.daysInStage` conditional)
    - Intentionally untranslated brand names or technical terms

    If count > 10, investigate and extract any remaining genuine hardcoded strings before proceeding.

    **Step 3: Run the full CI check.**

    Run: `cd globcrm-web && npm run check:i18n`

    Expected output:
    - Key parity: 0 errors
    - Hardcoded strings: 0 new errors (all remaining are baselined)
    - Unused keys: Warnings only (acceptable)

    The script should exit with code 0 (success).

    **Step 4: Review unused key warnings.**

    If unused keys > 200, some keys added proactively in earlier plans never got wired into templates. This is acceptable as a warning but worth documenting. If any of these unused keys correspond to strings that WERE extracted in plans 28-08/09/10, something is wrong — investigate.

    **Step 5: Update REQUIREMENTS.md.**

    In `.planning/REQUIREMENTS.md`, change LOCL-09 from `[ ]` to `[x]`:
    ```
    - [x] **LOCL-09**: CI check validates EN and TR translation files have matching key sets
    ```

    This was already functionally complete in 28-07 but the requirements doc was not updated. Now that the baseline is near-zero and CI genuinely passes, mark it complete.

    Also verify LOCL-03 and LOCL-10 remain marked `[x]` — they should already be from earlier plans. If LOCL-03 is still `[ ]`, mark it `[x]` since after gap closure all strings are extracted.

    **Step 6: Update the traceability table.**

    In the Traceability section, update:
    ```
    | LOCL-09 | Phase 28 | Complete |
    ```
  </action>
  <verify>
    1. `cd globcrm-web && npm run check:i18n` exits with code 0
    2. `node -e "const b=require('./globcrm-web/scripts/i18n-baseline.json'); console.log('Baseline count:', b.count)"` — outputs count < 10
    3. `grep "LOCL-09" .planning/REQUIREMENTS.md` shows `[x]`
    4. `grep "LOCL-09" .planning/REQUIREMENTS.md` in traceability table shows `Complete`
  </verify>
  <done>i18n-baseline.json regenerated with near-zero entries. CI check passes cleanly. LOCL-09 marked complete in REQUIREMENTS.md. All three Phase 28 success criteria are now met.</done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration development` compiles without errors
2. `cd globcrm-web && npm run check:i18n` passes with 0 errors
3. i18n-baseline.json count is under 10 (reduced from 347)
4. REQUIREMENTS.md shows LOCL-03, LOCL-09, LOCL-10 all as `[x]` Complete
5. All 21 feature scope EN/TR pairs have matching key sets
6. Switching to Turkish and navigating to Activities, Deals, and Workflows shows all aria-labels and remaining strings in Turkish (not English)
</verification>

<success_criteria>
- All 347 original baseline entries resolved (extracted or confirmed as false positives)
- i18n-baseline.json regenerated with fewer than 10 remaining entries
- npm run check:i18n exits with code 0 (zero errors)
- REQUIREMENTS.md updated: LOCL-09 = [x], traceability table shows Complete
- Angular build compiles successfully
- All three Phase 28 success criteria fully met
</success_criteria>

<output>
After completion, create `.planning/phases/28-localization-string-extraction/28-10-SUMMARY.md`
</output>
