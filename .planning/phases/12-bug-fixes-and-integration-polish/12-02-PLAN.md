---
phase: 12-bug-fixes-and-integration-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - globcrm-web/src/app/shared/components/confirm-delete-dialog/confirm-delete-dialog.component.ts
  - globcrm-web/src/app/features/settings/roles/role-list.component.ts
  - globcrm-web/src/app/features/companies/company-list/company-list.component.ts
  - globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
  - globcrm-web/src/app/features/contacts/contact-list/contact-list.component.ts
  - globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
  - globcrm-web/src/app/features/deals/deal-list/deal-list.component.ts
  - globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
  - globcrm-web/src/app/features/products/product-list/product-list.component.ts
  - globcrm-web/src/app/features/activities/activity-list/activity-list.component.ts
  - globcrm-web/src/app/features/activities/activity-detail/activity-detail.component.ts
  - globcrm-web/src/app/features/quotes/quote-list/quote-list.component.ts
  - globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts
  - globcrm-web/src/app/features/requests/request-list/request-list.component.ts
  - globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
  - globcrm-web/src/app/features/notes/note-detail/note-detail.component.ts
  - globcrm-web/src/app/features/settings/pipelines/pipeline-list.component.ts
  - globcrm-web/src/app/features/settings/teams/team-list.component.ts
autonomous: true

must_haves:
  truths:
    - "ConfirmDeleteDialogComponent lives in shared/components, not in a feature module"
    - "All 16 consuming files import from the shared location"
    - "CloneRoleDialogComponent remains in role-list.component.ts untouched"
    - "Delete confirmation dialogs continue to work across all entity pages"
  artifacts:
    - path: "globcrm-web/src/app/shared/components/confirm-delete-dialog/confirm-delete-dialog.component.ts"
      provides: "Standalone ConfirmDeleteDialogComponent in shared layer"
      exports: ["ConfirmDeleteDialogComponent"]
    - path: "globcrm-web/src/app/features/settings/roles/role-list.component.ts"
      provides: "RoleListComponent and CloneRoleDialogComponent (ConfirmDeleteDialog removed)"
      exports: ["RoleListComponent", "CloneRoleDialogComponent"]
  key_links:
    - from: "16 consumer files"
      to: "globcrm-web/src/app/shared/components/confirm-delete-dialog/confirm-delete-dialog.component.ts"
      via: "import { ConfirmDeleteDialogComponent }"
      pattern: "from.*shared/components/confirm-delete-dialog"
---

<objective>
Extract ConfirmDeleteDialogComponent from the settings feature into shared/components and update all 16 consuming files to import from the new location.

Purpose: Fix architectural coupling where a shared dialog component lives inside a specific feature module (settings/roles), creating deep cross-feature import paths. Moving to shared/ makes the dependency tree cleaner and the component properly discoverable.
Output: New shared component file + updated imports across 17 files (16 consumers + 1 source).
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-bug-fixes-and-integration-polish/12-RESEARCH.md
@globcrm-web/src/app/features/settings/roles/role-list.component.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared ConfirmDeleteDialogComponent</name>
  <files>
    globcrm-web/src/app/shared/components/confirm-delete-dialog/confirm-delete-dialog.component.ts
    globcrm-web/src/app/features/settings/roles/role-list.component.ts
  </files>
  <action>
    1. Create new file `globcrm-web/src/app/shared/components/confirm-delete-dialog/confirm-delete-dialog.component.ts` with the following content (extracted verbatim from role-list.component.ts lines 207-225):

    ```typescript
    import { Component, inject } from '@angular/core';
    import { CommonModule } from '@angular/common';
    import { MatDialogModule, MAT_DIALOG_DATA } from '@angular/material/dialog';
    import { MatButtonModule } from '@angular/material/button';

    @Component({
      selector: 'app-confirm-delete-dialog',
      standalone: true,
      imports: [CommonModule, MatDialogModule, MatButtonModule],
      template: `
        <h2 mat-dialog-title>Confirm Delete</h2>
        <mat-dialog-content>
          <p>Are you sure you want to delete the {{ data.type }} "{{ data.name }}"?</p>
          <p>This action cannot be undone.</p>
        </mat-dialog-content>
        <mat-dialog-actions align="end">
          <button mat-button mat-dialog-close>Cancel</button>
          <button mat-flat-button color="warn" [mat-dialog-close]="true">Delete</button>
        </mat-dialog-actions>
      `,
    })
    export class ConfirmDeleteDialogComponent {
      readonly data: { name: string; type: string } = inject(MAT_DIALOG_DATA);
    }
    ```

    2. In `role-list.component.ts`:
       - REMOVE the entire `ConfirmDeleteDialogComponent` class definition (the `// ---- Confirm Delete Dialog ----` comment block at lines 205-225, including the @Component decorator and class body).
       - ADD an import for `ConfirmDeleteDialogComponent` from the new shared location: `import { ConfirmDeleteDialogComponent } from '../../../shared/components/confirm-delete-dialog/confirm-delete-dialog.component';`
       - KEEP `CloneRoleDialogComponent` completely untouched (lines 165-203).
       - KEEP all existing imports that `CloneRoleDialogComponent` needs (MatDialogRef, MAT_DIALOG_DATA, etc.).
       - Verify the role-list.component.ts still references `ConfirmDeleteDialogComponent` in its `MatDialog.open()` call -- it should now use the imported version.
  </action>
  <verify>
    Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` to confirm no compilation errors.
    Verify the new shared file exists: `ls globcrm-web/src/app/shared/components/confirm-delete-dialog/`
    Verify `ConfirmDeleteDialogComponent` class is NOT in role-list.component.ts: grep should return 0 matches for `export class ConfirmDeleteDialogComponent` in that file.
    Verify `CloneRoleDialogComponent` IS still in role-list.component.ts.
  </verify>
  <done>
    New shared component file exists at shared/components/confirm-delete-dialog/.
    role-list.component.ts no longer defines ConfirmDeleteDialogComponent but imports it from shared.
    CloneRoleDialogComponent remains in role-list.component.ts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update all 16 consumer import paths to shared location</name>
  <files>
    globcrm-web/src/app/features/companies/company-list/company-list.component.ts
    globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
    globcrm-web/src/app/features/contacts/contact-list/contact-list.component.ts
    globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
    globcrm-web/src/app/features/deals/deal-list/deal-list.component.ts
    globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
    globcrm-web/src/app/features/products/product-list/product-list.component.ts
    globcrm-web/src/app/features/activities/activity-list/activity-list.component.ts
    globcrm-web/src/app/features/activities/activity-detail/activity-detail.component.ts
    globcrm-web/src/app/features/quotes/quote-list/quote-list.component.ts
    globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts
    globcrm-web/src/app/features/requests/request-list/request-list.component.ts
    globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
    globcrm-web/src/app/features/notes/note-detail/note-detail.component.ts
    globcrm-web/src/app/features/settings/pipelines/pipeline-list.component.ts
    globcrm-web/src/app/features/settings/teams/team-list.component.ts
  </files>
  <action>
    In all 16 files, find the import line for `ConfirmDeleteDialogComponent` and change the `from` path to point to the new shared location. Calculate the correct relative path based on each file's depth:

    **Files at `features/ENTITY/ENTITY-list/` or `features/ENTITY/ENTITY-detail/` (14 files):**
    Old import: `from '../../settings/roles/role-list.component'`
    New import: `from '../../../shared/components/confirm-delete-dialog/confirm-delete-dialog.component'`

    These 14 files:
    - features/companies/company-list/company-list.component.ts
    - features/companies/company-detail/company-detail.component.ts
    - features/contacts/contact-list/contact-list.component.ts
    - features/contacts/contact-detail/contact-detail.component.ts
    - features/deals/deal-list/deal-list.component.ts
    - features/deals/deal-detail/deal-detail.component.ts
    - features/products/product-list/product-list.component.ts
    - features/activities/activity-list/activity-list.component.ts
    - features/activities/activity-detail/activity-detail.component.ts
    - features/quotes/quote-list/quote-list.component.ts
    - features/quotes/quote-detail/quote-detail.component.ts
    - features/requests/request-list/request-list.component.ts
    - features/requests/request-detail/request-detail.component.ts
    - features/notes/note-detail/note-detail.component.ts

    **Files at `features/settings/FEATURE/` (2 files):**
    Old import: `from '../roles/role-list.component'`
    New import: `from '../../../shared/components/confirm-delete-dialog/confirm-delete-dialog.component'`

    These 2 files:
    - features/settings/pipelines/pipeline-list.component.ts
    - features/settings/teams/team-list.component.ts

    IMPORTANT: Only change the `from` path on the ConfirmDeleteDialogComponent import. Do NOT change any other imports in these files.

    PITFALL: Double-check relative path depth. From `features/X/Y/file.ts`, the path `../../../shared/` goes up 3 levels to `src/app/` then into `shared/`. From `features/settings/Z/file.ts`, the path is the same 3 levels (`../../../shared/`) because settings subfolders are also 3 deep under `src/app/`.
  </action>
  <verify>
    Run `cd globcrm-web && npx ng build --configuration development 2>&1 | tail -5` to confirm zero compilation errors.
    Grep for old import path: `grep -r "roles/role-list.component" globcrm-web/src/app/` should return ZERO matches for ConfirmDeleteDialogComponent (CloneRoleDialogComponent may still reference the file from within role-list.component.ts itself, which is fine).
    Grep for new import path: `grep -r "confirm-delete-dialog/confirm-delete-dialog.component" globcrm-web/src/app/` should return exactly 17 matches (16 consumers + the role-list.component.ts import).
  </verify>
  <done>
    All 16 consumer files import ConfirmDeleteDialogComponent from shared/components/confirm-delete-dialog/.
    No file imports ConfirmDeleteDialogComponent from the old settings/roles/role-list.component path.
    Angular build succeeds with zero errors.
  </done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration development` completes without errors.
2. `globcrm-web/src/app/shared/components/confirm-delete-dialog/confirm-delete-dialog.component.ts` exists and exports `ConfirmDeleteDialogComponent`.
3. `role-list.component.ts` no longer defines `ConfirmDeleteDialogComponent` but still defines `CloneRoleDialogComponent`.
4. `grep -r "ConfirmDeleteDialogComponent" globcrm-web/src/app/ | grep "from.*role-list"` returns 0 matches.
5. `grep -rc "ConfirmDeleteDialogComponent" globcrm-web/src/app/ | grep -v ":0"` returns 17+ files (new shared file + 16 consumers + role-list.component.ts).
</verification>

<success_criteria>
- ConfirmDeleteDialogComponent lives in shared/components/ (not in settings/roles/)
- All 16 consumer files import from the shared location
- CloneRoleDialogComponent remains untouched in role-list.component.ts
- Angular build succeeds with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/12-bug-fixes-and-integration-polish/12-02-SUMMARY.md`
</output>
