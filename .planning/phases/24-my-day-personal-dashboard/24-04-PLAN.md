---
phase: 24-my-day-personal-dashboard
plan: 04
type: execute
wave: 3
depends_on: [24-03]
files_modified:
  - globcrm-web/src/app/features/my-day/widgets/pipeline-widget/pipeline-widget.component.ts
  - globcrm-web/src/app/features/my-day/widgets/email-summary-widget/email-summary-widget.component.ts
  - globcrm-web/src/app/features/my-day/widgets/feed-preview-widget/feed-preview-widget.component.ts
  - globcrm-web/src/app/features/my-day/widgets/notification-digest-widget/notification-digest-widget.component.ts
  - globcrm-web/src/app/features/my-day/widgets/recent-records-widget/recent-records-widget.component.ts
  - globcrm-web/src/app/features/my-day/my-day.component.ts
  - globcrm-web/src/app/features/my-day/my-day.component.html
autonomous: true
requirements:
  - MYDAY-06
  - MYDAY-08
  - MYDAY-10
  - MYDAY-11
  - MYDAY-12

must_haves:
  truths:
    - "Pipeline widget shows a horizontal stacked bar chart of deal stages with colors, counts, and total value"
    - "Email summary widget shows unread count and last 5 recent emails"
    - "Feed preview widget shows last 5 feed items in compact format with entity links"
    - "Notification digest widget groups today's notifications by type with counts"
    - "Recent records widget shows last 8 recently viewed entities with type icons"
    - "All half-width widgets have empty states with friendly messages"
  artifacts:
    - path: "globcrm-web/src/app/features/my-day/widgets/pipeline-widget/pipeline-widget.component.ts"
      provides: "Half-width pipeline summary with horizontal stacked bar"
      contains: "PipelineWidgetComponent"
    - path: "globcrm-web/src/app/features/my-day/widgets/email-summary-widget/email-summary-widget.component.ts"
      provides: "Half-width email summary with unread count and recent list"
      contains: "EmailSummaryWidgetComponent"
    - path: "globcrm-web/src/app/features/my-day/widgets/feed-preview-widget/feed-preview-widget.component.ts"
      provides: "Half-width feed preview with compact feed items"
      contains: "FeedPreviewWidgetComponent"
    - path: "globcrm-web/src/app/features/my-day/widgets/notification-digest-widget/notification-digest-widget.component.ts"
      provides: "Half-width notification digest grouped by type"
      contains: "NotificationDigestWidgetComponent"
    - path: "globcrm-web/src/app/features/my-day/widgets/recent-records-widget/recent-records-widget.component.ts"
      provides: "Half-width recent records with entity type icons"
      contains: "RecentRecordsWidgetComponent"
  key_links:
    - from: "globcrm-web/src/app/features/my-day/my-day.component.html"
      to: "all 5 widget components"
      via: "template usage with store data"
      pattern: "app-pipeline-widget|app-email-summary|app-feed-preview|app-notification-digest|app-recent-records"
---

<objective>
Build the five secondary My Day widgets (pipeline summary, email summary, feed preview, notification digest, recent records) and wire them into the My Day page grid layout to complete the full widget set.

Purpose: Completes the My Day visual layout with all data widgets, giving users a comprehensive daily overview across pipeline health, communications, activity feed, notifications, and recently accessed records.
Output: Five new widget components integrated into the My Day CSS Grid, filling rows 2 and 3 of the layout.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-my-day-personal-dashboard/24-RESEARCH.md
@.planning/phases/24-my-day-personal-dashboard/24-03-SUMMARY.md
@globcrm-web/src/app/features/my-day/my-day.component.ts
@globcrm-web/src/app/features/my-day/my-day.component.html
@globcrm-web/src/app/features/my-day/my-day.models.ts
@globcrm-web/src/app/features/my-day/my-day.store.ts
@globcrm-web/src/app/shared/services/entity-type-registry.ts (entity icons/routing)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build pipeline, email summary, and feed preview widgets</name>
  <files>
    globcrm-web/src/app/features/my-day/widgets/pipeline-widget/pipeline-widget.component.ts
    globcrm-web/src/app/features/my-day/widgets/email-summary-widget/email-summary-widget.component.ts
    globcrm-web/src/app/features/my-day/widgets/feed-preview-widget/feed-preview-widget.component.ts
  </files>
  <action>
    1. **PipelineWidgetComponent** (`widgets/pipeline-widget/pipeline-widget.component.ts`):
       - Standalone, OnPush, single-file component (template + styles inline)
       - Inputs: `stages: MyDayPipelineStageDto[]`, `totalValue: number`, `dealCount: number`, `isLoading: boolean`
       - Template:
         - mat-card with title "My Pipeline" and handshake icon
         - **Horizontal stacked bar chart** using pure CSS:
           - Container div with `display: flex; height: 24px; border-radius: 12px; overflow: hidden`
           - Each stage: div with `flex: dealCount` (proportional width), `background-color: stage.color`
           - Tooltip on each segment showing stage name + count + value
         - Below the bar: legend showing colored dots + stage name + deal count for each stage
         - Summary text: "X deals · $Y total value" (format value with Intl.NumberFormat for currency)
         - Empty state: "No active deals" with shopping_cart icon
         - Loading state: shimmer bar + 3 shimmer legend rows

    2. **EmailSummaryWidgetComponent** (`widgets/email-summary-widget/email-summary-widget.component.ts`):
       - Standalone, OnPush, single-file component
       - Inputs: `unreadCount: number`, `recentEmails: MyDayEmailDto[]`, `isLoading: boolean`
       - Output: `emailClicked = output<string>()` — emits email ID
       - Template:
         - mat-card with title "Email" and email icon
         - Unread badge: "{N} unread" in a colored chip (use primary color if > 0, grey if 0)
         - Recent emails list (max 5):
           - Each: direction icon (call_received for inbound / send for outbound), subject (truncated to ~40 chars), fromName, relative time (use `DatePipe` or compute relative)
           - Unread emails: bold text styling
         - Click on email: emit emailClicked
         - Empty state: "Connect your email to see messages here" with link text "Set up email" routing to /settings (for users without connected email accounts). If connected but empty: "No recent emails".
         - Loading state: shimmer rows

    3. **FeedPreviewWidgetComponent** (`widgets/feed-preview-widget/feed-preview-widget.component.ts`):
       - Standalone, OnPush, single-file component
       - Inputs: `feedItems: MyDayFeedItemDto[]`, `isLoading: boolean`
       - Output: `entityClicked = output<{ type: string; id: string }>()` — for preview sidebar
       - Template:
         - mat-card with title "Activity Feed" and dynamic_feed icon
         - Compact feed item list (5 items):
           - Each: author avatar circle (first letter of authorName), content text (truncated to ~80 chars), entity name link (clickable), relative timestamp
           - Entity name styled as a link (primary color, cursor pointer)
           - Entity name click: emit entityClicked with type and id
         - "View all" link at bottom routing to /feed
         - Empty state: "No recent activity" with dynamic_feed icon
         - Loading state: shimmer rows with avatar circles
  </action>
  <verify>
    - `cd globcrm-web && npx ng build --configuration=development 2>&1 | tail -5` compiles
    - All three components are standalone with OnPush
    - Pipeline widget uses CSS flex for stacked bar (no chart library)
    - Email widget has unread count badge
    - Feed widget has entity name links with output emitter
  </verify>
  <done>
    - Pipeline widget renders horizontal stacked bar with stage colors, legend, and total summary
    - Email widget shows unread count and 5 recent emails with direction indicators
    - Feed preview widget shows 5 compact feed items with author initials, content, and entity links
    - All three have appropriate empty states and loading skeletons
  </done>
</task>

<task type="auto">
  <name>Task 2: Build notification digest and recent records widgets, integrate all into My Day page</name>
  <files>
    globcrm-web/src/app/features/my-day/widgets/notification-digest-widget/notification-digest-widget.component.ts
    globcrm-web/src/app/features/my-day/widgets/recent-records-widget/recent-records-widget.component.ts
    globcrm-web/src/app/features/my-day/my-day.component.ts
    globcrm-web/src/app/features/my-day/my-day.component.html
  </files>
  <action>
    1. **NotificationDigestWidgetComponent** (`widgets/notification-digest-widget/notification-digest-widget.component.ts`):
       - Standalone, OnPush, single-file component
       - Inputs: `notificationGroups: MyDayNotificationGroupDto[]`, `totalCount: number`, `isLoading: boolean`
       - Output: `notificationClicked = output<{ type: string; id: string }>()` — for navigating to entity
       - Template:
         - mat-card with title "Notifications" and notifications icon
         - Total count badge: "{N} today"
         - Grouped list: for each group:
           - Group header: icon based on type (assignment, mention, status_change, etc.) + type label + count badge
           - First 3 items in group: title text, relative timestamp
           - If group has > 3 items: "+N more" text
         - Click on notification with entityType/entityId: emit notificationClicked
         - Empty state: "All caught up!" with notifications_none icon
         - Loading state: 3 shimmer group headers

    2. **RecentRecordsWidgetComponent** (`widgets/recent-records-widget/recent-records-widget.component.ts`):
       - Standalone, OnPush, single-file component
       - Inputs: `records: MyDayRecentRecordDto[]`, `isLoading: boolean`
       - Output: `recordClicked = output<{ type: string; id: string }>()` — for preview sidebar
       - Inject: `ENTITY_TYPE_REGISTRY` from `entity-type-registry.ts` (or import the constant) for entity icons and route paths
       - Template:
         - mat-card with title "Recent Records" and history icon
         - List of 8 items:
           - Each: entity type icon (from EntityTypeRegistry — business for Company, people for Contact, handshake for Deal, etc.), entity name (clickable), entity type label in muted text, relative timestamp
           - Click: emit recordClicked with type and id
         - Empty state: "No recently viewed records" with history icon
         - Loading state: shimmer rows with icon placeholders

    3. **Update MyDayComponent** to wire all 5 new widgets:
       - Add imports for all 5 new widget components
       - Update template (`my-day.component.html`) to complete the grid:
         ```html
         <!-- Row 2: three half-width cards -->
         <app-upcoming-events-widget ... />  <!-- already from 24-03 -->
         <app-pipeline-widget
           [stages]="store.data()?.pipelineStages ?? []"
           [totalValue]="store.data()?.pipelineTotalValue ?? 0"
           [dealCount]="store.data()?.pipelineDealCount ?? 0"
           [isLoading]="store.isLoading()" />
         <app-email-summary-widget
           [unreadCount]="store.data()?.unreadEmailCount ?? 0"
           [recentEmails]="store.data()?.recentEmails ?? []"
           [isLoading]="store.isLoading()"
           (emailClicked)="onEmailClicked($event)" />

         <!-- Row 3: three half-width cards -->
         <app-feed-preview-widget
           [feedItems]="store.data()?.recentFeedItems ?? []"
           [isLoading]="store.isLoading()"
           (entityClicked)="onEntityClicked($event)" />
         <app-notification-digest-widget
           [notificationGroups]="store.data()?.notificationGroups ?? []"
           [totalCount]="store.data()?.todayNotificationCount ?? 0"
           [isLoading]="store.isLoading()"
           (notificationClicked)="onEntityClicked($event)" />
         <app-recent-records-widget
           [records]="store.data()?.recentRecords ?? []"
           [isLoading]="store.isLoading()"
           (recordClicked)="onEntityClicked($event)" />
         ```
       - Add handler methods:
         - `onEmailClicked(emailId: string)`: navigate to `/emails/${emailId}` (or open in appropriate view)
         - Reuse existing `onEntityClicked` for feed, notifications, and recent records — opens preview sidebar
       - Verify all widget cards sit properly in the 3-column CSS Grid (half-width cards naturally occupy 1 column each in a 3-column grid)
  </action>
  <verify>
    - `cd globcrm-web && npx ng build --configuration=development 2>&1 | tail -5` compiles
    - My Day component imports all 8 widget components (greeting, tasks, events, pipeline, email, feed, notifications, recent records)
    - All widgets are wired with store data bindings
    - Template has 2 full-width widgets + 6 half-width widgets in 3-column grid
  </verify>
  <done>
    - Notification digest shows grouped notifications with type icons and counts
    - Recent records shows last 8 viewed entities with type-appropriate icons from EntityTypeRegistry
    - My Day page now has complete layout: greeting banner (full), tasks (full), events + pipeline + email (row 2), feed + notifications + recent records (row 3)
    - All entity name clicks in widgets open preview sidebar
    - All widgets have empty states and loading skeletons
  </done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration=development` passes
2. My Day page shows all 8 widgets in correct grid positions
3. Pipeline uses horizontal stacked bar with CSS (no charting library)
4. All half-width widgets render in 3-column grid at desktop width
5. Empty states visible for widgets with no data
6. Entity clicks route to preview sidebar
</verification>

<success_criteria>
- All 5 secondary widgets render with data from MyDayStore
- Pipeline widget shows colored stacked bar chart with stage legend
- Email widget shows unread count and recent email list
- Feed preview shows compact items with entity links
- Notification digest groups notifications by type
- Recent records shows entity icons from EntityTypeRegistry
- Full My Day layout: 2 full-width + 6 half-width widgets in responsive CSS Grid
- All widgets have empty states with contextual messages
</success_criteria>

<output>
After completion, create `.planning/phases/24-my-day-personal-dashboard/24-04-SUMMARY.md`
</output>
