---
phase: 24-my-day-personal-dashboard
plan: 03
type: execute
wave: 2
depends_on: [24-01, 24-02]
files_modified:
  - globcrm-web/src/app/features/my-day/my-day.models.ts
  - globcrm-web/src/app/features/my-day/my-day.service.ts
  - globcrm-web/src/app/features/my-day/my-day.store.ts
  - globcrm-web/src/app/features/my-day/my-day.component.ts
  - globcrm-web/src/app/features/my-day/my-day.component.html
  - globcrm-web/src/app/features/my-day/my-day.component.scss
  - globcrm-web/src/app/features/my-day/widgets/greeting-banner/greeting-banner.component.ts
  - globcrm-web/src/app/features/my-day/widgets/tasks-widget/tasks-widget.component.ts
  - globcrm-web/src/app/features/my-day/widgets/upcoming-events-widget/upcoming-events-widget.component.ts
autonomous: true
requirements:
  - MYDAY-02
  - MYDAY-03
  - MYDAY-04
  - MYDAY-05

must_haves:
  truths:
    - "My Day page displays a time-based greeting ('Good morning/afternoon/evening, FirstName') with date and summary stats"
    - "Tasks widget shows today's tasks with checkboxes for inline completion and overdue items in a separate section with red urgency indicators"
    - "Upcoming events widget shows meetings/calls grouped by day headers (Today, Tomorrow, date)"
    - "Greeting banner has a subtle orange gradient background with tasks today count, overdue count, and upcoming meetings count"
    - "Task completion is optimistic — checkbox immediately removes the task, reverts on error"
  artifacts:
    - path: "globcrm-web/src/app/features/my-day/my-day.models.ts"
      provides: "TypeScript interfaces matching MyDayDto backend response"
      contains: "MyDayDto"
    - path: "globcrm-web/src/app/features/my-day/my-day.store.ts"
      provides: "Signal store with loadMyDay, completeTask, and computed signals"
      contains: "MyDayStore"
    - path: "globcrm-web/src/app/features/my-day/my-day.service.ts"
      provides: "API service calling GET /api/my-day"
      contains: "MyDayService"
    - path: "globcrm-web/src/app/features/my-day/widgets/greeting-banner/greeting-banner.component.ts"
      provides: "Full-width greeting hero with quick action buttons"
      contains: "GreetingBannerComponent"
    - path: "globcrm-web/src/app/features/my-day/widgets/tasks-widget/tasks-widget.component.ts"
      provides: "Full-width tasks list with overdue section and checkboxes"
      contains: "TasksWidgetComponent"
    - path: "globcrm-web/src/app/features/my-day/widgets/upcoming-events-widget/upcoming-events-widget.component.ts"
      provides: "Half-width upcoming events agenda with day headers"
      contains: "UpcomingEventsWidgetComponent"
  key_links:
    - from: "globcrm-web/src/app/features/my-day/my-day.store.ts"
      to: "globcrm-web/src/app/features/my-day/my-day.service.ts"
      via: "inject and subscribe"
      pattern: "inject\\(MyDayService\\)"
    - from: "globcrm-web/src/app/features/my-day/my-day.component.ts"
      to: "globcrm-web/src/app/features/my-day/my-day.store.ts"
      via: "component-provided store"
      pattern: "providers.*MyDayStore"
    - from: "globcrm-web/src/app/features/my-day/my-day.service.ts"
      to: "/api/my-day"
      via: "HTTP GET"
      pattern: "api/my-day"
---

<objective>
Build the My Day page shell with CSS Grid layout, signal store, API service, and three core widgets: greeting banner with summary stats, full-width tasks widget with overdue urgency and inline completion, and upcoming events agenda.

Purpose: Delivers the primary user experience of My Day — the greeting, task overview, and upcoming schedule. These are the hero widgets that provide the most daily value.
Output: Working My Day page with greeting, tasks (completable), and events widgets, backed by the MyDayStore and MyDayService.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-my-day-personal-dashboard/24-RESEARCH.md
@.planning/phases/24-my-day-personal-dashboard/24-01-SUMMARY.md
@.planning/phases/24-my-day-personal-dashboard/24-02-SUMMARY.md
@globcrm-web/src/app/features/dashboard/pages/dashboard/dashboard.component.ts (greeting pattern)
@globcrm-web/src/app/features/dashboard/pages/dashboard/dashboard.component.scss (hero section SCSS pattern)
@globcrm-web/src/app/features/dashboard/stores/dashboard.store.ts (signal store pattern)
@globcrm-web/src/app/shared/stores/preview-sidebar.store.ts (preview sidebar integration reference)
@globcrm-web/src/app/shared/components/entity-preview/preview-entity-link.component.ts (entity click -> preview pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create My Day models, service, and signal store</name>
  <files>
    globcrm-web/src/app/features/my-day/my-day.models.ts
    globcrm-web/src/app/features/my-day/my-day.service.ts
    globcrm-web/src/app/features/my-day/my-day.store.ts
  </files>
  <action>
    1. Create `my-day.models.ts` with TypeScript interfaces matching backend DTOs:
       - `MyDayDto` — top-level response (tasksTodayCount, overdueCount, upcomingMeetingsCount, tasks, upcomingEvents, pipelineStages, pipelineTotalValue, pipelineDealCount, unreadEmailCount, recentEmails, recentFeedItems, notificationGroups, todayNotificationCount, recentRecords)
       - `MyDayTaskDto` — id, subject, type, status, priority, dueDate (string), isOverdue, daysOverdue, linkedEntityType?, linkedEntityId?, linkedEntityName?
       - `MyDayEventDto` — id, subject, type, dueDate (string), assignedToName?
       - `MyDayPipelineStageDto` — stageName, color, dealCount, totalValue
       - `MyDayEmailDto` — id, subject, fromName, sentAt (string), isInbound, isRead
       - `MyDayFeedItemDto` — id, type, content, entityType?, entityId?, entityName?, authorName, createdAt (string)
       - `MyDayNotificationGroupDto` — type, count, items (MyDayNotificationDto[])
       - `MyDayNotificationDto` — id, title, message, entityType?, entityId?, isRead, createdAt (string)
       - `MyDayRecentRecordDto` — entityType, entityId, entityName, viewedAt (string)

    2. Create `my-day.service.ts`:
       - Injectable service (NOT providedIn: 'root' — will be provided in component)
       - Inject `ApiService` (the existing HTTP wrapper)
       - `getMyDay(): Observable<MyDayDto>` — GET `my-day`
       - `completeTask(taskId: string): Observable<void>` — PATCH `my-day/tasks/${taskId}/complete`
       - `trackView(entityType: string, entityId: string, entityName: string): Observable<void>` — POST `my-day/track-view`

    3. Create `my-day.store.ts`:
       - Component-provided signal store (NOT providedIn: 'root')
       - State interface: `{ data: MyDayDto | null; isLoading: boolean; error: string | null; completingTaskIds: string[]; highlightedItemId: string | null; }`
       - Computed signals:
         - `overdueTasks`: data.tasks filtered where isOverdue === true
         - `todayTasks`: data.tasks filtered where isOverdue === false
         - `greetingStats`: { tasksToday: data.tasksTodayCount, overdue: data.overdueCount, meetings: data.upcomingMeetingsCount }
       - Methods:
         - `loadMyDay()`: Set isLoading=true, call service.getMyDay(), on success patchState with data, on error set error message, always set isLoading=false
         - `completeTask(taskId: string)`: **Optimistic update** — immediately remove task from data.tasks array, add taskId to completingTaskIds. Call service.completeTask(taskId). On error: revert by re-adding the task to data.tasks, show snackbar error. On success: remove from completingTaskIds, decrement tasksTodayCount or overdueCount as appropriate.
         - `refreshData()`: Calls loadMyDay() again (used after quick actions)
         - `setHighlight(id: string)`: Set highlightedItemId, then setTimeout 2000ms to clear it (for pulse animation)
       - Inject: MyDayService, MatSnackBar
  </action>
  <verify>
    - `cd globcrm-web && npx ng build --configuration=development 2>&1 | tail -5` compiles (even though store is unused yet)
    - my-day.models.ts exports MyDayDto and all sub-DTOs
    - my-day.store.ts exports MyDayStore with loadMyDay, completeTask, refreshData methods
  </verify>
  <done>
    - TypeScript interfaces match backend MyDayDto response shape
    - MyDayService wraps GET /api/my-day, PATCH complete, and POST track-view
    - MyDayStore provides reactive state with optimistic task completion and computed signals for overdue/today task separation
  </done>
</task>

<task type="auto">
  <name>Task 2: Build greeting banner, tasks widget, upcoming events widget, and My Day page layout</name>
  <files>
    globcrm-web/src/app/features/my-day/widgets/greeting-banner/greeting-banner.component.ts
    globcrm-web/src/app/features/my-day/widgets/tasks-widget/tasks-widget.component.ts
    globcrm-web/src/app/features/my-day/widgets/upcoming-events-widget/upcoming-events-widget.component.ts
    globcrm-web/src/app/features/my-day/my-day.component.ts
    globcrm-web/src/app/features/my-day/my-day.component.html
    globcrm-web/src/app/features/my-day/my-day.component.scss
  </files>
  <action>
    1. **GreetingBannerComponent** (`widgets/greeting-banner/greeting-banner.component.ts`):
       - Standalone component, ChangeDetectionStrategy.OnPush
       - Inputs (using `input()` signal API): `firstName: string`, `stats: { tasksToday: number; overdue: number; meetings: number }`, `isLoading: boolean`
       - Output: `quickAction = output<string>()` — emits 'Contact' | 'Deal' | 'Activity' | 'Note' | 'Email' when quick action clicked
       - Computed signals for greeting:
         - `greeting()`: time-based — hour < 12: "Good morning", < 17: "Good afternoon", else "Good evening" (copy pattern from existing DashboardComponent)
         - `timeIcon()`: hour-based Material icon (wb_sunny, wb_cloudy, wb_twilight, dark_mode)
         - `dateStr()`: formatted as "Thu, Feb 20" using `Intl.DateTimeFormat('en-US', { weekday: 'short', month: 'short', day: 'numeric' })`
       - Template:
         - Full-width card with subtle orange gradient background: `background: linear-gradient(135deg, var(--color-primary-50) 0%, var(--color-primary-100) 100%)` (use CSS custom properties from tokens.css)
         - Top row: icon + "Good morning, {firstName}" as h2 + date string
         - Stats row: three stat chips — "{N} tasks today", "{N} overdue" (red text if > 0), "{N} meetings"
         - Quick actions row (inside banner per locked decision): 5 buttons with icons:
           - person_add "New Contact", handshake "New Deal", task_alt "Log Activity", note_add "New Note", email "Send Email"
           - Use `mat-stroked-button` with icons, compact sizing
           - Each emits `quickAction.emit('Contact')` etc.
       - Loading state: show shimmer placeholders for stats when isLoading, but always show greeting (firstName from AuthStore, no API needed)
       - Inline styles or co-located SCSS for the gradient, stat chips, and quick action buttons

    2. **TasksWidgetComponent** (`widgets/tasks-widget/tasks-widget.component.ts`):
       - Standalone component, ChangeDetectionStrategy.OnPush
       - Inputs: `overdueTasks: MyDayTaskDto[]`, `todayTasks: MyDayTaskDto[]`, `isLoading: boolean`, `completingTaskIds: string[]`, `highlightedItemId: string | null`
       - Output: `taskCompleted = output<string>()` — emits task ID when checkbox clicked
       - Output: `entityClicked = output<{ type: string; id: string }>()` — emits when linked entity name clicked
       - Template:
         - mat-card with title "Today's Tasks"
         - **Overdue section** (shown when overdueTasks.length > 0): Separate section with red accent left border (4px solid var(--color-error, #d32f2f)). Section header "Overdue" in red.
           - Each overdue task: mat-checkbox + subject text + red "Overdue" badge with "{N}d overdue" text + linked entity name (if exists, clickable to open preview)
           - Red left-border or subtle red background tint on each overdue item row
         - **Today section**: Section header "Due Today" (or no header if no overdue section exists)
           - Each task: mat-checkbox + subject text + priority indicator (if high/urgent) + linked entity name
         - Checkbox click: emit `taskCompleted.emit(task.id)`. Add subtle strikethrough + fade-out animation on the task row.
         - Entity name click: emit `entityClicked.emit({ type: task.linkedEntityType, id: task.linkedEntityId })`
         - Empty state: friendly message "No tasks for today — nice work!" with a check_circle icon
         - Loading state: 4-5 shimmer rows (rectangles with skeleton animation)
         - Highlight animation: when `highlightedItemId` matches a task ID, apply a brief pulse/glow animation via CSS class

    3. **UpcomingEventsWidgetComponent** (`widgets/upcoming-events-widget/upcoming-events-widget.component.ts`):
       - Standalone component, ChangeDetectionStrategy.OnPush
       - Input: `events: MyDayEventDto[]`, `isLoading: boolean`
       - Output: `eventClicked = output<string>()` — emits event ID
       - Computed signal to group events by day:
         - Parse dueDate strings, group into "Today", "Tomorrow", and formatted date (e.g. "Sat, Feb 22")
         - Each group: day header label + list of events
       - Template:
         - mat-card with title "Upcoming Events" and calendar_month icon
         - Day headers as section dividers (bold text, subtle bottom border)
         - Each event: time (formatted HH:mm), subject, type icon (videocam for Meeting, phone for Call), assignedToName
         - Empty state: "No upcoming events" with event_busy icon
         - Loading state: 3 shimmer rows

    4. **Update MyDayComponent** (replace placeholder from 24-01):
       - Standalone component with `providers: [MyDayStore, MyDayService]`
       - Inject: `MyDayStore`, `AuthStore`, `PreviewSidebarStore` (for entity preview clicks)
       - `afterNextRender(() => this.store.loadMyDay())` to trigger data load
       - Template (`my-day.component.html`):
         ```html
         <div class="my-day">
           <div class="my-day__grid">
             <!-- Full-width greeting banner -->
             <app-greeting-banner class="my-day__widget--full"
               [firstName]="firstName()"
               [stats]="store.greetingStats()"
               [isLoading]="store.isLoading()"
               (quickAction)="onQuickAction($event)" />

             <!-- Full-width tasks widget -->
             <app-tasks-widget class="my-day__widget--full"
               [overdueTasks]="store.overdueTasks()"
               [todayTasks]="store.todayTasks()"
               [isLoading]="store.isLoading()"
               [completingTaskIds]="store.completingTaskIds()"
               [highlightedItemId]="store.highlightedItemId()"
               (taskCompleted)="onTaskCompleted($event)"
               (entityClicked)="onEntityClicked($event)" />

             <!-- Row 2: three half-width cards -->
             <app-upcoming-events-widget
               [events]="store.data()?.upcomingEvents ?? []"
               [isLoading]="store.isLoading()"
               (eventClicked)="onEventClicked($event)" />

             <!-- Placeholders for pipeline and email (built in 24-04) -->
             <!-- Row 3: placeholders for feed, notifications, recent records (built in 24-04) -->
           </div>
         </div>
         ```
       - SCSS (`my-day.component.scss`):
         - `.my-day`: max-width 1120px, margin 0 auto, padding
         - `.my-day__grid`: CSS Grid, `grid-template-columns: repeat(3, 1fr)`, gap using design tokens
         - `.my-day__widget--full`: `grid-column: 1 / -1`
         - Responsive breakpoints: 1024px → 2 columns, 768px → 1 column
         - Shimmer animation keyframes (reuse existing pattern or define `@keyframes shimmer`)
       - Component methods:
         - `firstName()`: computed signal from AuthStore userName, extract first name
         - `onTaskCompleted(taskId: string)`: call `this.store.completeTask(taskId)`
         - `onEntityClicked(event: { type: string; id: string })`: call `this.previewSidebarStore.open(event.type, event.id)` (same pattern as feed entity links)
         - `onEventClicked(eventId: string)`: navigate to activity detail `/activities/${eventId}`
         - `onQuickAction(type: string)`: placeholder for now (console.log), will be wired in 24-05
  </action>
  <verify>
    - `cd globcrm-web && npx ng build --configuration=development 2>&1 | tail -5` compiles
    - MyDayComponent imports and uses all three widget components
    - Greeting banner has 5 quick action buttons
    - Tasks widget has separate overdue and today sections
    - Upcoming events widget groups by day
  </verify>
  <done>
    - My Day page shows greeting banner with "Good morning, FirstName", date, stats, and quick action buttons
    - Tasks widget displays overdue tasks with red urgency indicators (red border, "Xd overdue" badge) in a separate section above today's tasks
    - Tasks are completable inline with checkbox — optimistic removal with revert on error
    - Upcoming events widget shows meetings/calls grouped by day headers (Today, Tomorrow, date)
    - CSS Grid layout with full-width greeting + tasks, half-width events
    - Entity name clicks in tasks open preview sidebar
    - Loading states show shimmer skeletons
    - Empty states show friendly messages
  </done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration=development` passes
2. My Day page renders at /my-day with greeting, tasks, and events widgets
3. Greeting shows time-based message, date, and 3 summary stats
4. Tasks widget has distinct overdue section with red styling and today section
5. Checkboxes trigger optimistic task completion
6. Events are grouped by day headers
7. CSS Grid layout is responsive (3-col, 2-col, 1-col)
</verification>

<success_criteria>
- My Day page loads and displays greeting banner with user's first name, time-based greeting, date, and summary stats (tasks, overdue, meetings)
- Quick action buttons are visible in the greeting banner
- Overdue tasks appear in a red-accented section above today's tasks
- Tasks can be completed inline with checkboxes (optimistic UI)
- Upcoming events are grouped by day with appropriate time formatting
- Page layout uses CSS Grid with responsive breakpoints
- Loading state shows shimmer skeletons, empty states show friendly messages
</success_criteria>

<output>
After completion, create `.planning/phases/24-my-day-personal-dashboard/24-03-SUMMARY.md`
</output>
