---
phase: 10-data-operations
plan: 06
type: execute
wave: 4
depends_on: ["10-04", "10-05"]
files_modified:
  - globcrm-web/src/app/features/import/import-history/import-history.component.ts
  - globcrm-web/src/app/features/import/import.routes.ts
  - globcrm-web/src/app/features/settings/settings.routes.ts
  - globcrm-web/src/app/features/settings/pages/settings/settings.component.ts
  - globcrm-web/src/app/app.routes.ts
autonomous: true

must_haves:
  truths:
    - "User can access import wizard from settings page"
    - "User can view import history showing past import jobs with status and counts"
    - "Import routes are lazy-loaded and accessible to authenticated users"
    - "Settings page has Import Data section/button linking to import wizard"
  artifacts:
    - path: "globcrm-web/src/app/features/import/import-history/import-history.component.ts"
      provides: "Table of past import jobs with status badges, row counts, and re-upload action"
      contains: "ImportHistoryComponent"
    - path: "globcrm-web/src/app/features/import/import.routes.ts"
      provides: "Import feature routes: /import (wizard) and /import/history"
      contains: "importRoutes"
  key_links:
    - from: "globcrm-web/src/app/features/import/import.routes.ts"
      to: "globcrm-web/src/app/app.routes.ts"
      via: "Lazy-loaded route registration"
      pattern: "loadChildren.*import"
    - from: "globcrm-web/src/app/features/settings/pages/settings/settings.component.ts"
      to: "/import"
      via: "routerLink navigation to import wizard"
      pattern: "routerLink.*import"
---

<objective>
Create import history page, set up routing for the import feature (wizard + history), and integrate import access into the settings page.

Purpose: Completes the import UX by providing navigation entry points and a history view for past imports, tying together all import and search components into the app navigation.
Output: Import history component, routes, and settings page integration.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-data-operations/10-04-SUMMARY.md
@.planning/phases/10-data-operations/10-05-SUMMARY.md
@globcrm-web/src/app/features/settings/settings.routes.ts
@globcrm-web/src/app/features/settings/pages/settings/settings.component.ts
@globcrm-web/src/app/app.routes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create import history component and import routes</name>
  <files>
    globcrm-web/src/app/features/import/import-history/import-history.component.ts
    globcrm-web/src/app/features/import/import.routes.ts
  </files>
  <action>
    **Create ImportHistoryComponent** (import-history/import-history.component.ts):
    Standalone component with inline template and styles.

    **State:**
    - jobs = signal<ImportJob[]>([])
    - loading = signal(true)
    - page = signal(1)
    - pageSize = 20

    **On init:** Call ImportService.getJobs(page, pageSize) to load import history.

    **Template:** Material table layout showing:
    - File Name (originalFileName)
    - Entity Type (with icon: business/person/handshake matching search component)
    - Status (with colored badge: green=Completed, blue=Processing, gray=Pending, red=Failed)
    - Rows (totalRows)
    - Success (successCount in green)
    - Errors (errorCount in red, only if > 0)
    - Date (createdAt formatted with DatePipe)
    - Actions: "View Details" button that expands to show errors list if any

    **Header section:**
    - Page title: "Import History"
    - "New Import" button linking to /import

    If no jobs: show empty state "No imports yet. Import your first CSV file."

    **Create import.routes.ts:**
    ```typescript
    import { Routes } from '@angular/router';
    import { authGuard } from '../../core/guards/auth.guard';

    export const importRoutes: Routes = [
      {
        path: '',
        canActivate: [authGuard],
        children: [
          {
            path: '',
            loadComponent: () => import('./import-wizard/import-wizard.component')
              .then(m => m.ImportWizardComponent),
            title: 'Import Data'
          },
          {
            path: 'history',
            loadComponent: () => import('./import-history/import-history.component')
              .then(m => m.ImportHistoryComponent),
            title: 'Import History'
          }
        ]
      }
    ];
    ```
  </action>
  <verify>
    `ng build --configuration development` compiles. Import routes defined with lazy-loaded components.
  </verify>
  <done>
    Import history component displays past import jobs in a table with status badges. Import routes set up for wizard and history with lazy loading.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate import routes into app routing and add import section to settings page</name>
  <files>
    globcrm-web/src/app/app.routes.ts
    globcrm-web/src/app/features/settings/pages/settings/settings.component.ts
  </files>
  <action>
    **Update app.routes.ts:**
    Add lazy-loaded import route:
    ```typescript
    {
      path: 'import',
      loadChildren: () => import('./features/import/import.routes').then(m => m.importRoutes)
    }
    ```
    Place after existing feature routes (dashboard, companies, contacts, etc.) and before the settings route.

    **Update settings.component.ts:**
    Add an "Import & Export" section to the settings page (matching existing section pattern with cards/buttons):
    - Section title: "Data Operations"
    - Card/button: "Import Data" with icon upload_file, description "Import contacts, companies, or deals from CSV files", routerLink "/import"
    - Card/button: "Import History" with icon history, description "View past import jobs and their results", routerLink "/import/history"

    Use *appHasPermission directive to gate import access: user needs at least one Create permission (Contact:Create OR Company:Create OR Deal:Create) to see the import section. If the settings page already uses a simple approach (showing sections based on role), follow that pattern. The import section should be visible to any user with create permissions, not just admins.
  </action>
  <verify>
    `ng build --configuration development` compiles. Navigate to /settings, see "Data Operations" section with Import Data and Import History buttons. Click "Import Data" navigates to /import wizard. Click "Import History" navigates to /import/history.
  </verify>
  <done>
    Import is accessible from settings page via "Data Operations" section. Routes are lazy-loaded. Import wizard at /import, history at /import/history. Navigation between wizard and history works. Global search is already integrated in navbar from plan 10-05.
  </done>
</task>

</tasks>

<verification>
- `ng build --configuration development` passes
- /import route loads import wizard
- /import/history route loads import history
- Settings page shows "Data Operations" section with import links
- Import history table shows past import jobs with correct status badges
- Navigation between wizard and history works
- Global search (from 10-05) remains functional in navbar
</verification>

<success_criteria>
Phase 10 frontend integration is complete: import wizard accessible from settings page, import history viewable, routes lazy-loaded, and global search in navbar. All IMPT and SRCH requirements are fully addressed across the phase.
</success_criteria>

<output>
After completion, create `.planning/phases/10-data-operations/10-06-SUMMARY.md`
</output>
