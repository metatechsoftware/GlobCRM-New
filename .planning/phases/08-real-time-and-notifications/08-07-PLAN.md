---
phase: 08-real-time-and-notifications
plan: 07
type: execute
wave: 5
depends_on: ["08-05", "08-06"]
files_modified:
  - globcrm-web/src/app/settings/notification-preferences/notification-preferences.component.ts
  - globcrm-web/src/app/settings/settings.routes.ts
  - globcrm-web/src/app/app.routes.ts
  - globcrm-web/src/app/shared/components/navbar/navbar.component.html
autonomous: true

must_haves:
  truths:
    - "User can configure notification preferences per type (in-app and email toggles)"
    - "Feed is accessible via navbar navigation link"
    - "Notification preferences page is accessible from settings"
    - "All Phase 8 features are routed and accessible"
  artifacts:
    - path: "globcrm-web/src/app/settings/notification-preferences/notification-preferences.component.ts"
      provides: "Notification preferences settings page"
      contains: "NotificationPreferencesComponent"
  key_links:
    - from: "globcrm-web/src/app/app.routes.ts"
      to: "globcrm-web/src/app/features/feed/feed.routes.ts"
      via: "lazy-loaded route"
      pattern: "loadChildren.*feed"
    - from: "globcrm-web/src/app/shared/components/navbar/navbar.component.html"
      to: "/feed"
      via: "routerLink"
      pattern: "routerLink.*feed"
---

<objective>
Create notification preferences settings page, wire up Feed route in app routing and navbar navigation, and verify all Phase 8 features are accessible.

Purpose: Complete the user-facing integration of notifications and feed into the application navigation and settings.
Output: Notification preferences component, updated routing, updated navbar with Feed link.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-real-time-and-notifications/08-05-SUMMARY.md
@.planning/phases/08-real-time-and-notifications/08-06-SUMMARY.md
@globcrm-web/src/app/app.routes.ts (add feed route)
@globcrm-web/src/app/settings/settings.routes.ts (add preferences route)
@globcrm-web/src/app/shared/components/navbar/navbar.component.html (add Feed link)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Notification preferences page and settings route</name>
  <files>
    globcrm-web/src/app/settings/notification-preferences/notification-preferences.component.ts
    globcrm-web/src/app/settings/settings.routes.ts
  </files>
  <action>
    **NotificationPreferencesComponent** (inline template/styles):
    - Inject NotificationService
    - On init: call getPreferences(). If empty, generate default preferences for all 5 notification types with InApp=true, Email=true.
    - Template: Page title "Notification Preferences" with description text "Choose how you receive notifications for different events."
    - Display a table/list with one row per NotificationType:
      - Column 1: Type name (human-readable: "Activity Assigned", "Deal Stage Changed", "Mentions", "Due Date Approaching", "Email Received")
      - Column 2: In-App toggle (mat-slide-toggle, bound to inAppEnabled)
      - Column 3: Email toggle (mat-slide-toggle, bound to emailEnabled)
    - "Save" mat-raised-button at bottom. On click: call updatePreferences with all preferences. Show snackbar on success.
    - Style: max-width 600px, clean table layout with alternating row backgrounds.

    **Update settings.routes.ts**: Add route for notification-preferences:
    ```
    { path: 'notification-preferences', loadComponent: () => import('./notification-preferences/notification-preferences.component').then(m => m.NotificationPreferencesComponent) }
    ```
    No adminGuard on this route -- notification preferences are per-user, not admin-only.
  </action>
  <verify>`cd globcrm-web && npx ng build --configuration development 2>&1 | head -20` compiles.</verify>
  <done>Notification preferences page shows all 5 types with in-app/email toggles, saves via API, accessible at /settings/notification-preferences</done>
</task>

<task type="auto">
  <name>Task 2: Feed route, navbar link, and final integration</name>
  <files>
    globcrm-web/src/app/app.routes.ts
    globcrm-web/src/app/shared/components/navbar/navbar.component.html
  </files>
  <action>
    **Update app.routes.ts**: Add lazy-loaded feed route:
    ```
    { path: 'feed', loadChildren: () => import('./features/feed/feed.routes').then(m => m.FEED_ROUTES), canActivate: [authGuard] }
    ```
    Place after 'emails' route and before 'team' route in the route order.

    **Update navbar.component.html**: Add "Feed" navigation link in the main nav links section.
    - Position: after Emails link, before Team link
    - Use routerLink="/feed" with routerLinkActive="active"
    - Icon: mat-icon "dynamic_feed"
    - Label: "Feed"
    - Final navbar order: Dashboard | Companies | Contacts | Products | Deals | Activities | Quotes | Requests | Emails | Feed | Team | Settings

    Also verify that the notification bell icon (added in Plan 05) is properly positioned in the navbar -- it should be in the right section near the user avatar menu, NOT in the main nav links.

    Verify the notification preferences link is accessible from the settings page. If there is a settings landing page or sidebar with links, add a "Notification Preferences" entry there. Check existing settings routing pattern to determine if settings has a sidebar/list page with links to sub-pages. If so, add the notification preferences entry.
  </action>
  <verify>`cd globcrm-web && npx ng build --configuration development 2>&1 | head -20` compiles. All routes resolve: /feed, /settings/notification-preferences.</verify>
  <done>Feed accessible via /feed route and navbar link. Notification preferences accessible via /settings/notification-preferences. All Phase 8 features routed and navigable.</done>
</task>

</tasks>

<verification>
- Angular builds without errors
- /feed route loads FeedListComponent
- /settings/notification-preferences route loads NotificationPreferencesComponent
- Navbar shows Feed link in correct position
- Bell icon with badge visible in navbar right section
- All Phase 8 requirements addressable via UI
</verification>

<success_criteria>
- Notification preferences: user can toggle in-app/email per notification type (NOTF-05)
- Feed: accessible from navbar via "Feed" link
- Routing: all new routes protected by authGuard
- Navbar: Feed link positioned after Emails, before Team
- Settings: notification preferences accessible from settings area
- All NOTF and FEED requirements have corresponding UI entry points
</success_criteria>

<output>
After completion, create `.planning/phases/08-real-time-and-notifications/08-07-SUMMARY.md`
</output>
