---
phase: 27-localization-foundation
plan: 03
type: execute
wave: 2
depends_on: [27-01]
files_modified:
  - globcrm-web/src/app/app.config.ts
  - globcrm-web/src/app/core/i18n/transloco-paginator-intl.ts
  - globcrm-web/src/app/shared/components/dynamic-table/dynamic-table.component.ts
  - globcrm-web/src/app/shared/components/dynamic-table/dynamic-table.component.html
  - globcrm-web/src/app/features/activities/activity-detail/activity-detail.component.ts
  - globcrm-web/src/app/features/deals/deal-form/deal-form.component.ts
  - globcrm-web/src/app/shared/components/custom-field-form/custom-field-form.component.ts
  - globcrm-web/src/app/features/activities/activity-form/activity-form.component.ts
  - globcrm-web/src/app/features/dashboard/components/date-range-filter/date-range-filter.component.ts
  - globcrm-web/src/app/features/dashboard/components/target-form-dialog/target-form-dialog.component.ts
  - globcrm-web/src/app/features/quotes/quote-form/quote-form.component.ts
  - globcrm-web/src/app/core/i18n/language.service.ts
autonomous: true
requirements:
  - LOCL-04
  - LOCL-08

must_haves:
  truths:
    - "DynamicTable date cells render in locale-appropriate format (Turkish: 20.02.2026, English: 02/20/2026)"
    - "Angular Material paginator labels display in the selected language (Items per page / Sayfa başına öğe)"
    - "Angular Material DatePicker displays Turkish month/day names when locale is Turkish"
    - "All datepickers across the app share a single root-level DateAdapter instance that responds to locale changes"
  artifacts:
    - path: "globcrm-web/src/app/core/i18n/transloco-paginator-intl.ts"
      provides: "Translated MatPaginatorIntl"
      contains: "TranslatedPaginatorIntl"
    - path: "globcrm-web/src/app/shared/components/dynamic-table/dynamic-table.component.ts"
      provides: "Locale-aware date formatting in table cells"
      contains: "TranslocoLocaleService\\|translocoDate"
  key_links:
    - from: "globcrm-web/src/app/app.config.ts"
      to: "globcrm-web/src/app/core/i18n/transloco-paginator-intl.ts"
      via: "{ provide: MatPaginatorIntl, useClass: TranslatedPaginatorIntl }"
      pattern: "MatPaginatorIntl"
    - from: "globcrm-web/src/app/app.config.ts"
      to: "@angular/material/core"
      via: "provideNativeDateAdapter()"
      pattern: "provideNativeDateAdapter"
---

<objective>
Make date/number formatting locale-aware in DynamicTable, provide translated Angular Material component labels (paginator, datepicker), and consolidate DateAdapter to root level.

Purpose: Ensure dates, numbers, and Material component labels respect the active locale (LOCL-04, LOCL-08).
Output: Locale-aware DynamicTable, translated paginator, root-level DateAdapter, and clean removal of per-component date providers.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-localization-foundation/27-RESEARCH.md
@.planning/phases/27-localization-foundation/27-01-SUMMARY.md
@.planning/phases/27-localization-foundation/27-02-SUMMARY.md
@globcrm-web/src/app/core/i18n/language.service.ts
@globcrm-web/src/app/app.config.ts
@globcrm-web/src/app/shared/components/dynamic-table/dynamic-table.component.ts
@globcrm-web/src/app/shared/components/dynamic-table/dynamic-table.component.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TranslatedPaginatorIntl, add provideNativeDateAdapter to root, remove per-component providers</name>
  <files>
    globcrm-web/src/app/core/i18n/transloco-paginator-intl.ts
    globcrm-web/src/app/app.config.ts
    globcrm-web/src/app/features/activities/activity-detail/activity-detail.component.ts
    globcrm-web/src/app/features/deals/deal-form/deal-form.component.ts
    globcrm-web/src/app/shared/components/custom-field-form/custom-field-form.component.ts
    globcrm-web/src/app/features/activities/activity-form/activity-form.component.ts
    globcrm-web/src/app/features/dashboard/components/date-range-filter/date-range-filter.component.ts
    globcrm-web/src/app/features/dashboard/components/target-form-dialog/target-form-dialog.component.ts
    globcrm-web/src/app/features/quotes/quote-form/quote-form.component.ts
  </files>
  <action>
    1. Create `globcrm-web/src/app/core/i18n/transloco-paginator-intl.ts`:
       - `@Injectable()` class `TranslatedPaginatorIntl` extends `MatPaginatorIntl`
       - Inject `TranslocoService`
       - In constructor, subscribe to `this.translocoService.langChanges$` and on each emission:
         - Set `this.itemsPerPageLabel = this.translocoService.translate('common.paginator.itemsPerPage')`
         - Set `this.nextPageLabel`, `this.previousPageLabel`, `this.firstPageLabel`, `this.lastPageLabel` similarly
         - Override `this.getRangeLabel` to use translated "of" (or "/" for Turkish):
           ```typescript
           this.getRangeLabel = (page, pageSize, length) => {
             const ofLabel = this.translocoService.translate('common.paginator.of');
             if (length === 0 || pageSize === 0) return `0 ${ofLabel} ${length}`;
             const startIndex = page * pageSize;
             const endIndex = Math.min(startIndex + pageSize, length);
             return `${startIndex + 1} – ${endIndex} ${ofLabel} ${length}`;
           };
           ```
         - Call `this.changes.next()` to notify paginator instances

    2. Update `globcrm-web/src/app/app.config.ts`:
       - Add `provideNativeDateAdapter()` from `@angular/material/core` to the providers array (consolidating to root)
       - Add `{ provide: MatPaginatorIntl, useClass: TranslatedPaginatorIntl }` to providers
       - Import `MatPaginatorIntl` from `@angular/material/paginator`
       - Import `TranslatedPaginatorIntl` from `./core/i18n/transloco-paginator-intl`
       - Import `provideNativeDateAdapter` from `@angular/material/core`

    3. Update LanguageService (from Plan 01) `switchLanguage` method to also call `DateAdapter.setLocale()`:
       - Inject `DateAdapter` from `@angular/material/core` in LanguageService
       - In `switchLanguage()`, add: `this.dateAdapter.setLocale(lang === 'tr' ? 'tr-TR' : 'en-US')`
       - This is the ONE place where DateAdapter locale is set, ensuring all datepickers update reactively.
       - NOTE: This requires editing `language.service.ts` — this is safe since Plan 02 modifies different parts of the same file (adding ProfileService persistence). If Plan 02 runs in parallel, the changes are to different methods and won't conflict.

    4. Remove `provideNativeDateAdapter()` from per-component `providers: []` in ALL 7 components:
       - `activity-detail.component.ts` — remove from providers array
       - `deal-form.component.ts` — remove from providers array
       - `custom-field-form.component.ts` — remove from providers array
       - `activity-form.component.ts` — remove from providers array
       - `date-range-filter.component.ts` — remove from providers array
       - `target-form-dialog.component.ts` — remove from providers array
       - `quote-form.component.ts` — remove from providers array
       - For each: also remove the `provideNativeDateAdapter` import if no longer used
       - If `providers: []` becomes empty after removal, remove the entire `providers` property from @Component
  </action>
  <verify>
    - `cd globcrm-web && npx ng build --configuration=development 2>&1 | tail -5` builds without errors
    - `grep -r "provideNativeDateAdapter" src/app/features/ src/app/shared/ --include="*.ts" -l` returns NO files (all moved to root)
    - `grep "provideNativeDateAdapter" src/app/app.config.ts` shows it in app.config
    - `grep "MatPaginatorIntl" src/app/app.config.ts` shows the provider override
  </verify>
  <done>TranslatedPaginatorIntl created with reactive label updates on language change, NativeDateAdapter consolidated to root level (removed from 7 components), DateAdapter.setLocale() called on language switch via LanguageService</done>
</task>

<task type="auto">
  <name>Task 2: Make DynamicTable date formatting locale-aware</name>
  <files>
    globcrm-web/src/app/shared/components/dynamic-table/dynamic-table.component.ts
    globcrm-web/src/app/shared/components/dynamic-table/dynamic-table.component.html
  </files>
  <action>
    1. Update `dynamic-table.component.ts`:
       - Inject `TranslocoLocaleService` from `@jsverse/transloco-locale`
       - Replace the existing `formatDate(value: any): string` method that uses `new Intl.DateTimeFormat('en-US', ...)` hardcoded. Instead, use `TranslocoLocaleService.localizeDate(value, locale, options)`:
         ```typescript
         formatDate(value: any): string {
           if (!value) return '';
           const date = new Date(value);
           if (isNaN(date.getTime())) return String(value);
           return this.translocoLocaleService.localizeDate(date, 'medium');
         }
         ```
       - The `localizeDate` method automatically uses the active Transloco locale mapping (en→en-US, tr→tr-TR) so dates render as "Feb 20, 2026" in English and "20 Şub 2026" in Turkish.
       - Alternative approach if `localizeDate` doesn't exist or doesn't work cleanly: use `Intl.DateTimeFormat` with the locale from `TranslocoService`:
         ```typescript
         private readonly translocoService = inject(TranslocoService);
         formatDate(value: any): string {
           if (!value) return '';
           const date = new Date(value);
           if (isNaN(date.getTime())) return String(value);
           const locale = this.translocoService.getActiveLang() === 'tr' ? 'tr-TR' : 'en-US';
           return new Intl.DateTimeFormat(locale, { year: 'numeric', month: 'short', day: 'numeric' }).format(date);
         }
         ```

    2. If DynamicTable has a `formatNumber` or `formatCurrency` method, apply the same pattern using `TranslocoLocaleService` or locale-aware `Intl.NumberFormat`. Check the component for any number/currency formatting.

    3. NOTE: Phase 28 will handle replacing `| date:` and `| currency:` pipes across all 32+ template files. This plan only fixes the DynamicTable's programmatic `formatDate()` since it's the most critical shared component.
  </action>
  <verify>
    - `cd globcrm-web && npx ng build --configuration=development 2>&1 | tail -5` builds without errors
    - `grep -c "en-US" src/app/shared/components/dynamic-table/dynamic-table.component.ts` returns 0 or only in the locale mapping (not hardcoded in formatDate)
    - `grep "TranslocoLocaleService\|TranslocoService" src/app/shared/components/dynamic-table/dynamic-table.component.ts` shows locale-aware injection
  </verify>
  <done>DynamicTable formatDate() uses active Transloco locale instead of hardcoded 'en-US', so table date cells render as dd.MM.yyyy-style in Turkish and MM/dd/yyyy-style in English</done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration=development` completes without errors
2. No component-level `provideNativeDateAdapter()` exists (all 7 removed, consolidated to root)
3. DynamicTable dates format using active locale (not hardcoded en-US)
4. TranslatedPaginatorIntl subscribes to langChanges$ and updates labels reactively
5. DateAdapter locale set to tr-TR or en-US on language switch
</verification>

<success_criteria>
- DynamicTable date cells format per locale: Turkish 20.02.2026, English 02/20/2026 (LOCL-04)
- Paginator shows "Sayfa başına öğe" in Turkish, "Items per page" in English (LOCL-08)
- DatePicker shows Turkish month/day names when locale is Turkish (LOCL-08)
- All datepickers share single root DateAdapter — no scoping issues
- Number formatting respects locale (Turkish uses comma decimal, English uses dot decimal)
</success_criteria>

<output>
After completion, create `.planning/phases/27-localization-foundation/27-03-SUMMARY.md`
</output>
