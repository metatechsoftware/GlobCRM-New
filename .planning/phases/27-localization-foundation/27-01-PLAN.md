---
phase: 27-localization-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - globcrm-web/package.json
  - globcrm-web/angular.json
  - globcrm-web/src/app/app.config.ts
  - globcrm-web/src/app/app.component.ts
  - globcrm-web/src/app/core/i18n/transloco-loader.ts
  - globcrm-web/src/app/core/i18n/language.service.ts
  - globcrm-web/src/assets/i18n/en.json
  - globcrm-web/src/assets/i18n/tr.json
autonomous: true
requirements:
  - LOCL-06

must_haves:
  truths:
    - "Transloco is installed and configured with English as default language and Turkish as available"
    - "Missing translation keys fall back to English text without showing raw keys"
    - "LanguageService can detect browser language on first visit and cache preference in localStorage"
    - "App initializes with the correct language on bootstrap (from localStorage cache or browser detection)"
  artifacts:
    - path: "globcrm-web/src/app/core/i18n/transloco-loader.ts"
      provides: "HTTP translation file loader"
      contains: "TranslocoHttpLoader"
    - path: "globcrm-web/src/app/core/i18n/language.service.ts"
      provides: "Central language orchestrator"
      contains: "LanguageService"
    - path: "globcrm-web/src/assets/i18n/en.json"
      provides: "Global English translations"
      contains: "common"
    - path: "globcrm-web/src/assets/i18n/tr.json"
      provides: "Global Turkish translations"
      contains: "common"
  key_links:
    - from: "globcrm-web/src/app/app.config.ts"
      to: "globcrm-web/src/app/core/i18n/transloco-loader.ts"
      via: "provideTransloco({ loader: TranslocoHttpLoader })"
      pattern: "provideTransloco"
    - from: "globcrm-web/src/app/app.component.ts"
      to: "globcrm-web/src/app/core/i18n/language.service.ts"
      via: "inject LanguageService and call init on bootstrap"
      pattern: "LanguageService"
---

<objective>
Install and configure @jsverse/transloco + @jsverse/transloco-locale as the i18n foundation. Create the TranslocoHttpLoader, LanguageService orchestrator, and global translation files (EN + TR). Wire everything into app.config.ts and initialize language on app bootstrap.

Purpose: Establish the i18n infrastructure that all subsequent localization plans depend on.
Output: Working Transloco setup with global translations, language detection, and fallback configuration.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-localization-foundation/27-RESEARCH.md
@globcrm-web/src/app/app.config.ts
@globcrm-web/src/app/app.component.ts
@globcrm-web/src/app/features/profile/profile.service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Transloco packages, create loader and LanguageService, create global translation files</name>
  <files>
    globcrm-web/package.json
    globcrm-web/src/app/core/i18n/transloco-loader.ts
    globcrm-web/src/app/core/i18n/language.service.ts
    globcrm-web/src/assets/i18n/en.json
    globcrm-web/src/assets/i18n/tr.json
  </files>
  <action>
    1. Install packages:
       ```bash
       cd globcrm-web && npm install @jsverse/transloco @jsverse/transloco-locale
       ```

    2. Create `globcrm-web/src/app/core/i18n/transloco-loader.ts`:
       - Injectable class `TranslocoHttpLoader` implementing `TranslocoLoader`
       - Inject `HttpClient`, implement `getTranslation(lang: string)` returning `this.http.get<Translation>(`./assets/i18n/${lang}.json`)`
       - For scoped translations, Transloco constructs the path as `./assets/i18n/{scope}/{lang}.json` automatically

    3. Create `globcrm-web/src/app/core/i18n/language.service.ts`:
       - `@Injectable({ providedIn: 'root' })` class `LanguageService`
       - Inject: `TranslocoService`, `DOCUMENT`
       - Expose `readonly currentLang = toSignal(this.translocoService.langChanges$, { initialValue: 'en' })` for reactive UI binding
       - `switchLanguage(lang: 'en' | 'tr')`: calls `translocoService.setActiveLang(lang)`, updates `document.documentElement.lang`, saves to `localStorage.setItem('globcrm_language', lang)`
       - `detectLanguage(): 'en' | 'tr'`: checks localStorage `globcrm_language` first, then `navigator.language?.substring(0, 2)` for 'tr', defaults to 'en'
       - `initLanguage()`: calls `detectLanguage()`, then `switchLanguage()` with the result — called once at app bootstrap
       - NOTE: Backend persistence (saving to profile API) will be wired in Plan 02 when the navbar switcher is built. This plan only handles localStorage + detection.

    4. Create `globcrm-web/src/assets/i18n/en.json` with global English translations:
       - `common`: save, cancel, delete, edit, search, loading, noResults, confirm, close, back, actions, create, update, export, filter, clearFilters, yes, no, required, optional, showMore, showLess, retry, error, success, warning, info
       - `common.paginator`: itemsPerPage, nextPage, previousPage, firstPage, lastPage, of
       - `common.table`: noData, sortAsc, sortDesc, columns, rowsPerPage
       - `common.validation`: required, minLength, maxLength, email, pattern, min, max
       - `nav`: myDay, analytics, reports, companies, contacts, leads, products, deals, activities, quotes, requests, notes, emails, templates, sequences, workflows, feed, calendar, duplicates, import, team, settings
       - `auth`: login, logout, register, forgotPassword, resetPassword, email, password, rememberMe, signIn, signUp, createAccount
       - `userMenu`: myProfile, security, language, signOut

    5. Create `globcrm-web/src/assets/i18n/tr.json` with Turkish translations for all the same keys:
       - Use proper Turkish characters (ş, ç, ğ, ı, İ, ö, ü, Ş, Ç, Ğ, Ö, Ü)
       - `common`: Kaydet, İptal, Sil, Düzenle, Ara, Yükleniyor..., Sonuç bulunamadı, Onayla, Kapat, Geri, İşlemler, Oluştur, Güncelle, Dışa Aktar, Filtrele, Filtreleri Temizle, Evet, Hayır, Zorunlu, İsteğe Bağlı, Daha Fazla, Daha Az, Tekrar Dene, Hata, Başarılı, Uyarı, Bilgi
       - `common.paginator`: Sayfa başına öğe, Sonraki sayfa, Önceki sayfa, İlk sayfa, Son sayfa, /
       - `nav`: Günüm, Analitik, Raporlar, Şirketler, Kişiler, Adaylar, Ürünler, Fırsatlar, Aktiviteler, Teklifler, Talepler, Notlar, E-postalar, Şablonlar, Diziler, İş Akışları, Akış, Takvim, Tekrarlar, İçeri Aktar, Ekip, Ayarlar
       - `auth`: Giriş Yap, Çıkış Yap, Kayıt Ol, Şifremi Unuttum, Şifre Sıfırla, E-posta, Şifre, Beni Hatırla, Giriş Yap, Kayıt Ol, Hesap Oluştur
       - `userMenu`: Profilim, Güvenlik, Dil, Çıkış Yap
  </action>
  <verify>
    - `cd globcrm-web && npm ls @jsverse/transloco @jsverse/transloco-locale` shows both packages installed
    - `ls src/app/core/i18n/transloco-loader.ts src/app/core/i18n/language.service.ts` both exist
    - `ls src/assets/i18n/en.json src/assets/i18n/tr.json` both exist
    - `cat src/assets/i18n/tr.json | python3 -c "import sys,json; json.load(sys.stdin); print('valid JSON')"` validates JSON
  </verify>
  <done>Transloco packages installed, TranslocoHttpLoader and LanguageService created, EN and TR global translation files exist with ~50+ keys each covering common, nav, auth, userMenu, paginator, table, and validation scopes</done>
</task>

<task type="auto">
  <name>Task 2: Wire Transloco providers into app.config.ts and initialize language in app.component.ts</name>
  <files>
    globcrm-web/angular.json
    globcrm-web/src/app/app.config.ts
    globcrm-web/src/app/app.component.ts
  </files>
  <action>
    1. Update `globcrm-web/angular.json`:
       - In the build assets array and test assets array, add: `{ "glob": "**/*", "input": "src/assets/i18n", "output": "/assets/i18n" }` so translation JSON files are served by the dev server and included in production builds.

    2. Update `globcrm-web/src/app/app.config.ts`:
       - Import and call `registerLocaleData(localeTr)` from `@angular/common/locales/tr` at module level (needed for Angular Material NativeDateAdapter Turkish locale support)
       - Add `provideTransloco()` to providers with config:
         ```
         availableLangs: ['en', 'tr']
         defaultLang: 'en'
         fallbackLang: 'en'
         reRenderOnLangChange: true
         prodMode: !isDevMode()
         missingHandler: { useFallbackTranslation: true, logMissingKey: true }
         ```
       - Set `loader: TranslocoHttpLoader`
       - Add `provideTranslocoLocale()` with `langToLocaleMapping: { en: 'en-US', tr: 'tr-TR' }`
       - Import `isDevMode` from `@angular/core`

    3. Update `globcrm-web/src/app/app.component.ts`:
       - Inject `LanguageService` (private readonly)
       - In the constructor body or via an init effect, call `this.languageService.initLanguage()` to set the initial language from localStorage/browser detection
       - This ensures the app loads with the correct language before any component renders
  </action>
  <verify>
    - `cd globcrm-web && npx ng build --configuration=development 2>&1 | tail -5` builds without errors
    - `grep -c "provideTransloco" src/app/app.config.ts` returns 1
    - `grep -c "provideTranslocoLocale" src/app/app.config.ts` returns 1
    - `grep "LanguageService" src/app/app.component.ts` shows injection
  </verify>
  <done>Transloco configured at app root with EN default, TR available, fallback to EN for missing keys, locale mapping to en-US/tr-TR, Turkish locale data registered, and language initialized on app bootstrap from localStorage/browser detection</done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration=development` completes without errors
2. Translation JSON files are valid and contain matching key structures
3. LanguageService.detectLanguage() returns 'en' when no localStorage and browser is English
4. Transloco missingHandler configured with useFallbackTranslation: true (missing TR keys fall back to EN)
5. provideTranslocoLocale maps en→en-US and tr→tr-TR
</verification>

<success_criteria>
- Transloco infrastructure is fully wired and builds successfully
- Global EN + TR translation files exist with comprehensive common/nav/auth keys
- LanguageService detects browser language, caches in localStorage, and initializes Transloco
- Missing translation keys fall back to English without showing raw keys (LOCL-06)
- Angular Turkish locale data is registered for Material DateAdapter support
</success_criteria>

<output>
After completion, create `.planning/phases/27-localization-foundation/27-01-SUMMARY.md`
</output>
