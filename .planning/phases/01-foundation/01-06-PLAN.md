---
phase: 01-foundation
plan: 06
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - globcrm-web/src/app/features/auth/auth.routes.ts
  - globcrm-web/src/app/features/auth/login/login.component.ts
  - globcrm-web/src/app/features/auth/login/login.component.html
  - globcrm-web/src/app/features/auth/login/login.component.scss
  - globcrm-web/src/app/features/auth/signup/signup.component.ts
  - globcrm-web/src/app/features/auth/signup/signup.component.html
  - globcrm-web/src/app/features/auth/signup/signup.component.scss
  - globcrm-web/src/app/features/auth/signup/create-org/create-org.component.ts
  - globcrm-web/src/app/features/auth/signup/create-org/create-org.component.html
  - globcrm-web/src/app/features/auth/signup/join-org/join-org.component.ts
  - globcrm-web/src/app/features/auth/signup/join-org/join-org.component.html
  - globcrm-web/src/app/features/auth/verify-email/verify-email.component.ts
  - globcrm-web/src/app/features/auth/verify-email/verify-email.component.html
  - globcrm-web/src/app/features/auth/forgot-password/forgot-password.component.ts
  - globcrm-web/src/app/features/auth/forgot-password/forgot-password.component.html
  - globcrm-web/src/app/features/auth/reset-password/reset-password.component.ts
  - globcrm-web/src/app/features/auth/reset-password/reset-password.component.html
  - globcrm-web/src/app/features/dashboard/dashboard.component.ts
  - globcrm-web/src/app/features/dashboard/dashboard.component.html
autonomous: true

must_haves:
  truths:
    - "User sees a login page with email/password fields and Remember me checkbox"
    - "Signup page has two distinct tabs: Create Organization and Join Organization"
    - "Create org form collects org name, subdomain (with real-time availability check), industry, company size, admin email, password"
    - "Join org form accepts invitation token and collects email, password, first/last name"
    - "User sees email verification page after signup"
    - "User can request password reset and set new password via email link"
  artifacts:
    - path: "globcrm-web/src/app/features/auth/login/login.component.ts"
      provides: "Login page with email, password, rememberMe, error handling"
    - path: "globcrm-web/src/app/features/auth/signup/create-org/create-org.component.ts"
      provides: "Create organization form with subdomain availability check"
    - path: "globcrm-web/src/app/features/auth/signup/join-org/join-org.component.ts"
      provides: "Join organization form for accepting invitations"
    - path: "globcrm-web/src/app/features/auth/verify-email/verify-email.component.ts"
      provides: "Email verification confirmation page"
  key_links:
    - from: "globcrm-web/src/app/features/auth/login/login.component.ts"
      to: "globcrm-web/src/app/core/auth/auth.service.ts"
      via: "AuthService.login() on form submit"
      pattern: "authService.*login"
    - from: "globcrm-web/src/app/features/auth/signup/create-org/create-org.component.ts"
      to: "globcrm-web/src/app/core/auth/auth.service.ts"
      via: "AuthService.createOrganization() and AuthService.checkSubdomainAvailability()"
      pattern: "authService.*createOrganization|checkSubdomainAvailability"
---

<objective>
Build all Angular authentication pages: login, signup (create org + join org), email verification, forgot password, and reset password.

Purpose: Create the complete frontend authentication experience. Users interact with these pages to create organizations, join via invitation, log in, verify email, and recover passwords.

Output: Working Angular pages for all auth flows using Angular Material components, reactive forms with validation, and integration with AuthService from Plan 02.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build login page and signup page (create org + join org)</name>
  <files>
    globcrm-web/src/app/features/auth/auth.routes.ts
    globcrm-web/src/app/features/auth/login/login.component.ts
    globcrm-web/src/app/features/auth/login/login.component.html
    globcrm-web/src/app/features/auth/login/login.component.scss
    globcrm-web/src/app/features/auth/signup/signup.component.ts
    globcrm-web/src/app/features/auth/signup/signup.component.html
    globcrm-web/src/app/features/auth/signup/signup.component.scss
    globcrm-web/src/app/features/auth/signup/create-org/create-org.component.ts
    globcrm-web/src/app/features/auth/signup/create-org/create-org.component.html
    globcrm-web/src/app/features/auth/signup/join-org/join-org.component.ts
    globcrm-web/src/app/features/auth/signup/join-org/join-org.component.html
    globcrm-web/src/app/features/dashboard/dashboard.component.ts
    globcrm-web/src/app/features/dashboard/dashboard.component.html
  </files>
  <action>
    1. **auth.routes.ts** -- Feature routes:
       ```typescript
       export const authRoutes: Routes = [
         { path: 'login', component: LoginComponent },
         { path: 'signup', component: SignupComponent },
         { path: 'join/:token', component: JoinOrgComponent },
         { path: 'verify-email', component: VerifyEmailComponent },
         { path: 'forgot-password', component: ForgotPasswordComponent },
         { path: 'reset-password', component: ResetPasswordComponent },
       ];
       ```

    2. **LoginComponent:**
       - All standalone components (no NgModules)
       - Centered card layout with GlobCRM branding (per discretion: uniform branding)
       - Reactive form with: email (required, email format), password (required, min 8)
       - "Remember me" checkbox (per locked decision: extends session to 30 days)
       - Submit calls AuthService.login(email, password, rememberMe)
       - On success: navigate to /dashboard (or returnUrl if present)
       - On 2FA required response: show 2FA code input field (per locked decision: optional 2FA)
       - On error: show mat-error message (invalid credentials, account locked, email not verified)
       - Links: "Forgot password?" -> /auth/forgot-password, "Sign up" -> /auth/signup
       - Angular Material components: mat-card, mat-form-field, mat-input, mat-checkbox, mat-button
       - Loading state with mat-spinner during API call

    3. **SignupComponent (parent):**
       - Per locked decision: Two distinct flows on signup page
       - Use mat-tab-group with two tabs: "Create Organization" and "Join Organization"
       - Each tab contains its respective child component
       - GlobCRM branding header

    4. **CreateOrgComponent:**
       - Per locked decision: collects org name, industry, company size, subdomain, admin email, password
       - Reactive form with fields:
         - Organization Name (required, 2-255 chars)
         - Subdomain (required, 3-63 chars, pattern: lowercase alphanumeric + hyphens)
           - Per locked decision: subdomain chosen during org creation with availability check
           - Debounced real-time check (300ms) using AuthService.checkSubdomainAvailability()
           - Show green checkmark icon when available, red X when taken
           - Preview: "{subdomain}.globcrm.com" shown below the field
         - Industry (optional, mat-select dropdown with common industries)
         - Company Size (optional, mat-select: 1-10, 11-50, 51-200, 200+)
         - First Name (required)
         - Last Name (required)
         - Email (required, email format)
         - Password (required, min 8, show strength indicator)
         - Confirm Password (must match)
       - Submit calls AuthService.createOrganization()
       - On success: navigate to /auth/verify-email with message "Check your email to verify your account"
       - On error: show validation errors

    5. **JoinOrgComponent:**
       - Per locked decision: join org works via invitation link or org invite code
       - Route: /auth/join/:token (from invitation email link)
       - On init: call AuthService to get invitation info by token (org name, role)
       - Show: "You've been invited to join {orgName} as {role}"
       - Form fields: Email (pre-filled from invitation, readonly), Password, First Name, Last Name
       - Submit calls AuthService.joinOrganization()
       - On success: navigate to /auth/login with success message
       - On error: show "Invitation expired" or "Invalid invitation" messages
       - Also accessible from signup tab for manual token entry (text input for invite code)

    6. **DashboardComponent (placeholder):**
       - Simple placeholder page: "Welcome to GlobCRM" + user name from AuthStore
       - Protected by authGuard
       - Will be replaced in future phases

    7. Styling:
       - Auth pages use a centered layout: 40% width card on desktop, full width on mobile
       - GlobCRM logo text at top of each auth card
       - Consistent spacing and typography using Angular Material theming
       - Form validation messages appear below fields using mat-error
  </action>
  <verify>
    Run `cd globcrm-web && ng build` -- must compile with 0 errors.
    Verify all component files exist under features/auth/.
    Verify create-org component has subdomain availability check with debounce.
    Verify login component has rememberMe checkbox.
  </verify>
  <done>
    Login page with email/password/rememberMe and 2FA code input. Signup page with two tabs: Create Organization (full form with real-time subdomain check) and Join Organization (invitation acceptance). Dashboard placeholder. All use Angular Material, reactive forms, standalone components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build email verification, forgot password, and reset password pages</name>
  <files>
    globcrm-web/src/app/features/auth/verify-email/verify-email.component.ts
    globcrm-web/src/app/features/auth/verify-email/verify-email.component.html
    globcrm-web/src/app/features/auth/forgot-password/forgot-password.component.ts
    globcrm-web/src/app/features/auth/forgot-password/forgot-password.component.html
    globcrm-web/src/app/features/auth/reset-password/reset-password.component.ts
    globcrm-web/src/app/features/auth/reset-password/reset-password.component.html
  </files>
  <action>
    1. **VerifyEmailComponent:**
       - Two states:
         a. **Pending verification** (after signup): Show "Check your email" message with email icon
            - "We sent a verification link to {email}. Click the link to verify your account."
            - "Didn't receive the email?" -> Resend button (calls AuthService.resendConfirmationEmail)
            - Resend cooldown: 60 seconds between resends (disable button with countdown timer)
         b. **Verification confirmation** (from email link): Route receives userId and code as query params
            - On init: call AuthService.confirmEmail(userId, code)
            - On success: show "Email verified! You can now log in." with link to login page
            - On error: show "Verification link expired or invalid" with resend option
       - GlobCRM branded card layout

    2. **ForgotPasswordComponent:**
       - Per locked decision: password reset via email link only, no security questions
       - Single field form: Email (required, email format)
       - Submit calls AuthService.forgotPassword(email)
       - On success: show "If an account exists with this email, we sent a password reset link."
         - Per security: always show success message even if email not found (prevent email enumeration)
       - Link back to login page
       - GlobCRM branded card layout

    3. **ResetPasswordComponent:**
       - Accessed from password reset email link
       - Route receives email and code as query params (from email link)
       - Form fields:
         - New Password (required, min 8, strength indicator)
         - Confirm Password (must match)
       - Submit calls AuthService.resetPassword(email, resetCode, newPassword)
       - On success: show "Password reset successfully! You can now log in." with link to login page
       - On error: show "Reset link expired or invalid. Request a new one." with link to forgot-password
       - GlobCRM branded card layout

    4. Shared patterns across all pages:
       - Standalone components with Angular Material
       - Reactive forms with proper validation
       - Loading states with mat-spinner
       - Error messages via mat-error
       - Centered card layout (consistent with login/signup)
       - Navigation links between related pages
  </action>
  <verify>
    Run `cd globcrm-web && ng build` -- must compile with 0 errors.
    Verify all 3 components exist with both .ts and .html files.
    Verify verify-email component handles both "pending" and "confirmation" states.
    Verify forgot-password always shows success message (no email enumeration).
  </verify>
  <done>
    Email verification page handles both post-signup pending state and email link confirmation. Forgot password page collects email and shows security-safe success message. Reset password page accepts new password with strength indicator. All pages use consistent GlobCRM branding and Angular Material components.
  </done>
</task>

</tasks>

<verification>
- `ng build` compiles with 0 errors
- Login page has email, password, rememberMe, 2FA code input, and links to signup/forgot-password
- Signup page has two tabs per locked decision: Create Organization and Join Organization
- Create org form has real-time subdomain availability check with debounce
- Join org form pre-fills email from invitation and shows org name/role
- Verify email handles both pending and confirmation states
- Forgot password prevents email enumeration (always shows success)
- Reset password validates matching passwords with strength indicator
</verification>

<success_criteria>
All auth pages implemented: login with rememberMe and 2FA support, signup with dual-tab create/join org flows, email verification with resend, forgot password with security-safe messaging, reset password with strength indicator. Create org includes real-time debounced subdomain availability check. All pages use Angular Material, reactive forms, standalone components, consistent GlobCRM branding.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-06-SUMMARY.md`
</output>
