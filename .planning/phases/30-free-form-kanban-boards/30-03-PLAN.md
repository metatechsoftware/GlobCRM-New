---
phase: 30-free-form-kanban-boards
plan: 03
type: execute
wave: 3
depends_on: [30-02]
files_modified:
  - globcrm-web/src/app/features/boards/boards.models.ts
  - globcrm-web/src/app/features/boards/boards.service.ts
  - globcrm-web/src/app/features/boards/boards.store.ts
  - globcrm-web/src/app/features/boards/boards.routes.ts
  - globcrm-web/src/app/features/boards/boards-list/boards-list.component.ts
  - globcrm-web/src/app/features/boards/boards-list/boards-list.component.html
  - globcrm-web/src/app/features/boards/boards-list/boards-list.component.scss
  - globcrm-web/src/app/features/boards/board-create-dialog/board-create-dialog.component.ts
  - globcrm-web/src/app/features/boards/board-create-dialog/board-create-dialog.component.html
  - globcrm-web/src/app/app.routes.ts
  - globcrm-web/src/app/shared/components/navbar/navbar.component.ts
autonomous: true
requirements:
  - KANB-01
  - KANB-05
  - KANB-09
  - KANB-14
  - KANB-18

must_haves:
  truths:
    - "User can navigate to /boards from the sidebar and see a grid of board cards with name, color accent, column count"
    - "System boards (Deal Pipeline, Activity Board) appear in a separate 'System Boards' section pinned at the top"
    - "User can click 'New Board' to open a dialog with template options (Sprint, Content Calendar, Sales Follow-up) plus Blank Board"
    - "User can create a board by picking a template and entering a name, then see it appear in the boards list"
    - "Empty boards page shows a create prompt with template suggestions (KANB-18)"
    - "Board cards show My Boards and Team Boards sections based on visibility"
  artifacts:
    - path: "globcrm-web/src/app/features/boards/boards.models.ts"
      provides: "All TypeScript interfaces for board DTOs"
      contains: "BoardListDto"
    - path: "globcrm-web/src/app/features/boards/boards.service.ts"
      provides: "API service for all board endpoints"
      contains: "BoardsService"
    - path: "globcrm-web/src/app/features/boards/boards.store.ts"
      provides: "Signal store for boards list and board detail state"
      contains: "BoardStore"
    - path: "globcrm-web/src/app/features/boards/boards-list/boards-list.component.ts"
      provides: "Boards list page with system boards, my boards, team boards sections"
      contains: "BoardsListComponent"
    - path: "globcrm-web/src/app/features/boards/board-create-dialog/board-create-dialog.component.ts"
      provides: "Board creation dialog with template selection"
      contains: "BoardCreateDialogComponent"
  key_links:
    - from: "app.routes.ts"
      to: "boards.routes.ts"
      via: "Lazy-loaded route for /boards"
      pattern: "loadChildren.*boards.routes"
    - from: "navbar.component.ts"
      to: "/boards route"
      via: "NavItem in Work group"
      pattern: "route.*boards.*icon.*view_kanban"
    - from: "BoardsListComponent"
      to: "BoardsService"
      via: "BoardStore.loadBoards() on init"
      pattern: "boardStore.*loadBoards"
    - from: "BoardCreateDialogComponent"
      to: "BoardsService.createBoard"
      via: "Dialog form submission"
      pattern: "boardsService.*createBoard"
---

<objective>
Create the frontend foundation for the boards feature: TypeScript models, API service, signal store, routes, navigation link, boards list page with system boards, and board creation dialog with templates.

Purpose: Establish the complete frontend infrastructure and the boards landing page where users browse existing boards, see system boards, and create new boards from templates. This is the entry point for the entire Kanban boards experience.

Output: Working boards list page accessible via /boards sidebar link, showing system boards + custom boards in a card grid, with a functional "New Board" dialog.
</objective>

<execution_context>
@C:/Users/maliy/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/maliy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-free-form-kanban-boards/30-RESEARCH.md
@.planning/phases/30-free-form-kanban-boards/30-02-SUMMARY.md

Reference files:
@globcrm-web/src/app/app.routes.ts (route registration pattern)
@globcrm-web/src/app/shared/components/navbar/navbar.component.ts (nav group structure)
@globcrm-web/src/app/features/deals/deals.service.ts (API service pattern)
@globcrm-web/src/app/features/deals/deal.store.ts (signal store pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create models, API service, signal store, and route infrastructure</name>
  <files>
    globcrm-web/src/app/features/boards/boards.models.ts
    globcrm-web/src/app/features/boards/boards.service.ts
    globcrm-web/src/app/features/boards/boards.store.ts
    globcrm-web/src/app/features/boards/boards.routes.ts
    globcrm-web/src/app/app.routes.ts
    globcrm-web/src/app/shared/components/navbar/navbar.component.ts
  </files>
  <action>
    **boards.models.ts** — TypeScript interfaces matching the API DTOs:
    - `BoardListDto` — id, name, description, color, visibility, creatorId, creatorName, columnCount, cardCount, createdAt, updatedAt
    - `BoardDetailDto` — id, name, description, color, visibility, creatorId, creatorName, teamId, columns (ColumnDto[]), labels (LabelDto[]), createdAt, updatedAt
    - `ColumnDto` — id, name, sortOrder, wipLimit (number | null), color, isCollapsed, cards (CardDto[])
    - `CardDto` — id, title, description, dueDate, assigneeId, assigneeName, sortOrder, isArchived, linkedEntityType, linkedEntityId, linkedEntityName, labels (CardLabelDto[]), checklistTotal, checklistChecked, commentCount, createdAt, updatedAt
    - `CardLabelDto` — labelId, name, color
    - `LabelDto` — id, name, color
    - `ChecklistItemDto` — id, text, isChecked, sortOrder
    - `CardCommentDto` — id, content, authorId, authorName, parentCommentId, createdAt, updatedAt, replies (CardCommentDto[])
    - `CreateBoardRequest`, `UpdateBoardRequest`, `CreateColumnRequest`, `UpdateColumnRequest`, `ReorderColumnsRequest`, `CreateCardRequest`, `UpdateCardRequest`, `MoveCardRequest`, `CreateLabelRequest`, `UpdateLabelRequest`, `CreateChecklistItemRequest`, `UpdateChecklistItemRequest`, `CreateCommentRequest`, `UpdateCommentRequest`
    - `BoardVisibility` enum (string union: 'private' | 'team' | 'public')
    - `BoardTemplate` interface + `BOARD_TEMPLATES` const array (Sprint, Content Calendar, Sales Follow-up) with nameKey, descriptionKey, icon, columns matching 30-RESEARCH.md definitions
    - `CardFilter` interface — labels (string[]), assigneeId (string | null), dueDateRange ('overdue' | 'today' | 'week' | 'all' | null)

    **boards.service.ts** — Injectable service using ApiService:
    - `getBoards(): Observable<BoardListDto[]>` — GET /api/boards
    - `getBoard(id: string): Observable<BoardDetailDto>` — GET /api/boards/{id}
    - `createBoard(req: CreateBoardRequest): Observable<BoardListDto>` — POST /api/boards
    - `updateBoard(id: string, req: UpdateBoardRequest): Observable<BoardListDto>` — PUT /api/boards/{id}
    - `deleteBoard(id: string): Observable<void>` — DELETE /api/boards/{id}
    - `createColumn(boardId: string, req: CreateColumnRequest): Observable<ColumnDto>` — POST /api/boards/{id}/columns
    - `updateColumn(boardId: string, colId: string, req: UpdateColumnRequest): Observable<ColumnDto>` — PUT /api/boards/{id}/columns/{colId}
    - `deleteColumn(boardId: string, colId: string): Observable<void>` — DELETE /api/boards/{id}/columns/{colId}
    - `reorderColumns(boardId: string, req: ReorderColumnsRequest): Observable<void>` — PATCH /api/boards/{id}/columns/reorder
    - `createCard(boardId: string, req: CreateCardRequest): Observable<CardDto>` — POST /api/boards/{id}/cards
    - `updateCard(boardId: string, cardId: string, req: UpdateCardRequest): Observable<CardDto>` — PUT /api/boards/{id}/cards/{cardId}
    - `moveCard(boardId: string, cardId: string, req: MoveCardRequest): Observable<CardDto>` — PATCH /api/boards/{id}/cards/{cardId}/move
    - `archiveCard(boardId: string, cardId: string): Observable<CardDto>` — PATCH /api/boards/{id}/cards/{cardId}/archive
    - Label endpoints: createLabel, updateLabel, deleteLabel, addLabelToCard, removeLabelFromCard
    - Checklist endpoints: createChecklistItem, updateChecklistItem, deleteChecklistItem, toggleChecklistItem
    - Comment endpoints: getComments, createComment, updateComment, deleteComment

    **boards.store.ts** — Per-page signal store (component-provided) following DealStore pattern:
    ```typescript
    export const BoardStore = signalStore(
      withState({
        boards: [] as BoardListDto[],
        board: null as BoardDetailDto | null,
        isLoading: false,
        isCardPanelOpen: false,
        selectedCardId: null as string | null,
        cardFilter: { labels: [], assigneeId: null, dueDateRange: null } as CardFilter,
      }),
      withMethods(/* ... */)
    );
    ```
    Methods: loadBoards, loadBoard, createBoard (with onSuccess/onError callbacks), updateBoard, deleteBoard, moveCard (optimistic with revert), reorderColumns (optimistic), openCardPanel, closeCardPanel, setCardFilter, clearCardFilter.

    **boards.routes.ts** — Lazy-loaded routes:
    - `''` — BoardsListComponent (boards list page)
    - `:id` — BoardDetailComponent (kanban board view — created in Plan 04)
    - Provide Transloco scope 'boards' via `provideTranslocoScope('boards')` in route providers (same pattern as other feature routes)
    - Provide BoardStore in route providers

    **app.routes.ts** — Add boards route:
    ```typescript
    {
      path: 'boards',
      canActivate: [authGuard],
      loadChildren: () =>
        import('./features/boards/boards.routes').then((m) => m.BOARD_ROUTES),
    },
    ```
    Add between 'activities' and 'quotes' paths.

    **navbar.component.ts** — Add boards nav item to "Work" group:
    ```typescript
    { route: '/boards', icon: 'view_kanban', label: 'nav.boards' },
    ```
    Add after activities and before quotes in the nav.groups.work section.
  </action>
  <verify>
    1. `cd globcrm-web && npx ng build --configuration development 2>&1 | head -50` — builds without errors (BoardDetailComponent not yet created, so the route import may need a placeholder or comment)
    2. boards.models.ts, boards.service.ts, boards.store.ts, boards.routes.ts all exist
    3. app.routes.ts has /boards route
    4. navbar.component.ts has boards NavItem in Work group
  </verify>
  <done>Frontend infrastructure (models, service, store, routes, navigation) is complete. API service covers all 25+ endpoints. Signal store supports boards list and board detail state with optimistic operations.</done>
</task>

<task type="auto">
  <name>Task 2: Create boards list page with system boards, card grid, and board creation dialog</name>
  <files>
    globcrm-web/src/app/features/boards/boards-list/boards-list.component.ts
    globcrm-web/src/app/features/boards/boards-list/boards-list.component.html
    globcrm-web/src/app/features/boards/boards-list/boards-list.component.scss
    globcrm-web/src/app/features/boards/board-create-dialog/board-create-dialog.component.ts
    globcrm-web/src/app/features/boards/board-create-dialog/board-create-dialog.component.html
  </files>
  <action>
    **BoardsListComponent** — Standalone component with ChangeDetectionStrategy.OnPush:
    - Inject BoardStore, MatDialog, Router, AuthStore, TranslocoService
    - On init: call boardStore.loadBoards()
    - Computed signals:
      - `myBoards` = boards where creatorId matches current user and visibility is Private
      - `teamBoards` = boards where visibility is Team or Public (excluding user's private ones)
    - System boards section (hardcoded, pinned at top):
      - Deal Pipeline card: icon 'handshake', routes to '/deals' (existing deal kanban), description from transloco key
      - Activity Board card: icon 'task_alt', routes to '/activities' (existing activity kanban)
      - These are NOT real board entities — they are hardcoded UI cards linking to existing pages

    **Template (boards-list.component.html):**
    - Page header: "Boards" title + "New Board" button (orange primary, mat-icon 'add')
    - Loading spinner when isLoading
    - **Empty state** (when no custom boards exist — KANB-18): Full-width centered card with Fraunces font heading ("Organize your work visually"), description text, template suggestion cards (Sprint, Content Calendar, Sales Follow-up) as clickable cards, and a "Create Board" CTA button. Each template card shows icon, name, description, and column preview (list of column names). Clicking a template card opens the create dialog with that template pre-selected.
    - **System Boards section**: Grid of system board cards with "System Boards" overline label (JetBrains Mono, uppercase, orange). Cards are read-only, not editable/deletable. Card design: icon, name, "System" badge, click navigates to existing page.
    - **My Boards section** (if any): Grid of custom board cards with "My Boards" overline label. Card shows: color accent stripe at top (board color), name (Plus Jakarta Sans 600), column count badge, card count badge, creator name, updated date. Hover: translateY(-2px) + shadow-md. Click navigates to /boards/{id}. Three-dot menu (MatMenu) with Edit and Delete options.
    - **Team Boards section** (if any): Same card design, "Team Boards" overline label.

    **Card grid layout:**
    - CSS Grid: 3 columns on desktop (>1200px), 2 on tablet (768-1200px), 1 on mobile (<768px)
    - Card matches Warm Modern design system: bg-card background, border-subtle, radius-lg (14px), 20-28px padding
    - Color accent: thin 4px stripe at top of card using board's hex color

    **Styles (boards-list.component.scss):**
    - Follow Warm Modern design system tokens (--color-surface, --text-primary, --text-secondary, --text-muted, --border-subtle, --border-hover, etc.)
    - Board card hover: border-hover + translateY(-2px) + shadow-md (standard card hover pattern)
    - System board cards: slightly different style — muted background, "System" chip badge
    - Empty state: centered layout with Fraunces font for heading, template preview cards in a row
    - Overline labels: JetBrains Mono, 0.6rem, uppercase, letter-spacing 0.08em, orange-500

    **BoardCreateDialogComponent** — MatDialog component:
    - Input: optional pre-selected template key (passed via dialog data)
    - Step 1: Template selection — show 4 options in a 2x2 grid: Blank Board + 3 templates (Sprint, Content Calendar, Sales Follow-up). Each option shows icon, name, description, column preview list. Selected option highlighted with orange border + orange-glow background.
    - Step 2: Board details form — Name (required input), Description (optional textarea), Color picker (preset palette of 8 colors: orange, blue, green, purple, red, teal, pink, yellow as hex values), Visibility selector (Private/Team/Public radio group or toggle), Team selector (dropdown, visible only when Team selected)
    - Form uses Angular reactive forms (FormGroup)
    - On submit: call boardStore.createBoard() with template key + form values. On success: close dialog, navigate to new board. On error: show error in dialog.
    - Cancel button closes dialog without action.
    - Dialog width: 640px max, responsive.

    Note: Boards are NOT permission-guarded — all authenticated users can create and view boards (access is controlled by board visibility, not RBAC permissions). This matches the design in CONTEXT.md.
  </action>
  <verify>
    1. `cd globcrm-web && npx ng build --configuration development` — builds without errors
    2. Navigate to http://localhost:4200/boards — see boards list page
    3. System boards section shows Deal Pipeline and Activity Board cards
    4. Click "New Board" — dialog opens with template options
    5. Empty state shows when no custom boards exist
  </verify>
  <done>Boards list page shows system boards pinned at top, custom boards in My Boards / Team Boards sections, empty state with template suggestions, and a functional board creation dialog with template selection and details form.</done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build --configuration development` — builds cleanly
2. /boards route is accessible from sidebar navigation
3. Boards list shows system boards + custom boards in separate sections
4. Board creation dialog opens with template selection and creates a board
5. Empty state displays when no custom boards exist
6. Board cards show color accent, column count, card count
</verification>

<success_criteria>
- Frontend builds without errors
- Sidebar shows "Boards" link with view_kanban icon in Work group
- Boards list page renders with system boards section
- Board creation dialog works with all 3 templates + blank board
- Empty state matches KANB-18 requirement
- All components follow Warm Modern design system
</success_criteria>

<output>
After completion, create `.planning/phases/30-free-form-kanban-boards/30-03-SUMMARY.md`
</output>
