---
phase: 23-summary-tabs-on-detail-pages
plan: 04
type: execute
wave: 4
depends_on:
  - 23-01
  - 23-02
  - 23-03
files_modified:
  - globcrm-web/src/app/shared/components/entity-form-dialog/entity-form-dialog.models.ts
  - globcrm-web/src/app/shared/components/entity-form-dialog/entity-form-dialog.component.ts
  - globcrm-web/src/app/features/notes/note-form/note-form.component.ts
  - globcrm-web/src/app/shared/components/related-entity-tabs/related-entity-tabs.component.ts
  - globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
  - globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
  - globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
  - globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.ts
  - globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts
  - globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html
  - globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
autonomous: true
requirements:
  - SUMMARY-01
  - SUMMARY-07

must_haves:
  truths:
    - "Summary tab is the first (default, index 0) tab on Company, Contact, Deal, Lead, Quote, and Request detail pages"
    - "Summary tab loads its data via SummaryService on initial page load (since it is the default tab)"
    - "Quick action Add Note opens a dialog, and on close summary data refreshes immediately"
    - "Quick action Log Activity opens a dialog, and on close summary data refreshes immediately"
    - "Quick action Send Email opens a dialog (Contact/Lead only), and on close summary data refreshes immediately"
    - "Summary data auto-refreshes when user performs mutations on sibling tabs (dirty-flag invalidation)"
    - "Association chip click switches to the corresponding tab on the detail page"
    - "Existing tab functionality on all 6 entity detail pages continues to work unchanged"
  artifacts:
    - path: "globcrm-web/src/app/shared/components/entity-form-dialog/entity-form-dialog.models.ts"
      provides: "CreateDialogEntityType extended with 'Note'"
      contains: "Note"
    - path: "globcrm-web/src/app/shared/components/entity-form-dialog/entity-form-dialog.component.ts"
      provides: "EntityFormDialogComponent with Note case in @switch"
      contains: "NoteFormComponent"
    - path: "globcrm-web/src/app/features/notes/note-form/note-form.component.ts"
      provides: "NoteFormComponent with dialogMode input, entityCreated/entityCreateError outputs"
      contains: "dialogMode"
    - path: "globcrm-web/src/app/shared/components/related-entity-tabs/related-entity-tabs.component.ts"
      provides: "COMPANY_TABS, CONTACT_TABS, DEAL_TABS with Summary tab prepended at index 0"
      contains: "Summary"
    - path: "globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts"
      provides: "Company detail page with summary tab data loading, dirty-flag invalidation, and quick action dialog handlers"
      contains: "summaryData"
    - path: "globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts"
      provides: "Contact detail page with summary tab including email engagement"
      contains: "summaryData"
    - path: "globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts"
      provides: "Deal detail page with summary tab including stage progress"
      contains: "summaryData"
    - path: "globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.ts"
      provides: "Lead detail page with summary tab including stage progress"
      contains: "summaryData"
    - path: "globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts"
      provides: "Quote detail page with summary tab added to existing mat-tab-group"
      contains: "summaryData"
    - path: "globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts"
      provides: "Request detail page with summary tab added to existing mat-tab-group"
      contains: "summaryData"
  key_links:
    - from: "company-detail.component.ts"
      to: "SummaryService"
      via: "inject(SummaryService) and getCompanySummary() call"
      pattern: "summaryService\\.getCompanySummary"
    - from: "company-detail.component.ts onTabChanged"
      to: "summaryDirty signal"
      via: "dirty-flag check on Summary tab activation"
      pattern: "summaryDirty"
    - from: "EntitySummaryTabComponent associationClicked"
      to: "detail component activeTabIndex signal"
      via: "output event sets activeTabIndex signal which is bound to [activeTabIndex] on RelatedEntityTabsComponent"
      pattern: "activeTabIndex\\.set"
    - from: "detail component onSummaryAddNote"
      to: "EntityFormDialogComponent"
      via: "dialog.open(EntityFormDialogComponent, { data: { entityType: 'Note' } })"
      pattern: "dialog\\.open.*EntityFormDialogComponent.*Note"
---

<objective>
Insert the Summary tab at index 0 on all 6 entity detail pages, wire summary data loading with dirty-flag invalidation, and connect quick action dialog handlers for Add Note, Log Activity, and Send Email.

Purpose: This is the integration plan that brings everything together -- the backend endpoints (23-01), the shared components (23-02), and the content widgets (23-03) are all wired into each entity's detail page. After this plan, users see a rich at-a-glance overview as the default tab on every major entity detail page.

Output: All 6 entity detail pages have a Summary tab as the first tab with full data loading, auto-refresh on mutations, and quick action dialogs.
</objective>

<execution_context>
@/Users/metatech/.claude/get-shit-done/workflows/execute-plan.md
@/Users/metatech/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-summary-tabs-on-detail-pages/23-RESEARCH.md
@.planning/phases/23-summary-tabs-on-detail-pages/23-01-SUMMARY.md
@.planning/phases/23-summary-tabs-on-detail-pages/23-02-SUMMARY.md
@.planning/phases/23-summary-tabs-on-detail-pages/23-03-SUMMARY.md
@globcrm-web/src/app/shared/components/entity-form-dialog/entity-form-dialog.component.ts
@globcrm-web/src/app/shared/components/entity-form-dialog/entity-form-dialog.models.ts
@globcrm-web/src/app/features/notes/note-form/note-form.component.ts
@globcrm-web/src/app/shared/components/related-entity-tabs/related-entity-tabs.component.ts
@globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
@globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
@globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
@globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.ts
@globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts
@globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html
@globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend EntityFormDialog for Note, insert Summary tab, wire Company/Contact/Deal/Lead detail pages</name>
  <files>
    globcrm-web/src/app/shared/components/entity-form-dialog/entity-form-dialog.models.ts
    globcrm-web/src/app/shared/components/entity-form-dialog/entity-form-dialog.component.ts
    globcrm-web/src/app/features/notes/note-form/note-form.component.ts
    globcrm-web/src/app/shared/components/related-entity-tabs/related-entity-tabs.component.ts
    globcrm-web/src/app/features/companies/company-detail/company-detail.component.ts
    globcrm-web/src/app/features/contacts/contact-detail/contact-detail.component.ts
    globcrm-web/src/app/features/deals/deal-detail/deal-detail.component.ts
    globcrm-web/src/app/features/leads/lead-detail/lead-detail.component.ts
  </files>
  <action>
**Step 1: Extend EntityFormDialogComponent to support Note entity type**

Per locked decision: "Quick actions open dialog/modal forms." The existing `EntityFormDialogComponent` supports Contact, Company, Deal, Activity, Product, Lead. We must add Note support so the Add Note quick action opens a dialog.

**entity-form-dialog.models.ts:**
Add `'Note'` to the `CreateDialogEntityType` union type:
```typescript
export type CreateDialogEntityType = 'Contact' | 'Company' | 'Deal' | 'Activity' | 'Product' | 'Lead' | 'Note';
```

Extend `EntityFormDialogData` to support optional pre-fill context for notes:
```typescript
export interface EntityFormDialogData {
  entityType: CreateDialogEntityType;
  /** Optional pre-fill context for Note creation from entity detail pages */
  prefill?: {
    entityType?: string;
    entityId?: string;
    entityName?: string;
  };
}
```

**note-form.component.ts:**
Add dialog mode support following the same pattern as other form components (ContactFormComponent, CompanyFormComponent, etc.):

1. Add `dialogMode = input(false)` input signal
2. Add `entityCreated = output<any>()` and `entityCreateError = output<void>()` output signals
3. Add optional `@Inject(MAT_DIALOG_DATA) data` -- but since it's optional (component works both standalone and in dialog), use a conditional approach: inject `MAT_DIALOG_DATA` with `@Optional()` or check if dialog data is provided
4. When `dialogMode()` is true:
   - Hide the form header (back button + title) and form-actions footer (Cancel/Create buttons) -- those are handled by the parent dialog
   - Expose a `triggerSubmit()` method that the dialog parent calls (same pattern as other form components): `triggerSubmit(): void { this.onSubmit(); }`
   - In `onSubmit()` success handler: if `dialogMode()`, emit `entityCreated.emit(created)` instead of `router.navigate()`; on error, emit `entityCreateError.emit()` instead of just showing snackbar
   - If `dialogMode()`, still show the snackbar for success/error
5. Accept pre-fill data from dialog: in `ngOnInit`, if `dialogMode()` and pre-fill data is provided via MAT_DIALOG_DATA, call the same `prefillFromQueryParams`-like logic using the dialog data's `prefill` object instead of route queryParams

Concrete changes to the template: wrap the `.form-header` div and `.form-actions` div in `@if (!dialogMode())` blocks.

Concrete changes to `onSubmit()`:
```typescript
// In create success handler:
next: (created) => {
  this.isSaving.set(false);
  this.snackBar.open('Note created successfully', 'Close', { duration: 3000 });
  if (this.dialogMode()) {
    this.entityCreated.emit(created);
  } else {
    this.router.navigate(['/notes', created.id]);
  }
},
error: () => {
  this.isSaving.set(false);
  this.snackBar.open('Failed to create note', 'Close', { duration: 5000 });
  if (this.dialogMode()) {
    this.entityCreateError.emit();
  }
}
```

**entity-form-dialog.component.ts:**
1. Add `NoteFormComponent` to imports array
2. Add `@case ('Note')` to the template `@switch (data.entityType)` block:
```html
@case ('Note') {
  <app-note-form
    [dialogMode]="true"
    (entityCreated)="onEntityCreated($event)"
    (entityCreateError)="onCreateError()" />
}
```
3. Add `private readonly noteForm = viewChild(NoteFormComponent);` to ViewChild references
4. Add `case 'Note': return this.noteForm();` to `getActiveForm()` switch

**Step 2: Update tab constants (related-entity-tabs.component.ts):**
Prepend `{ label: 'Summary', icon: 'dashboard', enabled: true }` at index 0 of:
- `COMPANY_TABS`
- `CONTACT_TABS`
- `DEAL_TABS`

Lead uses a computed `tabs()` signal in its detail component, not these constants. It will be handled in the detail component.

These are the 4 entity types that use `RelatedEntityTabsComponent` with label-based tab switching (Phase 22 refactor). Adding at index 0 is safe because tab matching is label-based, not index-based.

**Step 3: Wire Company detail page (company-detail.component.ts):**

Add imports: `SummaryService`, `EntitySummaryTabComponent`, `MatDialog`, `EntityFormDialogComponent`, `EntityFormDialogData`, `EntityFormDialogResult`, summary DTO types.

Add signals:
```typescript
summaryData = signal<CompanySummaryDto | null>(null);
summaryLoading = signal(false);
summaryDirty = signal(false);
activeTabIndex = signal(0);
```

Inject: `private summaryService = inject(SummaryService)`, `private dialog = inject(MatDialog)` (if not already injected)

Add `loadSummary()` method:
```typescript
private loadSummary(): void {
  const id = this.companyId; // however the component gets the entity ID
  this.summaryLoading.set(true);
  this.summaryDirty.set(false);
  this.summaryService.getCompanySummary(id).subscribe({
    next: (data) => {
      this.summaryData.set(data);
      this.summaryLoading.set(false);
    },
    error: () => this.summaryLoading.set(false),
  });
}
```

Update `ngOnInit` (or wherever entity data loads): call `this.loadSummary()` since Summary is the default tab.

Update `onTabChanged(label: string)` method:
- Add case for `'Summary'`: if `!this.summaryData() || this.summaryDirty()`, call `this.loadSummary()`
- Existing tab cases remain unchanged

Add `markSummaryDirty()` method -- call this after any mutation on sibling tabs:
```typescript
markSummaryDirty(): void {
  this.summaryDirty.set(true);
}
```

Wire dirty-flag: wherever the detail page performs mutations (adding notes, linking contacts, creating activities, etc.), call `this.markSummaryDirty()` after the mutation succeeds. Look for existing subscribe/afterClosed handlers that refresh data and add `this.markSummaryDirty()` alongside.

Add quick action handlers -- ALL open dialogs per locked decision ("Quick actions open dialog/modal forms"):
```typescript
onSummaryAddNote(): void {
  const dialogRef = this.dialog.open(EntityFormDialogComponent, {
    width: '700px',
    data: {
      entityType: 'Note',
      prefill: {
        entityType: 'Company',
        entityId: this.companyId,
        entityName: this.company()?.name,
      },
    } as EntityFormDialogData,
  });
  dialogRef.afterClosed().subscribe((result: EntityFormDialogResult | undefined) => {
    if (result?.entity) {
      this.loadSummary(); // Immediate refresh per user decision
    }
  });
}

onSummaryLogActivity(): void {
  const dialogRef = this.dialog.open(EntityFormDialogComponent, {
    width: '700px',
    data: {
      entityType: 'Activity',
      prefill: {
        entityType: 'Company',
        entityId: this.companyId,
        entityName: this.company()?.name,
      },
    } as EntityFormDialogData,
  });
  dialogRef.afterClosed().subscribe((result: EntityFormDialogResult | undefined) => {
    if (result?.entity) {
      this.loadSummary(); // Immediate refresh per user decision
    }
  });
}

onSummarySendEmail(): void {
  // Only for Contact/Lead -- open email compose dialog
  // After close, call this.loadSummary()
}
```

**IMPORTANT per user decision:** "After a quick action completes (note saved, activity logged), summary tab data auto-refreshes to reflect the change immediately." The `afterClosed()` handler calls `this.loadSummary()` directly (not just `markSummaryDirty()`).

Add `onAssociationClicked(label: string)` handler for programmatic tab switching:
```typescript
onAssociationClicked(label: string): void {
  const tabs = COMPANY_TABS; // the same tabs array passed to RelatedEntityTabsComponent
  const index = tabs.findIndex(t => t.label === label);
  if (index >= 0) {
    this.activeTabIndex.set(index);
  }
}
```

Update template: bind `[activeTabIndex]="activeTabIndex()"` on the `<app-related-entity-tabs>` component. Add an `<ng-template>` for the Summary tab at position 0 (before the existing Details template):
```html
<app-related-entity-tabs [tabs]="companyTabs" [activeTabIndex]="activeTabIndex()" (tabChanged)="onTabChanged($event)">
  <ng-template>
    @if (summaryData() || summaryLoading()) {
      <app-entity-summary-tab
        entityType="Company"
        [data]="summaryData()!"
        [loading]="summaryLoading()"
        (associationClicked)="onAssociationClicked($event)"
        (addNote)="onSummaryAddNote()"
        (logActivity)="onSummaryLogActivity()"
        (sendEmail)="onSummarySendEmail()" />
    }
  </ng-template>
  <!-- existing ng-templates for Details, Contacts, Deals, etc. remain unchanged -->
</app-related-entity-tabs>
```

**Step 4: Wire Contact detail page (contact-detail.component.ts):**
Same pattern as Company, but:
- Use `summaryService.getContactSummary(id)`
- Summary DTO is `ContactSummaryDto`
- Add `activeTabIndex = signal(0)` and bind `[activeTabIndex]="activeTabIndex()"` on `<app-related-entity-tabs>`
- `onAssociationClicked(label)`: use `CONTACT_TABS.findIndex(t => t.label === label)` to set `activeTabIndex`
- `showSendEmail` is true for Contact (EntitySummaryTabComponent handles this via entityType input)
- Quick action Send Email should open the email compose interface for this contact
- Quick action Add Note: same `dialog.open(EntityFormDialogComponent, { data: { entityType: 'Note', prefill: { entityType: 'Contact', ... } } })` pattern
- Quick action Log Activity: same `dialog.open(EntityFormDialogComponent, { data: { entityType: 'Activity', prefill: { entityType: 'Contact', ... } } })` pattern

**Step 5: Wire Deal detail page (deal-detail.component.ts):**
Same pattern as Company, but:
- Use `summaryService.getDealSummary(id)`
- Summary DTO is `DealSummaryDto`
- Add `activeTabIndex = signal(0)` and bind `[activeTabIndex]="activeTabIndex()"` on `<app-related-entity-tabs>`
- `onAssociationClicked(label)`: use `DEAL_TABS.findIndex(t => t.label === label)` to set `activeTabIndex`
- No Send Email action (Deal has no direct email target)
- Quick action Add Note and Log Activity use same dialog pattern with `entityType: 'Deal'` prefill

**Step 6: Wire Lead detail page (lead-detail.component.ts):**
Lead uses a computed `tabs()` signal rather than a shared constant. Prepend `{ label: 'Summary', icon: 'dashboard', enabled: true }` at index 0 of the computed tabs array.
- Use `summaryService.getLeadSummary(id)`
- Summary DTO is `LeadSummaryDto`
- Add `activeTabIndex = signal(0)` and bind `[activeTabIndex]="activeTabIndex()"` on `<app-related-entity-tabs>`
- `onAssociationClicked(label)`: use `this.tabs().findIndex(t => t.label === label)` to set `activeTabIndex`
- Send Email action is available (Leads have email addresses)
- Quick action Add Note and Log Activity use same dialog pattern with `entityType: 'Lead'` prefill

For all 4 detail pages:
- Import `EntitySummaryTabComponent`, `EntityFormDialogComponent`, `EntityFormDialogData`, `EntityFormDialogResult` in the component's `imports` array (EntityFormDialogComponent) or as type imports
- Ensure `SummaryService` and `MatDialog` are injected
  </action>
  <verify>
    cd globcrm-web && npx ng build 2>&1 | tail -10
    Verify: Build succeeds. All 4 detail pages import EntitySummaryTabComponent and have summaryData/summaryLoading/summaryDirty/activeTabIndex signals. Tab constants include 'Summary' at index 0. EntityFormDialogComponent supports 'Note' entity type. NoteFormComponent has dialogMode input.
  </verify>
  <done>
    EntityFormDialogComponent extended with 'Note' entity type for dialog-based note creation.
    NoteFormComponent has dialogMode support with entityCreated/entityCreateError outputs.
    COMPANY_TABS, CONTACT_TABS, and DEAL_TABS have Summary tab at index 0.
    Company, Contact, Deal, and Lead detail pages load summary data on init, refresh on dirty-flag, and open EntityFormDialogComponent dialogs for all quick actions (Add Note, Log Activity) with afterClosed -> loadSummary().
    Association chip clicks set activeTabIndex signal which is bound to [activeTabIndex] on RelatedEntityTabsComponent, switching to the corresponding tab.
    All existing tab functionality is preserved (label-based matching is unaffected by index shift).
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Quote and Request detail pages with Summary tab</name>
  <files>
    globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.ts
    globcrm-web/src/app/features/quotes/quote-detail/quote-detail.component.html
    globcrm-web/src/app/features/requests/request-detail/request-detail.component.ts
  </files>
  <action>
Quote and Request detail pages use raw `mat-tab-group` directly (not RelatedEntityTabsComponent). Per research recommendation, add the Summary tab directly to their existing `mat-tab-group` rather than refactoring them to use RelatedEntityTabsComponent (which would be risky mid-phase).

**Quote detail page (quote-detail.component.ts + .html):**

Add imports: `SummaryService`, `EntitySummaryTabComponent`, `MatDialog`, `EntityFormDialogComponent`, `EntityFormDialogData`, `EntityFormDialogResult`, summary DTO types.

Add signals:
```typescript
summaryData = signal<QuoteSummaryDto | null>(null);
summaryLoading = signal(false);
summaryDirty = signal(false);
selectedTabIndex = signal(0); // if not already present
```

Inject `SummaryService` and `MatDialog`.

Add `loadSummary()` method (same pattern as Company).

Call `loadSummary()` in `ngOnInit`.

Add a `mat-tab` at position 0 (first tab) in the template's `mat-tab-group`:
```html
<mat-tab>
  <ng-template mat-tab-label>
    <mat-icon class="tab-icon">dashboard</mat-icon>
    Summary
  </ng-template>
  @if (summaryData() || summaryLoading()) {
    <app-entity-summary-tab
      entityType="Quote"
      [data]="summaryData()!"
      [loading]="summaryLoading()"
      (associationClicked)="onAssociationClicked($event)"
      (addNote)="onSummaryAddNote()"
      (logActivity)="onSummaryLogActivity()" />
  }
</mat-tab>
```

Bind `[selectedIndex]="selectedTabIndex()"` and `(selectedIndexChange)="onTabIndexChanged($event)"` on the `mat-tab-group`.

Handle tab change: In `onTabIndexChanged(index: number)`, update `selectedTabIndex.set(index)`. If index is 0 (Summary) and `summaryDirty()`, call `loadSummary()`.

IMPORTANT: Review the existing template carefully. If there are `(selectedTabChange)` handlers or index-based logic, update them to account for the Summary tab insertion at index 0. Since Quote uses raw mat-tab-group, any existing hardcoded indices need to shift by 1.

Add quick action handlers -- ALL open dialogs per locked decision:
```typescript
onSummaryAddNote(): void {
  const dialogRef = this.dialog.open(EntityFormDialogComponent, {
    width: '700px',
    data: {
      entityType: 'Note',
      prefill: { entityType: 'Quote', entityId: this.quoteId, entityName: this.quote()?.title },
    } as EntityFormDialogData,
  });
  dialogRef.afterClosed().subscribe((result: EntityFormDialogResult | undefined) => {
    if (result?.entity) {
      this.loadSummary();
    }
  });
}

onSummaryLogActivity(): void {
  const dialogRef = this.dialog.open(EntityFormDialogComponent, {
    width: '700px',
    data: {
      entityType: 'Activity',
      prefill: { entityType: 'Quote', entityId: this.quoteId, entityName: this.quote()?.title },
    } as EntityFormDialogData,
  });
  dialogRef.afterClosed().subscribe((result: EntityFormDialogResult | undefined) => {
    if (result?.entity) {
      this.loadSummary();
    }
  });
}
```

Add `onAssociationClicked(tabLabel: string)` handler: build an array of tab labels matching the mat-tab-group order (e.g., `['Summary', 'Details', 'Line Items', ...]`), find the index of `tabLabel`, and set `selectedTabIndex.set(index)`.

Wire dirty-flag (`markSummaryDirty()`) into existing mutation handlers (status transitions, note creation, etc.).

**Request detail page (request-detail.component.ts):**
Same approach as Quote:
- Request uses raw `mat-tab-group` with inline template
- Add `mat-tab` for Summary at position 0
- Add summaryData/summaryLoading/summaryDirty/selectedTabIndex signals
- Inject SummaryService and MatDialog, call loadSummary() on init
- Bind `[selectedIndex]` and `(selectedIndexChange)` on the mat-tab-group
- Handle tab index shift for existing tabs
- Wire dirty-flag into status transition handlers
- Quick action handlers use `dialog.open(EntityFormDialogComponent, ...)` pattern with `entityType: 'Note'` or `'Activity'` and prefill `{ entityType: 'Request', ... }`
- `onAssociationClicked(tabLabel)`: build tab labels array, find index, set `selectedTabIndex`

For both Quote and Request:
- Import `EntitySummaryTabComponent` and `EntityFormDialogComponent` in component imports
- No Send Email quick action (Quote/Request don't have direct email targets)
  </action>
  <verify>
    cd globcrm-web && npx ng build 2>&1 | tail -10
    Verify: Build succeeds. Quote and Request detail pages have Summary tab at index 0 with summaryData signals.
  </verify>
  <done>
    Quote detail page has Summary tab inserted at index 0 of its mat-tab-group with data loading, dirty-flag invalidation, and quick action handlers.
    Request detail page has Summary tab inserted at index 0 with the same functionality.
    All existing tabs on both pages continue to work correctly with updated indices.
    All 6 entity types now have Summary as the default first tab.
  </done>
</task>

</tasks>

<verification>
1. `cd globcrm-web && npx ng build` succeeds
2. EntityFormDialogComponent supports 'Note' entity type (grep for `'Note'` in entity-form-dialog.models.ts and `@case ('Note')` in entity-form-dialog.component.ts)
3. NoteFormComponent has `dialogMode` input and `entityCreated`/`entityCreateError` outputs (grep for `dialogMode` in note-form.component.ts)
4. All 6 entity detail pages show Summary as the first (default) tab
5. Summary data loads on initial page open for all 6 entity types
6. Quick action buttons appear on summary tab with correct permission guards
7. Clicking Add Note opens `EntityFormDialogComponent` dialog (NOT router.navigate) and refreshes summary on afterClosed
8. Clicking Log Activity opens `EntityFormDialogComponent` dialog and refreshes summary on afterClosed
9. Clicking an association chip sets `activeTabIndex` signal to switch to the corresponding tab
10. Making a mutation on a sibling tab sets summaryDirty=true
11. Returning to the Summary tab after a mutation triggers a data reload
12. Existing tab functionality (Details, Contacts, Activities, etc.) continues to work on all 6 entity types
13. Quote and Request mat-tab-group indices are updated to account for Summary at position 0
</verification>

<success_criteria>
Summary tab appears as the first default tab on Company, Contact, Deal, Lead, Quote, and Request detail pages, with data loading, dirty-flag invalidation, quick action dialogs, and association chip navigation all working. Existing functionality is preserved.
</success_criteria>

<output>
After completion, create `.planning/phases/23-summary-tabs-on-detail-pages/23-04-SUMMARY.md`
</output>
