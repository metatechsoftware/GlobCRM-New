<div class="sequence-list">
  <!-- Header -->
  <div class="sequence-list__header">
    <div class="sequence-list__title-group">
      <div class="sequence-list__title-row">
        <div class="sequence-list__icon">
          <mat-icon>route</mat-icon>
        </div>
        <h1>{{ 'sequences.list.title' | transloco }}</h1>
      </div>
      <p class="sequence-list__subtitle">{{ 'sequences.list.subtitle' | transloco }}</p>
    </div>
    <a mat-flat-button color="primary" routerLink="/sequences/new">
      <mat-icon>add</mat-icon>
      {{ 'sequences.list.createButton' | transloco }}
    </a>
  </div>

  <!-- Loading -->
  @if (store.loading()) {
    <div class="sequence-list__loading">
      <mat-spinner diameter="40"></mat-spinner>
      <span>{{ 'sequences.list.loading' | transloco }}</span>
    </div>
  } @else if (store.sequences().length === 0) {
    <!-- Empty State -->
    <div class="sequence-list__empty">
      <div class="sequence-list__empty-icon">
        <mat-icon>campaign</mat-icon>
      </div>
      <h3>{{ 'sequences.list.empty.title' | transloco }}</h3>
      <p>{{ 'sequences.list.empty.description' | transloco }}</p>
      <a mat-flat-button color="primary" routerLink="/sequences/new">
        <mat-icon>add</mat-icon>
        {{ 'sequences.list.createButton' | transloco }}
      </a>
    </div>
  } @else {
    <!-- Summary Stats Bar -->
    <div class="sequence-list__stats-bar">
      <div class="sequence-list__stat-item">
        <span class="sequence-list__stat-dot sequence-list__stat-dot--active"></span>
        <span class="sequence-list__stat-value">{{ getActiveCount() }}</span>
        {{ 'sequences.list.stats.active' | transloco }}
      </div>
      <div class="sequence-list__stat-item">
        <span class="sequence-list__stat-dot sequence-list__stat-dot--paused"></span>
        <span class="sequence-list__stat-value">{{ getPausedCount() }}</span>
        {{ 'sequences.list.stats.paused' | transloco }}
      </div>
      <div class="sequence-list__stat-item">
        <span class="sequence-list__stat-dot sequence-list__stat-dot--draft"></span>
        <span class="sequence-list__stat-value">{{ getDraftCount() }}</span>
        {{ 'sequences.list.stats.draft' | transloco }}
      </div>
      <div class="sequence-list__stat-item" style="margin-left: auto;">
        <span class="sequence-list__stat-value">{{ store.sequences().length }}</span>
        {{ 'sequences.list.stats.total' | transloco }}
      </div>
    </div>

    <!-- Sequence Table -->
    <div class="sequence-list__table-wrap">
      <table mat-table [dataSource]="store.sequences()">
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>{{ 'sequences.list.columns.name' | transloco }}</th>
          <td mat-cell *matCellDef="let seq">
            <div class="sequence-list__name-cell">
              <a class="sequence-list__name-link" [routerLink]="['/sequences', seq.id]">
                {{ seq.name }}
              </a>
              @if (seq.description) {
                <div class="sequence-list__desc">{{ seq.description }}</div>
              }
            </div>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>{{ 'sequences.list.columns.status' | transloco }}</th>
          <td mat-cell *matCellDef="let seq">
            <span class="sequence-list__status"
                  [class.status--draft]="seq.status === 'draft'"
                  [class.status--active]="seq.status === 'active'"
                  [class.status--paused]="seq.status === 'paused'"
                  [class.status--archived]="seq.status === 'archived'">
              <span class="sequence-list__status-dot"></span>
              {{ seq.status | titlecase }}
            </span>
          </td>
        </ng-container>

        <!-- Steps Column -->
        <ng-container matColumnDef="steps">
          <th mat-header-cell *matHeaderCellDef>{{ 'sequences.list.columns.steps' | transloco }}</th>
          <td mat-cell *matCellDef="let seq">
            <span class="sequence-list__stat">{{ seq.stepCount }}</span>
          </td>
        </ng-container>

        <!-- Enrolled Column -->
        <ng-container matColumnDef="enrolled">
          <th mat-header-cell *matHeaderCellDef>{{ 'sequences.list.columns.enrolled' | transloco }}</th>
          <td mat-cell *matCellDef="let seq">
            <span class="sequence-list__stat">{{ seq.totalEnrolled }}</span>
          </td>
        </ng-container>

        <!-- Active Column -->
        <ng-container matColumnDef="active">
          <th mat-header-cell *matHeaderCellDef>{{ 'sequences.list.columns.active' | transloco }}</th>
          <td mat-cell *matCellDef="let seq">
            <span class="sequence-list__stat">{{ seq.activeEnrollments }}</span>
          </td>
        </ng-container>

        <!-- Completed Column -->
        <ng-container matColumnDef="completed">
          <th mat-header-cell *matHeaderCellDef>{{ 'sequences.list.columns.completed' | transloco }}</th>
          <td mat-cell *matCellDef="let seq">
            <span class="sequence-list__stat">{{ seq.completedEnrollments }}</span>
          </td>
        </ng-container>

        <!-- Reply Rate Column -->
        <ng-container matColumnDef="replyRate">
          <th mat-header-cell *matHeaderCellDef>{{ 'sequences.list.columns.replyRate' | transloco }}</th>
          <td mat-cell *matCellDef="let seq">
            <div class="sequence-list__reply-rate">
              <div class="sequence-list__reply-bar">
                <div class="sequence-list__reply-fill"
                     [style.width.%]="seq.replyRate"></div>
              </div>
              <span class="sequence-list__reply-value">{{ seq.replyRate }}%</span>
            </div>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let seq">
            <div class="sequence-list__actions" (click)="$event.stopPropagation()">
              <button mat-icon-button [matTooltip]="'sequences.detail.edit' | transloco"
                      [routerLink]="['/sequences', seq.id, 'edit']">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button [matTooltip]="'common.delete' | transloco" color="warn"
                      (click)="onDelete(seq)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"
            class="sequence-list__row"
            [routerLink]="['/sequences', row.id]"></tr>
      </table>
    </div>
  }
</div>
