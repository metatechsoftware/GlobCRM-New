<div class="dashboard">
  <!-- Hero Header Area -->
  <div class="dashboard__hero">
    <header class="dashboard__header">
      <div class="dashboard__greeting">
        <div class="dashboard__time-icon">
          <mat-icon>{{ timeIcon() }}</mat-icon>
        </div>
        <div>
          <h1 class="dashboard__title">{{ greeting() }}, {{ firstName() }}</h1>
          @if (store.activeDashboard(); as dashboard) {
            <div class="dashboard__subtitle-row">
              <span class="dashboard__dash-name">{{ dashboard.name }}</span>
              @if (dashboard.isTeamWide) {
                <span class="dashboard__badge">{{ 'header.team' | transloco }}</span>
              }
              <span class="dashboard__dot"></span>
              <span class="dashboard__updated">{{ 'header.live' | transloco }}</span>
            </div>
          }
        </div>
      </div>
      <div class="dashboard__actions">
        <app-date-range-filter
          [dateRange]="store.dateRange()"
          (dateRangeChanged)="onDateRangeChanged($event)"
        />
        <app-dashboard-selector
          [dashboards]="store.dashboards()"
          [activeDashboardId]="store.activeDashboard()?.id ?? null"
          (dashboardSelected)="onDashboardSelected($event)"
          (createDashboard)="onCreateDashboard()"
          (deleteDashboard)="onDeleteDashboard($event)"
        />
        @if (store.isEditing()) {
          <button mat-stroked-button class="dashboard__add-widget-btn" (click)="onAddWidget()">
            <mat-icon>add</mat-icon>
            {{ 'header.addWidget' | transloco }}
          </button>
        }
        <button mat-flat-button class="dashboard__edit-btn" (click)="onToggleEdit()">
          <mat-icon>{{ store.isEditing() ? 'check' : 'edit' }}</mat-icon>
          {{ store.isEditing() ? ('header.done' | transloco) : ('header.edit' | transloco) }}
        </button>
      </div>
    </header>
  </div>

  <!-- Tabs: Dashboard and Targets -->
  <mat-tab-group class="dashboard__tabs" animationDuration="200ms">
    <mat-tab [label]="'tabs.dashboard' | transloco">

      <!-- Dashboard Grid -->
      @if (store.activeDashboard(); as dashboard) {
        @if (store.isLoading()) {
          <div class="dashboard__loading">
            <div class="dashboard__loading-skeleton">
              <div class="dashboard__skeleton-card"></div>
              <div class="dashboard__skeleton-card"></div>
              <div class="dashboard__skeleton-card"></div>
            </div>
            <span class="dashboard__loading-text">{{ 'header.loading' | transloco }}</span>
          </div>
        } @else {
          <app-dashboard-grid
            [widgets]="dashboard.widgets"
            [widgetData]="store.widgetData()"
            [targets]="store.targets()"
            [isEditing]="store.isEditing()"
            (layoutChanged)="onLayoutChanged($event)"
            (editWidget)="onEditWidget($event)"
            (removeWidget)="onRemoveWidget($event)"
          />
        }
      } @else if (!store.isLoading()) {
        <!-- No dashboards exist yet -->
        <div class="dashboard__empty">
          <div class="dashboard__empty-decoration">
            <mat-icon>dashboard_customize</mat-icon>
          </div>
          <h2>{{ 'empty.title' | transloco }}</h2>
          <p>{{ 'empty.description' | transloco }}</p>
          <button mat-flat-button color="primary" class="dashboard__empty-cta" (click)="onCreateDashboard()">
            <mat-icon>add</mat-icon>
            {{ 'empty.createButton' | transloco }}
          </button>
        </div>
      }
    </mat-tab>

    <mat-tab [label]="'tabs.targets' | transloco">
      <app-target-management [targets]="store.targets()" />
    </mat-tab>
  </mat-tab-group>
</div>
