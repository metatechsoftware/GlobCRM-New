@if (isLoading()) {
  <div class="detail-loading">
    <mat-spinner diameter="48"></mat-spinner>
  </div>
} @else if (product()) {
  <div class="detail-page">
    <!-- Hero Card -->
    <div class="product-hero">
      <div class="hero-accent"></div>

      <!-- Navigation bar -->
      <div class="hero-nav">
        <a mat-icon-button routerLink="/products" aria-label="Back to products">
          <mat-icon>arrow_back</mat-icon>
        </a>
        <div class="hero-actions">
          <button mat-stroked-button
                  *appHasPermission="'Product:Edit'"
                  routerLink="edit">
            <mat-icon>edit</mat-icon> {{ 'products.detail.actions.edit' | transloco }}
          </button>
          <button mat-stroked-button color="warn"
                  *appHasPermission="'Product:Delete'"
                  (click)="deleteProduct()">
            <mat-icon>delete</mat-icon> {{ 'products.detail.actions.delete' | transloco }}
          </button>
        </div>
      </div>

      <!-- Profile section -->
      <div class="hero-profile">
        <div class="hero-avatar">
          <mat-icon>inventory_2</mat-icon>
        </div>
        <div class="hero-info">
          <h1 class="hero-name">{{ product()!.name }}</h1>
          <div class="hero-badges">
            <span class="status-badge" [class.status-badge--active]="product()!.isActive"
                  [class.status-badge--inactive]="!product()!.isActive">
              {{ product()!.isActive ? ('products.detail.status.active' | transloco) : ('products.detail.status.inactive' | transloco) }}
            </span>
          </div>
        </div>
      </div>

      <!-- Meta info pills -->
      <hr class="hero-divider">
      <div class="hero-meta">
        @if (product()!.sku) {
          <span class="meta-item">
            <mat-icon>qr_code</mat-icon>
            {{ 'products.detail.fields.sku' | transloco }}: {{ product()!.sku }}
          </span>
          <span class="meta-separator"></span>
        }
        @if (product()!.category) {
          <span class="meta-item">
            <mat-icon>category</mat-icon>
            {{ product()!.category }}
          </span>
          <span class="meta-separator"></span>
        }
        <span class="meta-item">
          <mat-icon>monetization_on</mat-icon>
          {{ product()!.unitPrice | currency:'USD':'symbol':'1.2-2' }}
        </span>
        <span class="meta-separator"></span>
        <span class="meta-item">
          <mat-icon>calendar_today</mat-icon>
          {{ 'products.detail.fields.created' | transloco }} {{ product()!.createdAt | date:'mediumDate' }}
        </span>
      </div>
    </div>

    <!-- Product Information Section -->
    <div class="detail-section">
      <div class="detail-section__header">
        <mat-icon>info</mat-icon>
        <h3>{{ 'products.detail.sections.productInfo' | transloco }}</h3>
      </div>
      <div class="details-grid">
        <div class="detail-field">
          <span class="field-label">{{ 'products.detail.fields.name' | transloco }}</span>
          <span class="field-value">{{ product()!.name }}</span>
        </div>
        <div class="detail-field">
          <span class="field-label">{{ 'products.detail.fields.sku' | transloco }}</span>
          <span class="field-value" [class.field-value--empty]="!product()!.sku">
            {{ product()!.sku ?? ('products.detail.empty.notSpecified' | transloco) }}
          </span>
        </div>
        <div class="detail-field">
          <span class="field-label">{{ 'products.detail.fields.category' | transloco }}</span>
          <span class="field-value" [class.field-value--empty]="!product()!.category">
            {{ product()!.category ?? ('products.detail.empty.notSpecified' | transloco) }}
          </span>
        </div>
        <div class="detail-field">
          <span class="field-label">{{ 'products.detail.fields.unitPrice' | transloco }}</span>
          <span class="field-value">{{ product()!.unitPrice | currency:'USD':'symbol':'1.2-2' }}</span>
        </div>
        <div class="detail-field">
          <span class="field-label">{{ 'products.detail.fields.status' | transloco }}</span>
          <span class="field-value">
            <span class="status-badge" [class.status-badge--active]="product()!.isActive"
                  [class.status-badge--inactive]="!product()!.isActive">
              {{ product()!.isActive ? ('products.detail.status.active' | transloco) : ('products.detail.status.inactive' | transloco) }}
            </span>
          </span>
        </div>
        @if (product()!.description) {
          <div class="detail-field full-width">
            <span class="field-label">{{ 'products.detail.fields.description' | transloco }}</span>
            <span class="field-value">{{ product()!.description }}</span>
          </div>
        }
        <div class="detail-field">
          <span class="field-label">{{ 'products.detail.fields.created' | transloco }}</span>
          <span class="field-value">{{ product()!.createdAt | date:'medium' }}</span>
        </div>
        <div class="detail-field">
          <span class="field-label">{{ 'products.detail.fields.updated' | transloco }}</span>
          <span class="field-value">{{ product()!.updatedAt | date:'medium' }}</span>
        </div>
      </div>
    </div>

    <!-- Custom Fields Section -->
    <div class="detail-section">
      <div class="detail-section__header">
        <mat-icon>tune</mat-icon>
        <h3>{{ 'products.detail.sections.customFields' | transloco }}</h3>
      </div>
      <app-custom-field-form
        entityType="Product"
        [readonly]="true"
        [customFieldValues]="product()!.customFields" />
    </div>
  </div>
} @else {
  <div class="detail-not-found">
    <mat-icon>error_outline</mat-icon>
    <h2>{{ 'products.detail.notFound' | transloco }}</h2>
    <a mat-stroked-button routerLink="/products">{{ 'products.detail.backToProducts' | transloco }}</a>
  </div>
}
