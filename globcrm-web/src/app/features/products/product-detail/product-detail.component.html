@if (isLoading()) {
  <div class="detail-loading">
    <mat-spinner diameter="48"></mat-spinner>
  </div>
} @else if (product()) {
  <div class="detail-page">
    <!-- Hero Card -->
    <div class="product-hero">
      <div class="hero-accent"></div>

      <!-- Navigation bar -->
      <div class="hero-nav">
        <a mat-icon-button routerLink="/products" aria-label="Back to products">
          <mat-icon>arrow_back</mat-icon>
        </a>
        <div class="hero-actions">
          <button mat-stroked-button
                  *appHasPermission="'Product:Edit'"
                  routerLink="edit">
            <mat-icon>edit</mat-icon> Edit
          </button>
          <button mat-stroked-button color="warn"
                  *appHasPermission="'Product:Delete'"
                  (click)="deleteProduct()">
            <mat-icon>delete</mat-icon> Delete
          </button>
        </div>
      </div>

      <!-- Profile section -->
      <div class="hero-profile">
        <div class="hero-avatar">
          <mat-icon>inventory_2</mat-icon>
        </div>
        <div class="hero-info">
          <h1 class="hero-name">{{ product()!.name }}</h1>
          <div class="hero-badges">
            <span class="status-badge" [class.status-badge--active]="product()!.isActive"
                  [class.status-badge--inactive]="!product()!.isActive">
              {{ product()!.isActive ? 'Active' : 'Inactive' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Meta info pills -->
      <hr class="hero-divider">
      <div class="hero-meta">
        @if (product()!.sku) {
          <span class="meta-item">
            <mat-icon>qr_code</mat-icon>
            SKU: {{ product()!.sku }}
          </span>
          <span class="meta-separator"></span>
        }
        @if (product()!.category) {
          <span class="meta-item">
            <mat-icon>category</mat-icon>
            {{ product()!.category }}
          </span>
          <span class="meta-separator"></span>
        }
        <span class="meta-item">
          <mat-icon>monetization_on</mat-icon>
          {{ product()!.unitPrice | currency:'USD':'symbol':'1.2-2' }}
        </span>
        <span class="meta-separator"></span>
        <span class="meta-item">
          <mat-icon>calendar_today</mat-icon>
          Created {{ product()!.createdAt | date:'mediumDate' }}
        </span>
      </div>
    </div>

    <!-- Product Information Section -->
    <div class="detail-section">
      <div class="detail-section__header">
        <mat-icon>info</mat-icon>
        <h3>Product Information</h3>
      </div>
      <div class="details-grid">
        <div class="detail-field">
          <span class="field-label">Name</span>
          <span class="field-value">{{ product()!.name }}</span>
        </div>
        <div class="detail-field">
          <span class="field-label">SKU</span>
          <span class="field-value" [class.field-value--empty]="!product()!.sku">
            {{ product()!.sku ?? 'Not specified' }}
          </span>
        </div>
        <div class="detail-field">
          <span class="field-label">Category</span>
          <span class="field-value" [class.field-value--empty]="!product()!.category">
            {{ product()!.category ?? 'Not specified' }}
          </span>
        </div>
        <div class="detail-field">
          <span class="field-label">Unit Price</span>
          <span class="field-value">{{ product()!.unitPrice | currency:'USD':'symbol':'1.2-2' }}</span>
        </div>
        <div class="detail-field">
          <span class="field-label">Status</span>
          <span class="field-value">
            <span class="status-badge" [class.status-badge--active]="product()!.isActive"
                  [class.status-badge--inactive]="!product()!.isActive">
              {{ product()!.isActive ? 'Active' : 'Inactive' }}
            </span>
          </span>
        </div>
        @if (product()!.description) {
          <div class="detail-field full-width">
            <span class="field-label">Description</span>
            <span class="field-value">{{ product()!.description }}</span>
          </div>
        }
        <div class="detail-field">
          <span class="field-label">Created</span>
          <span class="field-value">{{ product()!.createdAt | date:'medium' }}</span>
        </div>
        <div class="detail-field">
          <span class="field-label">Updated</span>
          <span class="field-value">{{ product()!.updatedAt | date:'medium' }}</span>
        </div>
      </div>
    </div>

    <!-- Custom Fields Section -->
    <div class="detail-section">
      <div class="detail-section__header">
        <mat-icon>tune</mat-icon>
        <h3>Custom Fields</h3>
      </div>
      <app-custom-field-form
        entityType="Product"
        [readonly]="true"
        [customFieldValues]="product()!.customFields" />
    </div>
  </div>
} @else {
  <div class="detail-not-found">
    <mat-icon>error_outline</mat-icon>
    <h2>Product not found</h2>
    <a mat-stroked-button routerLink="/products">Back to Products</a>
  </div>
}
