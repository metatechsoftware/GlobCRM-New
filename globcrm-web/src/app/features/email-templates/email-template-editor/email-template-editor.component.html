<div class="editor-page">
  <!-- Top Toolbar -->
  <div class="editor-toolbar">
    <div class="toolbar-left">
      <button mat-icon-button (click)="goBack()" [matTooltip]="'emailTemplates.editor.backTooltip' | transloco">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h2 class="page-title">{{ pageTitle() }}</h2>
    </div>

    <div class="toolbar-center">
      <div class="fields-group">
        <mat-form-field appearance="outline" class="name-field">
          <mat-label>{{ 'emailTemplates.editor.templateName' | transloco }}</mat-label>
          <input
            matInput
            [value]="templateName()"
            (input)="templateName.set($any($event.target).value)"
            [placeholder]="'emailTemplates.editor.templateNamePlaceholder' | transloco"
          />
        </mat-form-field>

        <mat-form-field appearance="outline" class="subject-field">
          <mat-label>{{ 'emailTemplates.editor.subjectLine' | transloco }}</mat-label>
          <input
            matInput
            [value]="templateSubject()"
            (input)="templateSubject.set($any($event.target).value)"
            [placeholder]="'emailTemplates.editor.subjectPlaceholder' | transloco"
          />
        </mat-form-field>

        <mat-form-field appearance="outline" class="category-field">
          <mat-label>{{ 'emailTemplates.editor.category' | transloco }}</mat-label>
          <mat-select
            [value]="selectedCategoryId()"
            (selectionChange)="selectedCategoryId.set($event.value)"
          >
            <mat-option [value]="null">{{ 'emailTemplates.editor.categoryNone' | transloco }}</mat-option>
            @for (category of store.categories(); track category.id) {
              <mat-option [value]="category.id">{{ category.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="toolbar-right">
      <mat-slide-toggle
        [checked]="isShared()"
        (change)="isShared.set($event.checked)"
        [matTooltip]="'emailTemplates.editor.shareTooltip' | transloco"
      >
        {{ 'emailTemplates.editor.shared' | transloco }}
      </mat-slide-toggle>

      <button
        mat-stroked-button
        (click)="toggleMergePanel()"
        [matTooltip]="'emailTemplates.editor.mergeFieldsTooltip' | transloco"
      >
        <mat-icon>data_object</mat-icon>
        {{ 'emailTemplates.editor.mergeFields' | transloco }}
      </button>

      <button
        mat-stroked-button
        (click)="openPreview()"
        [disabled]="saving()"
        [matTooltip]="'emailTemplates.editor.previewTooltip' | transloco"
      >
        <mat-icon>visibility</mat-icon>
        {{ 'emailTemplates.editor.preview' | transloco }}
      </button>

      <button
        mat-raised-button
        color="primary"
        class="save-btn"
        [disabled]="saving() || !templateName()"
        (click)="save()"
      >
        @if (saving()) {
          <mat-spinner diameter="18"></mat-spinner>
        } @else {
          <mat-icon>save</mat-icon>
        }
        {{ 'emailTemplates.editor.save' | transloco }}
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="editor-content">
    <!-- Unlayer Editor -->
    <div class="editor-container" [class.panel-open]="showMergePanel()">
      <email-editor
        #emailEditor
        [options]="editorOptions()"
        (loaded)="onEditorLoaded()"
        (ready)="onEditorReady()"
        minHeight="calc(100vh - 140px)"
      ></email-editor>
    </div>

    <!-- Merge Field Side Panel -->
    @if (showMergePanel()) {
      <div class="merge-panel-container">
        <app-merge-field-panel
          [mergeFields]="store.mergeFields()"
          (closePanel)="showMergePanel.set(false)"
        />
      </div>
      <div class="merge-panel-scrim" (click)="showMergePanel.set(false)"></div>
    }
  </div>
</div>
