<div class="merge-panel">
  <!-- Panel Header -->
  <div class="panel-header">
    <h3>{{ 'email-templates.mergePanel.title' | transloco }}</h3>
    <button mat-icon-button (click)="closePanel.emit()" [matTooltip]="'email-templates.mergePanel.closeTooltip' | transloco">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Info Hint -->
  <div class="panel-hint">
    <mat-icon class="hint-icon">info_outline</mat-icon>
    <span [innerHTML]="'email-templates.mergePanel.hint' | transloco">
    </span>
  </div>

  <!-- Entity Groups -->
  <mat-accordion multi>
    @for (group of entityGroups; track group) {
      <mat-expansion-panel [expanded]="true"
        [style.border-left]="'3px solid ' + getEntityConfig(group).text + '80'">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <span class="entity-group-icon" [style.color]="getEntityConfig(group).text">
              <mat-icon>{{ getEntityIcon(group) }}</mat-icon>
            </span>
            {{ getEntityConfig(group).label }}
            <span class="field-count">{{ getFields(group).length }}</span>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="field-list">
          @for (field of getFields(group); track field.key) {
            <button
              class="field-chip"
              [class.is-copied]="copiedField() === field.key"
              [style.background-color]="getEntityConfig(group).bg"
              [style.color]="getEntityConfig(group).text"
              [style.border-color]="getEntityConfig(group).text + '33'"
              (click)="copyMergeTag(field)"
              [matTooltip]="'{{' + field.key + '}}'"
            >
              <span class="field-label">{{ field.label }}</span>
              @if (field.isCustomField) {
                <span class="custom-badge">{{ 'email-templates.mergePanel.custom' | transloco }}</span>
              }
              <mat-icon class="copy-icon">{{ copiedField() === field.key ? 'check' : 'content_copy' }}</mat-icon>
            </button>
          }
        </div>
      </mat-expansion-panel>
    }
  </mat-accordion>

  <!-- Fallback Hint -->
  <div class="fallback-hint">
    <mat-icon class="hint-icon">lightbulb_outline</mat-icon>
    <span [innerHTML]="'email-templates.mergePanel.fallbackHint' | transloco">
    </span>
  </div>
</div>
