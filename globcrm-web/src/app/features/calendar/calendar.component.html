<div class="calendar-page">
  <!-- Hero: gradient backdrop with header + glassmorphic filters -->
  <div class="cal-hero">
    <header class="cal-header">
      <div class="cal-header__left">
        <div class="cal-header__icon">
          <mat-icon>calendar_month</mat-icon>
        </div>
        <div>
          <h1 class="cal-header__title">{{ 'calendar.title' | transloco }}</h1>
          <p class="cal-header__subtitle">
            {{ events().length === 1 ? ('calendar.header.activityInView' | transloco) : ('calendar.header.activitiesInView' | transloco: { count: events().length }) }}
          </p>
        </div>
      </div>

      <div class="cal-header__stats">
        @for (type of activityTypes; track type.value) {
          <button
            class="stat-chip"
            [class.stat-chip--active]="filterType() === type.value"
            (click)="onTypeChanged(filterType() === type.value ? null : type.value)"
            [matTooltip]="'calendar.header.filterByType' | transloco: { type: type.label }">
            <mat-icon class="stat-chip__icon">{{ type.icon }}</mat-icon>
            <span class="stat-chip__count">{{ typeCounts()[type.value] || 0 }}</span>
            <span class="stat-chip__label">{{ type.label }}s</span>
          </button>
        }
      </div>
    </header>

    <!-- Filter dropdowns -->
    <div class="cal-filters">
      <mat-form-field appearance="outline" class="cal-filter">
        <mat-label>{{ 'calendar.filters.entityType' | transloco }}</mat-label>
        <mat-select [value]="filterEntityType()" (selectionChange)="onEntityTypeChanged($event.value)">
          @for (et of entityTypes; track et.value) {
            <mat-option [value]="et.value">{{ et.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="cal-filter">
        <mat-label>{{ 'calendar.filters.owner' | transloco }}</mat-label>
        <mat-select [value]="filterOwnerId()" (selectionChange)="onOwnerChanged($event.value)">
          <mat-option [value]="null">{{ 'calendar.filters.allOwners' | transloco }}</mat-option>
          @for (member of teamMembers(); track member.id) {
            <mat-option [value]="member.id">{{ member.firstName }} {{ member.lastName }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- Loading indicator -->
  @if (isLoading()) {
    <div class="cal-loading">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
  }

  <!-- Calendar body with loading state -->
  <div class="cal-body" [class.is-loading]="isLoading()">
    <full-calendar [options]="calendarOptions()" />

    <!-- Empty state overlay -->
    @if (events().length === 0 && !isLoading() && hasLoaded()) {
      <div class="cal-empty">
        <div class="cal-empty__decoration">
          <mat-icon>event_available</mat-icon>
        </div>
        <h2 class="cal-empty__title">{{ 'calendar.empty.title' | transloco }}</h2>
        <p class="cal-empty__text">{{ 'calendar.empty.description' | transloco }}</p>
      </div>
    }
  </div>

  <!-- Priority legend -->
  <footer class="cal-legend">
    <span class="cal-legend__label">{{ 'calendar.legend.priority' | transloco }}</span>
    <div class="cal-legend__items">
      @for (item of priorityLegend; track item.value) {
        <div class="cal-legend__item">
          <span class="cal-legend__dot" [style.background]="item.color"></span>
          <span class="cal-legend__text">{{ item.label }}</span>
        </div>
      }
    </div>
  </footer>
</div>
