<div class="step-container">
  <div class="step-header">
    <mat-icon class="step-icon">group_add</mat-icon>
    <h3>{{ 'onboarding.inviteStep.title' | transloco }}</h3>
    <p class="step-description">
      {{ 'onboarding.inviteStep.description' | transloco }}
    </p>
  </div>

  @if (errorMessage()) {
    <div class="error-banner">
      <mat-icon>error_outline</mat-icon>
      <span>{{ errorMessage() }}</span>
    </div>
  }

  @if (resultMessage()) {
    <div class="success-banner">
      <mat-icon>check_circle</mat-icon>
      <span>{{ resultMessage() }}</span>
    </div>
  }

  <form [formGroup]="inviteForm">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'onboarding.inviteStep.emailLabel' | transloco }}</mat-label>
      <textarea matInput formControlName="emailInput"
                [placeholder]="'onboarding.inviteStep.emailPlaceholder' | transloco"
                rows="3"
                (blur)="parseEmails()"
                (keydown.enter)="$event.preventDefault(); parseEmails()">
      </textarea>
      <mat-hint>{{ 'onboarding.inviteStep.emailHint' | transloco }}</mat-hint>
    </mat-form-field>

    @if (emails().length > 0) {
      <div class="email-chips">
        <mat-chip-set>
          @for (email of emails(); track email) {
            <mat-chip (removed)="removeEmail(email)">
              {{ email }}
              <button matChipRemove [attr.aria-label]="'onboarding.inviteStep.removeEmail' | transloco">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip>
          }
        </mat-chip-set>
      </div>
    }

    <mat-form-field appearance="outline" class="role-select">
      <mat-label>{{ 'onboarding.inviteStep.role' | transloco }}</mat-label>
      <mat-select formControlName="role">
        <mat-option value="Member">{{ 'onboarding.inviteStep.roleMember' | transloco }}</mat-option>
        <mat-option value="Admin">{{ 'onboarding.inviteStep.roleAdmin' | transloco }}</mat-option>
      </mat-select>
      <mat-hint>{{ 'onboarding.inviteStep.roleHint' | transloco }}</mat-hint>
    </mat-form-field>
  </form>

  <div class="step-actions">
    <button mat-button (click)="onSkip()" class="skip-button">
      {{ 'onboarding.inviteStep.skip' | transloco }}
    </button>
    @if (emails().length > 0) {
      <button mat-flat-button color="primary" (click)="onSendInvitations()"
              [disabled]="isLoading()">
        @if (isLoading()) {
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        } @else {
          {{ 'onboarding.inviteStep.sendInvitations' | transloco: { count: emails().length } }}
        }
      </button>
    }
    <button mat-stroked-button color="primary" (click)="onContinue()">
      {{ 'onboarding.inviteStep.continue' | transloco }}
    </button>
  </div>
</div>
