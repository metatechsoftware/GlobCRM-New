<div class="teams-page">
  <!-- Header -->
  <div class="teams-header">
    <div class="header-text">
      <h1>Teams</h1>
      <p class="header-subtitle">Organize your people into collaborative groups</p>
    </div>
    <button
      *appHasPermission="'Contact:Create'"
      mat-flat-button
      color="primary"
      routerLink="/settings/teams/new"
      class="create-btn"
    >
      <mat-icon>add</mat-icon>
      New Team
    </button>
  </div>

  @if (isLoading()) {
    <div class="loading-state">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading teams...</p>
    </div>
  } @else if (errorMessage()) {
    <div class="error-state">
      <div class="error-icon-wrap">
        <mat-icon>wifi_off</mat-icon>
      </div>
      <h3>Something went wrong</h3>
      <p>{{ errorMessage() }}</p>
      <button mat-flat-button color="primary" (click)="loadTeams()">
        <mat-icon>refresh</mat-icon>
        Try Again
      </button>
    </div>
  } @else if (teams().length === 0) {
    <div class="empty-state">
      <div class="empty-visual">
        <div class="empty-circles">
          <div class="circle c1"></div>
          <div class="circle c2"></div>
          <div class="circle c3"></div>
        </div>
        <mat-icon class="empty-icon">groups</mat-icon>
      </div>
      <h3>No teams yet</h3>
      <p>Create your first team to start organizing your people into collaborative groups.</p>
      <button
        *appHasPermission="'Contact:Create'"
        mat-flat-button
        color="primary"
        routerLink="/settings/teams/new"
      >
        <mat-icon>add</mat-icon>
        Create First Team
      </button>
    </div>
  } @else {
    <div class="teams-grid">
      @for (team of teams(); track team.id; let i = $index) {
        <div
          class="team-card"
          [style.animation-delay]="(i * 60) + 'ms'"
          tabindex="0"
          (click)="onEdit(team)"
          (keydown.enter)="onEdit(team)"
        >
          <div class="card-accent" [style.background]="getTeamColor(team)"></div>

          <div class="card-body">
            <div class="card-top">
              <div
                class="team-icon"
                [style.background]="getTeamColorSoft(team)"
                [style.color]="getTeamColor(team)"
              >
                {{ team.name.charAt(0).toUpperCase() }}
              </div>
              <div class="card-actions" (click)="$event.stopPropagation()">
                <button
                  *appHasPermission="'Contact:Edit'"
                  mat-icon-button
                  (click)="onEdit(team)"
                  matTooltip="Edit team"
                  class="action-btn"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  *appHasPermission="'Contact:Delete'"
                  mat-icon-button
                  (click)="onDelete(team)"
                  matTooltip="Delete team"
                  class="action-btn action-btn--danger"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>

            <div class="card-content">
              <h3 class="team-name">{{ team.name }}</h3>
              <p class="team-desc">{{ team.description || 'No description' }}</p>
            </div>

            <div class="card-footer">
              <div class="metric">
                <mat-icon class="metric-icon">people</mat-icon>
                <span class="metric-value">{{ team.memberCount }}</span>
                <span class="metric-label">{{ team.memberCount === 1 ? 'member' : 'members' }}</span>
              </div>
              @if (team.defaultRoleName) {
                <div class="role-badge">
                  {{ team.defaultRoleName }}
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
