<div class="rl-page">
  <!-- Header -->
  <div class="rl-header">
    <div class="rl-header__left">
      <a routerLink="/settings" class="rl-back">
        <mat-icon>arrow_back</mat-icon>
        <span>{{ 'settings.common.backToSettings' | transloco }}</span>
      </a>
      <div class="rl-title-row">
        <div class="rl-icon-wrap">
          <mat-icon>shield</mat-icon>
        </div>
        <div>
          <h1 class="rl-title">{{ 'settings.roles.title' | transloco }}</h1>
          <p class="rl-subtitle">{{ 'settings.roles.subtitle' | transloco }}</p>
        </div>
      </div>
    </div>
    <button
      *appHasPermission="'Contact:Create'"
      mat-flat-button
      color="primary"
      routerLink="/settings/roles/new"
      class="rl-create-btn"
    >
      <mat-icon>add</mat-icon>
      {{ 'settings.roles.createRole' | transloco }}
    </button>
  </div>

  @if (isLoading()) {
    <div class="rl-loading">
      <mat-spinner diameter="40"></mat-spinner>
      <p>{{ 'settings.roles.loadingRoles' | transloco }}</p>
    </div>
  } @else if (errorMessage()) {
    <div class="rl-error">
      <div class="rl-error__icon-wrap">
        <mat-icon>wifi_off</mat-icon>
      </div>
      <h3>{{ 'settings.common.somethingWentWrong' | transloco }}</h3>
      <p>{{ errorMessage() }}</p>
      <button mat-flat-button color="primary" (click)="loadRoles()">
        <mat-icon>refresh</mat-icon>
        {{ 'settings.common.tryAgain' | transloco }}
      </button>
    </div>
  } @else if (roles().length === 0) {
    <div class="rl-empty">
      <div class="rl-empty__visual">
        <div class="rl-empty__circles">
          <div class="rl-circle rl-circle--1"></div>
          <div class="rl-circle rl-circle--2"></div>
          <div class="rl-circle rl-circle--3"></div>
        </div>
        <mat-icon class="rl-empty__icon">shield</mat-icon>
      </div>
      <h3>{{ 'settings.roles.noRolesYet' | transloco }}</h3>
      <p>{{ 'settings.roles.noRolesDescription' | transloco }}</p>
      <button
        *appHasPermission="'Contact:Create'"
        mat-flat-button
        color="primary"
        routerLink="/settings/roles/new"
      >
        <mat-icon>add</mat-icon>
        {{ 'settings.roles.createFirstRole' | transloco }}
      </button>
    </div>
  } @else {
    <div class="rl-grid">
      @for (role of roles(); track role.id; let i = $index) {
        <div
          class="rl-card"
          [style.animation-delay]="(i * 60) + 'ms'"
          tabindex="0"
          (click)="onEdit(role)"
          (keydown.enter)="onEdit(role)"
          [class.rl-card--system]="role.isSystem"
        >
          <div class="rl-card__accent" [style.background]="getRoleAccentColor(role)"></div>

          <div class="rl-card__body">
            <div class="rl-card__top">
              <div
                class="rl-card__icon"
                [style.background]="getRoleAccentSoft(role)"
                [style.color]="getRoleAccentColor(role)"
              >
                <mat-icon>{{ getRoleIcon(role) }}</mat-icon>
              </div>
              <div class="rl-card__actions" (click)="$event.stopPropagation()">
                @if (role.isTemplate) {
                  <button
                    *appHasPermission="'Contact:Create'"
                    mat-icon-button
                    (click)="onClone(role)"
                    [matTooltip]="'settings.roles.cloneRole' | transloco"
                    class="rl-action-btn"
                  >
                    <mat-icon>content_copy</mat-icon>
                  </button>
                }
                <button
                  *appHasPermission="'Contact:Edit'"
                  mat-icon-button
                  (click)="onEdit(role)"
                  [disabled]="role.isSystem"
                  [matTooltip]="'settings.roles.editRole' | transloco"
                  class="rl-action-btn"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  *appHasPermission="'Contact:Delete'"
                  mat-icon-button
                  (click)="onDelete(role)"
                  [disabled]="role.isSystem"
                  [matTooltip]="'settings.roles.deleteRole' | transloco"
                  class="rl-action-btn rl-action-btn--danger"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>

            <div class="rl-card__content">
              <div class="rl-card__name-row">
                <h3 class="rl-card__name">{{ role.name }}</h3>
                <span
                  class="rl-type-badge"
                  [class.rl-type-badge--system]="role.isSystem"
                  [class.rl-type-badge--template]="role.isTemplate"
                  [class.rl-type-badge--custom]="!role.isSystem && !role.isTemplate"
                >
                  {{ getRoleTypeLabel(role) }}
                </span>
              </div>
              <p class="rl-card__desc">{{ role.description || ('settings.common.noDescription' | transloco) }}</p>
            </div>

            <div class="rl-card__footer">
              <div class="rl-metric">
                <mat-icon class="rl-metric__icon">lock</mat-icon>
                <span class="rl-metric__value">{{ role.permissionCount }}</span>
                <span class="rl-metric__label">{{ role.permissionCount === 1 ? ('settings.roles.permission' | transloco) : ('settings.roles.permissions' | transloco) }}</span>
              </div>
              <div class="rl-metric">
                <mat-icon class="rl-metric__icon">people</mat-icon>
                <span class="rl-metric__value">{{ role.assignedUserCount }}</span>
                <span class="rl-metric__label">{{ role.assignedUserCount === 1 ? ('settings.roles.user' | transloco) : ('settings.roles.users' | transloco) }}</span>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
