<div class="team-directory-page">
  <div class="directory-header">
    <h1>{{ 'profile.teamDirectory.title' | transloco }}</h1>
    <p>{{ 'profile.teamDirectory.subtitle' | transloco }}</p>
  </div>

  <div class="directory-filters">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>{{ 'profile.teamDirectory.searchLabel' | transloco }}</mat-label>
      <mat-icon matPrefix>search</mat-icon>
      <input
        matInput
        [value]="searchQuery()"
        (input)="onSearchInput($any($event.target).value)"
        [placeholder]="'profile.teamDirectory.searchPlaceholder' | transloco" />
    </mat-form-field>

    <mat-form-field appearance="outline" class="department-filter">
      <mat-label>{{ 'profile.teamDirectory.department' | transloco }}</mat-label>
      <mat-select [value]="selectedDepartment()" (selectionChange)="onDepartmentChange($event.value)">
        <mat-option value="">{{ 'profile.teamDirectory.allDepartments' | transloco }}</mat-option>
        @for (dept of departments(); track dept) {
          <mat-option [value]="dept">{{ dept }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <p>{{ 'profile.teamDirectory.loading' | transloco }}</p>
    </div>
  } @else if (members().length === 0) {
    <div class="directory-empty">
      <mat-icon class="empty-icon">people</mat-icon>
      <h3>{{ 'profile.teamDirectory.noMembers' | transloco }}</h3>
      @if (searchQuery() || selectedDepartment()) {
        <p>{{ 'profile.teamDirectory.adjustSearch' | transloco }}</p>
      } @else {
        <p>{{ 'profile.teamDirectory.willAppear' | transloco }}</p>
      }
    </div>
  } @else {
    <div class="members-grid">
      @for (member of members(); track member.id) {
        <div class="member-card" (click)="viewProfile(member)">
          <div class="card-content">
            <div class="card-avatar">
              <app-avatar
                [avatarUrl]="member.avatarUrl"
                [firstName]="member.firstName"
                [lastName]="member.lastName"
                [avatarColor]="member.avatarColor"
                size="lg" />
            </div>
            <div class="card-identity">
              <h3 class="member-name">{{ member.firstName }} {{ member.lastName }}</h3>
              @if (member.jobTitle) {
                <p class="member-title">{{ member.jobTitle }}</p>
              }
            </div>
            @if (member.department) {
              <div class="card-department">
                <span class="dept-badge">{{ member.department }}</span>
              </div>
            }
            <div class="card-contacts">
              <div class="contact-row">
                <mat-icon>email</mat-icon>
                <span>{{ member.email }}</span>
              </div>
              @if (member.phone) {
                <div class="contact-row">
                  <mat-icon>phone</mat-icon>
                  <span>{{ member.phone }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>

    <mat-paginator
      [length]="totalCount()"
      [pageSize]="pageSize()"
      [pageIndex]="page() - 1"
      [pageSizeOptions]="[12, 24, 48]"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  }
</div>
